<?php
	session_start();
	require_once('phpfiles/ShadoConfig.php');
	//phpinfo();
?>
<!DOCTYPE html>
<html>
	<head>
		<title>Creat an account | Shado</title>
<link rel="stylesheet" type="text/css" href="CSS Scripts/constitution.css">
<link rel="icon" type="image/ico" href="Shado.ico">
<script type="text/javascript">

    function PreviewImage() {
        var oFReader = new FileReader();
        oFReader.readAsDataURL(document.getElementById("imglink").files[0]);

        oFReader.onload = function (oFREvent) {
            document.getElementById("uploadPreview").src = oFREvent.target.result;
        };
    };

</script>
<script language="JavaScript" type="text/javascript">
<!--
function launchwin()
{
window.open("privicy.txt","cool","width=500,height=500,status=yes,screenX=0,left=200,screenY=0,top=200");
}
// -->
</script>
<style type="text/css">
input[type=text]	{width: 266px;
			 border-radius: 5px;
 		    	 height: 30px;
			 border-width: 1px;
			 padding: 3px;}
input[type=password]	{width: 266px;
			 border-radius: 5px;
 		    	 height: 30px;
			 border-width: 1px;
			 padding: 3px;}
.message	{
	
}
#user_registered	{
	background-color: lightgreen;
	border: solid 1px green;
	border-radius: 5px;
	color: green;
	padding: 10px;
	display: none;
}
#user_registered a	{
	color: green;
	text-decoration: underline;
}
#user_registered a:hover	{
	text-decoration: none;
	font-weight: bold;
}
#pass_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
#user_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
#img_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
#img_size_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
#email_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
#smail_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
#query_error	{
	background-color: #fdd;
	border: 1px solid #c77;
	border-radius: 5px;
	color: #c77;
	padding: 10px;
	display: none;
}
select	{
	border-radius: 5px;
	height: 30px;
	border-width: 1px;
	padding: 3px;
}
select option	{
		font-size: 14px;
}
</style>
<script language="JavaScript">
<!--
function getDate()	{
	var d = new Date();
	document.getElementById("joinDate").value = d;
};
//-->
</script>
	</head>
	<body vlink="#00ccff" style="background-image: url('backgrounds/caa_background.jpg')" Onload="getDate();">
		<font face="Arial">
		<div class="account">
			<div class="message">
				<div id="user_registered">
					Your account has been created successfully please <a href="Shado.php">sign in here</a> to access it.
				</div>
				<div id="pass_error">
					Password and password confirmation don't match!
				</div>
				<div id="user_error">
					This Username Already exists... Please try another username!
				</div>
				<div id="img_error">
					Image file already exists.. Try another image file
				</div>
				<div id="img_size_error">
					Image file size larger than 2 MB.. Try another image file
				</div>
				<div id="email_error">
					This register email has been already used... Please try another email!
				</div>
				<div id="smail_error">
					This Shado email has been already used... Please try another Shado mail address!
				</div>
				<div id="query_error">
					Error! An error has occured while processing PHP query (Line: 477)
				</div>
			</div>
		<fieldset>
			<legend>Information</legend><br />
			<table>
			<form action="CAA.php" method="post" enctype="multipart/form-data">
				<tr>
					<td>
						<span rol="alert" name="">Full Name</span>
					</td>
					<td>
						<input name="first_name" type="text" placeholder="Frist name" style="width: 133px;" required />
						<input name="last_name" type="text" placeholder="Last name" style="width: 133px;" required />
					</td>
				</tr>
				<tr>
					<td>
						<span rol="alert" name="">E-mail address</span>
					</td>
					<td>
						<input name="email" type="text" placeholder="E-mail" required />
					</td>
				</tr>				
				<tr>
					<td>
						<span rol="alert" name="">Select your date of birth</span>
					</td>
					<td>
						<select name="day" required>	
							<option value="none"></option>	
							<option value="01">01</option>
							<option value="02">02</option>
							<option value="03">03</option>
							<option value="04">04</option>
							<option value="05">05</option>
							<option value="06">06</option>
							<option value="07">07</option>
							<option value="08">08</option>
							<option value="09">09</option>
							<option value="10">10</option>
							<option value="11">11</option>
							<option value="12">12</option>
							<option value="13">13</option>
							<option value="14">14</option>
							<option value="15">15</option>
							<option value="16">16</option>
							<option value="17">17</option>
							<option value="18">18</option>
							<option value="19">19</option>
							<option value="20">20</option>
							<option value="21">21</option>
							<option value="22">22</option>
							<option value="23">23</option>
							<option value="24">24</option>
							<option value="25">25</option>
							<option value="26">26</option>
							<option value="27">27</option>
							<option value="28">28</option>
							<option value="29">29</option>
							<option value="30">30</option>
							<option value="31">31</option>
						</select>
						<select name="month" required>
							<option value="none"></option>	
							<option value="January">January</option>
							<option value="February">February</option>
							<option value="March">March</option>
							<option value="April">April</option>
							<option value="May">May</option>
							<option value="June">June</option>
							<option value="July">July</option>
							<option value="August">August</option>
							<option value="Septemper">Septemper</option>
							<option value="October">October</option>
							<option value="November">November</option>
							<option value="December">December</option>
						</select>
						<select name="year" required>
							<option value="none"></option>	
							<option value="2018">2018</option>
							<option value="2017">2017</option>
							<option value="2016">2016</option>
							<option value="2015">2015</option>
							<option value="2014">2014</option>
							<option value="2013">2013</option>
							<option value="2012">2012</option>
							<option value="2011">2011</option>
							<option value="2010">2010</option>
							<option value="2009">2009</option>
							<option value="2008">2008</option>
							<option value="2007">2007</option>
							<option value="2006">2006</option>
							<option value="2005">2005</option>
							<option value="2004">2004</option>
							<option value="2003">2003</option>
							<option value="2002">2002</option>
							<option value="2001">2001</option>
							<option value="2000">2000</option>
							<option value="1999">1999</option>
							<option value="1998">1998</option>
							<option value="1997">1997</option>
							<option value="1996">1996</option>
							<option value="1995">1995</option>
							<option value="1994">1994</option>
							<option value="1993">1993</option>
							<option value="1992">1992</option>
							<option value="1991">1991</option>
							<option value="1990">1990</option>
							<option value="1989">1989</option>
							<option value="1988">1988</option>
							<option value="1987">1987</option>
							<option value="1986">1986</option>
							<option value="1985">1985</option>
							<option value="1984">1984</option>
							<option value="1983">1983</option>
							<option value="1982">1982</option>
							<option value="1981">1981</option>
							<option value="1980">1980</option>
							<option value="1979">1979</option>
							<option value="1978">1978</option>
							<option value="1977">1977</option>
							<option value="1976">1976</option>
							<option value="1975">1975</option>
							<option value="1974">1974</option>
							<option value="1973">1973</option>
							<option value="1972">1972</option>
							<option value="1971">1971</option>
							<option value="1970">1970</option>
							<option value="other">other</option>
						</select>
					</td>
				</tr>	

				<tr>
					<td>
						<span rol="alert" name="">Choose a username</span>
					</td>
					<td>
						<input name="username" type="text" placeholder="Username" required />
					</td>
				</tr>
				<tr>
					<td>
						<span rol="alert" name="">Type a password</span>
					</td>
					<td>
						<input name="password" type="password" placeholder="Password" required />
					</td>
				</tr>
				<tr>
					<td>
						<span rol="alert" name="">Confirm password</span>
					</td>
					<td>
						<input name="cpassword" type="password" placeholder="Confirm password" required />
					</td>
				</tr>				
				<tr>
					<td>
						<span rol="alert" name="">Choose a shado email</span>
					</td>
					<td>
						<input name="shadomail" type="text" placeholder="example@shado.com" required />
					</td>
				</tr>
				
				<tr>
					<td>
						<span rol="alert" name="">Select a scurity Question</span>
					</td>
					<td>
						<select name="squestion" required>
							<option value=""></option>
							<option value="What is your best friend?">What is the name of best friend?</option>
							<option value="What is your Favourite food?">What is your Favourite food?</option>
							<option value="What is your Favourite color?">What is your Favourite colour?</option>
							<option value="What is your colour of your Car?">What is the colour of your Car?</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						<span rol="alert" name="">Write your answer</span>
					</td>
					<td>
						<input name="answer" type="text" placeholder="Answer" required />
					</td>
				</tr>
				
				<tr>
					<td>
						<span rol="alert" name="">Upload a presonal photo</span>
					</td>
					<td>
						<input type="file" id="imglink" name="imglink" accept=".jpg,.jpeg,.png" onchange="PreviewImage();"/>
						<img width="100" height="100" id="uploadPreview" src="#" title="your image" />
					</td>
				</tr>
				<tr>
					<td>
						<input id="joinDate" name="join_date" type="hidden" placeholder="Date Joined" value="" />
					</td>
				</tr>
			</table>
			<br />
			<p>
				How would you like to use your Account? &nbsp;
				<br />
				<input name="accountUse" type="checkbox" value="write_emails">to write E-mails
				<br />
				<input name="accountUse" type="checkbox" value="write_articles">to write articles
				<br />
				<input name="accountUse" type="checkbox" value="read_articles">to read articles
				<br />
				<input name="accountUse" type="checkbox" value="search_friends">to search friends 
				<br />
				<br />
				How would you like to communicat with you? &nbsp;  
				<br />
				<input type="radio"  name="ContactMe" value="Phone">phone
				<br />
				<input type="radio" name="ContactMe"  value="Email" checked="" >E-mail
				<br />
				<input type="radio" name="ContactMe"  value="Fax">fax
				<br />
				<input type="radio" name="ContactMe"  value="no_communication" disabled="disabled">Don't communicat with me
			</p> <br /> 
			<input type="submit" name="register" value="Creat my account" class="google-input_green-shado_button" />
			<input type="reset" name="reset" value="reset form" class="google-input_green-shado_button"/>
			</form>	
		<br />
		</fieldset>

		<br />

		<fieldset>
			<legend>Write for us</legend> 
			write an e-mail to send it to shado.KS.com &nbsp;  <br />
			<textarea name="Comments" cols="30" rows="5" class="caa"></textarea> <br />
			<input type="submit" name="submit" value="Send my e-mail" id="google-input_green-shado_button"  class="google-input_green-shado_button"  />
			<br />
			<br />
		</fieldset>
		 <br />
		</font>
		<?php
			if(isset($_POST['register']))
			{
				$date=$_POST['join_date'];
				$accountUsage=$_POST['accountUse'];
				$comtype=$_POST['ContactMe'];
				$fname=$_POST['first_name'];
				$lname=$_POST['last_name'];
				$day=$_POST['day'];
				$month=$_POST['month'];
				$year=$_POST['year'];
				$smail=$_POST['shadomail'];
				$question=$_POST['squestion'];
				$answer=$_POST['answer'];
				$email=$_POST['email'];
				$username=$_POST['username'];
				$password=$_POST['password'];
				$cpassword=$_POST['cpassword'];
				
				$img_name = $_FILES['imglink']['name'];
				$img_size =$_FILES['imglink']['size'];
			    $img_tmp =$_FILES['imglink']['tmp_name'];
				
				$directory = 'personal_pages/Shado_personal_pages_uploads/';
				$target_file = $directory.$img_name;
			
				if($password==$cpassword)
				{
					
					$query= "SELECT * FROM `shadotable` WHERE username='$username'";
					$query_run = mysqli_query($con,$query);
					$query2= "SELECT * FROM `shadotable` WHERE email='$email'";
					$query_run2 = mysqli_query($con,$query2);
					$query3= "SELECT * FROM `shadotable` WHERE smail='$smail'";
					$query_run3 = mysqli_query($con,$query3);
					
					if(mysqli_num_rows($query_run)>0)
					{
						// there is already a user with the same username
						echo '<script type="text/javascript">document.getElementById("user_error").style.display = "block";</script>';
					} 
					else if (mysqli_num_rows($query_run2)>0)
					{
						// there is already a user with the same email
						echo '<script type="text/javascript">document.getElementById("email_error").style.display = "block";</script>';
					}
					else if (mysqli_num_rows($query_run3)>0)
					{
						// there is already a user with the same Shado mail
						echo '<script type="text/javascript">document.getElementById("smail_error").style.display = "block";</script>';
					}
					else if(file_exists($target_file))
					{
						echo '<script type="text/javascript">document.getElementById("img_error").style.display = "block";</script>';
					}
					
					else if($img_size>2097152)
					{
						echo '<script type="text/javascript">document.getElementById("img_size_error").style.display = "block";</script>';
					}
					
					else
					{
						move_uploaded_file($img_tmp,$target_file); 	

						$query4 = "INSERT INTO shadotable (username, password, email, imglink, question, answer, smail, day, month, year, fname, lname, comtype, accountUsage, date) VALUES ('$username','$password','$email','$target_file','$question','$answer','$smail','$day','$month','$year','$fname','$lname','$comtype','$accountUsage','$date')";
						
						$query_run4 = mysqli_query($con, $query4);

						if($query_run4)
						{
							echo '<script type="text/javascript">document.getElementById("user_registered").style.display = "block";</script>';
						}
						else
						{
							echo '<script type="text/javascript">document.getElementById("query_error").style.display = "block";</script>';
						}
					}	
					
					
				}
				else
				{
					echo '<script type="text/javascript">document.getElementById("pass_error").style.display = "block";</script>';	
				}
				
				
				
				
			}
		?>
		<br />

	</body>
</html>