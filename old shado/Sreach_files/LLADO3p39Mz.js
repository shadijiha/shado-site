/*1339386353,169776317*/

if (window.CavalryLogger) { CavalryLogger.start_js(["+j9Gc"]); }

window.__UIControllerRegistry=window.__UIControllerRegistry||{};
PageletCache=window.PageletCache||{init:function(){try{PageletCache._cache=window.sessionStorage;}catch(a){}Arbiter.subscribe('pre_page_transition',PageletCache.cleanup);},_processBeforeWrite:function(a){Bootloader.setResourceMap(a.resource_map);var b=a.css||[];a.resource_map=a.resource_map||{};for(var c=0;c<b.length;c++){var d=b[c];if(!a.resource_map[d])a.resource_map[d]=Bootloader.resolveResources([d])[0];}delete a.js;delete a.bootloadable;delete a.onload;delete a.onafterload;delete a.jscc_map;delete a.jsmods;},write:function(a){if(!PageletCache._cache||a.cache_type=='base')return;var b={},c={};copy_properties(c,a);try{PageletCache._processBeforeWrite(c);b[a.key]=c;PageletCache._cache.setItem(a.id,JSON.stringify(b));PageletCache._pagelets[a.id]=c;}catch(d){}},loadFromCache:function(a){var b={};copy_properties(b,PageletCache.read(a.id,a.key));if(is_empty(b))return a;b.id=a.id;b.cache_hit=true;b.display_dependency=a.display_dependency;b.phase=a.phase;b.is_last=a.is_last;return b;},read:function(a,b){if(!PageletCache._cache)return null;if(a.substr(0,6)=='cached')a=a.substr(7);var c=PageletCache._cache.getItem(a);if(c){var d;try{d=JSON.parse(c);}catch(e){}if(d&&d[b]){PageletCache._pagelets[a]=d[b];PageletCache._cache_hits[a]=true;return d[b];}}},isCacheHit:function(a){return !!PageletCache._cache_hits[a];},cleanup:function(){PageletCache._cache_hits={};},_cache:null,_pagelets:{},_cache_hits:{}};
function PageletCacheController(a,b,c){if(!PageletCache)return;if(!a)return;this._cacheKey=a;this._cacheType=b;this._subscriptions=[];this._controller=null;this._registerSnapshot(c);PageletCacheController._instances[a]=this;PageletCache.takeSnapshot(a,null,this.handlePageletDOMOnSnapshot.bind(this));}copy_properties(PageletCacheController,{registerController:function(a,b){if(!a||!b)return null;var c=PageletCacheController._instances[a];if(c){c.setController(b);if(c._cacheType=='update'&&PageletCache.isCacheHit(a))onafterloadRegister_DEPRECATED(c.updateAfterload.bind(c,b));}return c;},_instances:{}});copy_properties(PageletCacheController.prototype,{registerCleanup:function(a){Arbiter.subscribe(a,this._cleanup.bind(this));},setController:function(a){this._controller=a;return this;},loadData:function(){return PageletCache.fetchData(this._cacheKey);},populateControllerDataOnSnapshot:bagofholding,handlePageletDOMOnSnapshot:bagofholding,updateAfterload:bagofholding,_registerSnapshot:function(a){for(var b=0;b<a.length;b++)this._subscriptions.push(Arbiter.subscribe(a[b],this._update.bind(this)));},_update:function(){if(!$(this._cacheKey)){this._cleanup();return;}var a=this._controller?this.populateControllerDataOnSnapshot.bind(this,this._controller):bagofholding;PageletCache.takeSnapshot(this._cacheKey,a,this.handlePageletDOMOnSnapshot.bind(this));},_cleanup:function(){this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions.length=0;delete PageletCacheController._instances[this._cacheKey];}});copy_properties(PageletCache,{takeSnapshot:function(a,b,c){var d=PageletCache._pagelets[a];if(d){var e=$(a);if(e){var f=e.cloneNode(true);if(c)c(f);d.content[a]=f.innerHTML;if(b){if(!d.data)d.data={};b(d.data);}PageletCache.write(d);}}},fetchData:function(a,b){var c=PageletCache._pagelets[a];if(c&&c.data)if(b){return c.data[b];}else return c.data;}});
function HomeNavigationCache(a,b,c){this.parent.construct(this,a,b,c);}Class.extend(HomeNavigationCache,'PageletCacheController');copy_properties(HomeNavigationCache.prototype,{handlePageletDOMOnSnapshot:function(a){var b=DOM.scry(a,'li.sideNavItem');if(b.length===0)return;for(var c=0;c<b.length;c++){var d=b[c];if(d.id=='navItem_app_4748854339'){CSS.addClass(d,'selectedItem');}else if(CSS.hasClass(d,'selectedItem')){CSS.removeClass(d,'selectedItem');CSS.removeClass(d,'open');}CSS.removeClass(d,'loading');}var e=DOM.scry(a,'.uiFutureSideNav')[0];if(e)CSS.addClass(e,'hideNavCounts');}});
__d("legacy:dom-scroll",["DOMScroll"],function(a,b,c,d){a.DOMScroll=b('DOMScroll');},3);
var NewHigh={reset:function(){this.initialized=false;},ensureInitialized:function(){if(this.initialized)return;this.button=DOM.scry(document.body,'a.stream_header_button')[0];this.composer=DOM.scry(document.body,'div.UIComposer')[0];this.buttonArea=DOM.scry(this.composer,'div.UIComposer_ButtonArea')[0];this.initialized=true;},showComposer:function(a){this.ensureInitialized();if(this.composer){CSS.show(this.composer);UIComposer.focusInstance(this.composer.id);var b=UIComposer.getInstance(this.composer.id);b&&b.loadAttachment(parseInt(a,10));}this.button&&CSS.hide(this.button);},hideComposer:function(a){this.ensureInitialized();if(this.composer){var b=UIComposer.getInstance(this.composer.id);if(!a){b&&b.initialized&&b.blur();CSS.hide(this.composer);this.button&&CSS.show(this.button);}else{b&&b.initialized&&b.loadAttachment(0);CSS.show(this.composer);this.buttonArea&&CSS.hide(this.buttonArea);}}}};
__d("UIIntentionalStreamMessage",[],function(a,b,c,d,e,f){var g={SET_AUTO_INSERT:'UIIntentionalStream/setAutoInsert',UPDATE_STREAM:'UIIntentionalStreamRefresh/updateStream',REFRESH_STREAM:'UIIntentionalStreamRefresh/refreshStream',UPDATE_AUTOREFRESH_CONFIG:'UIIntentionalStream/updateAutoRefreshConfig',UPDATE_HTML_CONTENT:'UIIntentionalStream/updateHtmlContent',UPDATE_LAST_REFRESH_TIME:'UIIntentionalStream/updateLastRefreshTime',INSERT_STORIES:'UIIntentionalStream/updateLastRefreshTime'};e.exports=g;});
__d("legacy:UIIntentionalStream-message",["UIIntentionalStreamMessage"],function(a,b,c,d){a.UIIntentionalStreamMessage=b('UIIntentionalStreamMessage');},3);
function UIIntentionalStream(a,b,c,d,e,f,g,h,i,j,k){if(!a)throw new Error('UIIntentionalStream instantiated with no root.');copy_properties(this,{id:a.id,root:a,instanceName:b,newest:c,oldest:d,oldestMR:d,shouldShowHidden:false,defaultFilter:e,currentFilterKey:j,sourceType:f,lastSeenTime:k,hasPendingRefresh:false,pauseAutoInsert:false,error:DOM.scry(a,'div.UIIntentionalStream_Error')[0],pager:DOM.scry(a,'div.uiMorePager')[0],filterNullState:DOM.scry(a,'div.friendListFilterNullState')[0],streamContent:DOM.find(a,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:JSLogger.create('stream')});this.addScrollTrace('init',{});onleaveRegister(this.unload.bind(this));if(!UIIntentionalStream.instances)UIIntentionalStream.instances={};UIIntentionalStream.instances[b]=this;UIIntentionalStream.instance=this;this.setupAutoInsert();this.setupSubscriptions();}UIIntentionalStream.isHighlightsFilter=function(a){if(!a)return false;var b=startsWith(a,UIIntentionalStream.FEED_FILTER_KEY_NEW_HIGHLIGHTS);return b;};UIIntentionalStream.prototype.subscribeToComposerPublish=function(){this.subscriptions.push(Arbiter.subscribe('composer/publish',function(event,a){if(a.streamStory)this.addComposerContent(a.streamStory,500);}.bind(this)));};UIIntentionalStream.prototype.setupSubscriptions=function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(Arbiter.subscribe(UIIntentionalStreamMessage.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(Arbiter.subscribe(UIIntentionalStreamMessage.REFRESH_STREAM,this.refreshStream.bind(this)));};UIIntentionalStream.prototype.tearDownSubscriptions=function(){if(!this.subscriptions)return;this.subscriptions.forEach(Arbiter.unsubscribe);this.subscriptions=null;};UIIntentionalStream.prototype.unload=function(){this.addScrollTrace('unload',{});this.tearDownSubscriptions();UIIntentionalStream.instance=null;UIIntentionalStream.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;UIIntentionalStreamRefresh.instance&&UIIntentionalStreamRefresh.instance.unload();};UIIntentionalStream.getInstance=function(a){return UIIntentionalStream.instances[a];};UIIntentionalStream.prototype._getUpdateInsertType=function(){return UIIntentionalStream.REFRESH_PREPEND;};UIIntentionalStream.prototype.updateStream=function(a){if(a!=UIIntentionalStreamMessage.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});};UIIntentionalStream.prototype.clearScrollLoader=function(a){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(a||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;};UIIntentionalStream.prototype.loadOlderPosts=function(a){var b={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};b=merge(b,a);this.cachedScrollQID=0;this.loadWithParams(b);};UIIntentionalStream.prototype.loadWithParams=function(a){var b=DOM.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(b){if(CSS.hasClass(b,'async_saving'))return;CSS.addClass(b,'async_saving');}this.addScrollTrace('loadwithparams',a);UIPagelet.loadFromEndpoint('MoreStoriesPagelet','home_stream',a,{usePipe:true,append:true});};UIIntentionalStream.prototype.setScrollLoadCount=function(a){this.maxScrollLoadCount=a;};UIIntentionalStream.prototype.loadMoreOnScroll=function(a,b){if(window.disableScrollLoad)return;var c=function(){if(window.disableScrollLoad)return;if(window.ArbiterMonitor){var f=user_action('scroll',null,null,'FORCE',{gt:{ua_id:'stream:scroll:auto'}});f.set_namespace('stream');ArbiterMonitor.initUA(f);}var g={delay_load_count:b};this.loadOlderPosts(g);}.bind(this),d=DOM.scry(this.root,'ul.uiStream li.genericStreamStory');if(!d.length)return;this.addScrollTrace('loadmoreonscroll',{});var e=d[d.length-a-1];if(e){this.currentScrollListener=new OnVisible(e,c,null,0);}else c();};UIIntentionalStream.prototype.updateTimeRange=function(a,b){if(!this.newest||this.newest<a){this.newest=a;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(b&&(b<this.oldest))){this.oldest=b;this.addScrollTrace('update_oldest',{oldest:this.oldest});}};UIIntentionalStream.prototype.updateOldestMR=function(a){if(!this.oldestMR||a<this.oldestMR){this.oldestMR=a;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}};UIIntentionalStream.prototype.updateScrollPosition=function(a){this.scrollPosition=a;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});};UIIntentionalStream.prototype.updateLastViewStateID=function(a){this.lastViewStateID=a;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});};UIIntentionalStream.prototype.updateCachedScrollQID=function(a){this.cachedScrollQID=a;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});};UIIntentionalStream.prototype.getID=function(){return this.id;};UIIntentionalStream.prototype.getCurrentFilterKey=function(){if(this.currentFilterKey)return this.currentFilterKey;var a=URI.getMostRecentURI().getQueryData();if(a&&a.sk){this.currentFilterKey=a.sk;}else if(a&&a.filter){this.currentFilterKey=a.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;};UIIntentionalStream.prototype.resetFilterKey=function(a){this.currentFilterKey=a;};UIIntentionalStream.prototype.loadOlder=function(a){a=a||{};if(!this.oldest)return;var b=this.getCurrentParams();b.oldest=this.oldest;this.refresh(UIIntentionalStream.REFRESH_APPEND,b,a);return this;};UIIntentionalStream.prototype.loadNewer=function(a){if(!this.newest)return;a=a||{};var b=this.getCurrentParams();b.newest=this.newest;if(a.ignoreSelf)b.ignore_self=true;b.load_newer=true;var c=coalesce(a.insertType,UIIntentionalStream.REFRESH_PREPEND);this.refresh(c,b,a);return this;};UIIntentionalStream.prototype.getCurrentParams=function(){var a={},b=URI.getMostRecentURI().getQueryData();b.filter=this.getCurrentFilterKey();var c=this.getValidParams();if(c){c.forEach(function(d){a[d]=b[d];});}else a=b;return a;};UIIntentionalStream.prototype.setHomeFilter=function(a){this._homeFilter=a;};UIIntentionalStream.prototype.setHomeFilterLoading=function(a){if(this._homeFilter)this._homeFilter.setLoading(a);};UIIntentionalStream.prototype.refresh=function(a,b,c){Arbiter.inform(UIIntentionalStreamMessage.UPDATE_LAST_REFRESH_TIME);this.addScrollTrace('refresh',{type:a,data:b,kwargs:c});this.currentFilterKey=b.filter;if(b.filter==UIIntentionalStream.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(UIIntentionalStream.isHighlightsFilter(b.filter)||b.filter===UIIntentionalStream.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;c=c||{};var d=++this.requestNum,e=coalesce(c.showLoader,true),f=this.instanceName,g=function(k){UIIntentionalStream.getInstance(f).handleResponse(d,a,k,c);},h=function(k){UIIntentionalStream.getInstance(f).handleError(d,a,k,c);},i=function(k){UIIntentionalStream.getInstance(f).handleFinally(a,b.filter,k);};if(!(b.request_type=a))b.request_type='none';if(b.filter){c.show_hidden=b.show_hidden?b.show_hidden:false;}else c.show_hidden=this.shouldShowHidden;b=copy_properties(this.getCurrentParams(),b);this.hasPendingRefresh=true;var j;if(a==UIIntentionalStream.REFRESH_APPEND&&e)j=this.pager;new AsyncRequest().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(b).setHandler(g).setStatusElement(j).setErrorHandler(h).setFinallyHandler(i).send();this.cachedScrollQID=0;if(a==UIIntentionalStream.REFRESH_TRANSITION){hide(this.pager);this.clearScrollLoader();this.oldest=this.newest=null;}if(e)this.setHomeFilterLoading(true);};UIIntentionalStream.prototype.addComposerContent=function(a,b){if(this.isOnNewsFeedFilter())CSS.addClass(a,'uiStreamBoulderHighlight');this.addContentPrepend(a,b);};UIIntentionalStream.prototype.addContentPrepend=function(a,b){if(a.length){$A(a).reverse().forEach(function(h){this.addContentPrepend(h,b);}.bind(this));return;}var c,d=Vector2.getScrollPosition().y,e=Vector2.getElementPosition(this.streamContent).y,f=this.scrollOnPrepend&&d>=e;if(f){var g=function(h){var i=DOM.find(h,'^li.uiStreamStory');if(!i)return;DataStore.set(i,'origHeight',i.offsetHeight);Event.listen(h,'load',function(){var j=DataStore.get(i,'origHeight');if(i.offsetHeight!=j){window.scrollBy(0,i.offsetHeight-j);DataStore.set(i,'origHeight',i.offsetHeight);}});};c=animation.insert.curry(this.streamContent,a,(function(h,i){DOM.prependContent(this.streamContent,i);Arbiter.inform('reflow');window.scrollBy(0,i.offsetHeight);DOM.scry(i,'img').forEach(g);}).bind(this));}else c=(function(){CSS.setStyle(a,'opacity',0);ScrollAwareDOM.prependContent(this.streamContent,a);Arbiter.inform('reflow');animation(a).from('opacity',0).to('opacity',1).duration(400).go();}).bind(this);if(b){CSS.hide(a);DOM.appendContent(document.body,a);setTimeout(function(){CSS.show(a);c();},b);}else c();};UIIntentionalStream.prototype.addContentAppend=function(a){DOM.appendContent(this.streamContent,a);};UIIntentionalStream.getStoriesByAssoc=function(a){return DOM.scry(UIIntentionalStream.instance.root,'div.aid_'+a);};UIIntentionalStream.prototype.handleResponse=function(a,b,c,d){this.addScrollTrace('handle_response',{requestnum:a,type:b,kwargs:d});d=d||{};var e=c.getPayload();this.filterNullState&&DOM.remove(this.filterNullState);if(is_empty(e))return;if(e.autoRefreshConfig)Arbiter.inform(UIIntentionalStreamMessage.UPDATE_AUTOREFRESH_CONFIG,e.autoRefreshConfig);this.setHomeFilterLoading(false);if(b==UIIntentionalStream.REFRESH_EXPAND){var f=DOM.find($(d.expandStoryID),'div.UIIntentionalStory_CollapsedStories');CSS.hide(f);CSS.removeClass(f,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)hide(this.error);if(a!=this.requestNum)return;if('show_hidden' in d)this.shouldShowHidden=d.show_hidden;if('newestStoryTime' in e&&e.newestStoryTime>this.newest)this.newest=e.newestStoryTime;if(b!=UIIntentionalStream.REFRESH_PREPEND){if('oldestStoryTime' in e&&(!this.oldest||e.oldestStoryTime<this.oldest))this.oldest=e.oldestStoryTime;if('scrollPosition' in e)this.scrollPosition=e.scrollPosition;if('lastViewStateID' in e)this.lastViewStateID=e.lastViewStateID;if('oldestMRStoryTime' in e)this.oldestMR=e.oldestMRStoryTime;if('cachedScrollQID' in e)this.cachedScrollQID=e.cachedScrollQID;}if(e.html){var g=HTML(e.html).getNodes();switch(b){case UIIntentionalStream.REFRESH_PREPEND:this.addContentPrepend(g);break;case UIIntentionalStream.REFRESH_APPEND:this.addContentAppend(g);this.clearScrollLoader(true);break;case UIIntentionalStream.REFRESH_TRANSITION:DOM.setContent(this.streamContent,g);this.scrollLoadCount=1;var h=this.streamContent.firstChild;if(!d.noScroll)DOMScroll.scrollTo(new Vector2(0,0,"document"),false);break;case UIIntentionalStream.REFRESH_EXPAND:DOM.insertAfter($(d.expandStoryID),g);break;case UIIntentionalStream.DELAYED_STREAM:this.addContentAppend(g);break;}Arbiter.inform(UIIntentionalStreamMessage.UPDATE_HTML_CONTENT);}};UIIntentionalStream.prototype.handleError=function(a,b,c,d){if(a!=this.requestNum)return;this.setHomeFilterLoading(false);var e=c.getError();if(e==1357001)AsyncResponse.defaultErrorHandler(c);if(b==UIIntentionalStream.REFRESH_EXPAND){var f=DOM.find($(d.expandStoryID),'div.UIIntentionalStory_CollapsedStories');CSS.removeClass(f,'UIIntentionalStory_CollapsedStoriesLoading');}if(!d.delayLoadCount&&b!=UIIntentionalStream.REFRESH_PREPEND&&this.error)CSS.setStyle(this.error,'display','block');};UIIntentionalStream.prototype.handleFinally=function(a,b){if(a==UIIntentionalStream.REFRESH_TRANSITION){PageTransitions.transitionComplete();Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;};UIIntentionalStream.prototype.getValidParams=function(){return UIIntentionalStream.VALID_PARAMS;};UIIntentionalStream.prototype.getEndpoint=function(){return UIIntentionalStream.ENDPOINT;};UIIntentionalStream.prototype.getRefreshMethod=function(){return UIIntentionalStream.REFRESH_METHOD;};UIIntentionalStream.prototype.isOnNewHighlights=function(){var a=this.getCurrentFilterKey();return (UIIntentionalStream.isHighlightsFilter(a)||(a==UIIntentionalStream.FEED_FILTER_KEY_DUAL_NEWS_FEED&&UIIntentionalStream.isHighlightsFilter(this.defaultFilter)));};UIIntentionalStream.prototype.isLiveStreamBox=function(){var a=this.getCurrentFilterKey();return a&&a.indexOf(UIIntentionalStream.FEED_FILTER_KEY_LIVE_STREAM_BOX)==0;};UIIntentionalStream.prototype.isOnNewsFeedFilter=function(){var a=this.getCurrentFilterKey();return (a==UIIntentionalStream.FEED_FILTER_KEY_NEWS_FEED||UIIntentionalStream.isHighlightsFilter(a)||a==UIIntentionalStream.FEED_FILTER_KEY_DUAL_NEWS_FEED);};UIIntentionalStream.prototype.setupAutoInsert=function(){Arbiter.subscribe(UIIntentionalStreamMessage.SET_AUTO_INSERT,UIIntentionalStream.setAutoInsert);};UIIntentionalStream.setAutoInsert=function(a,b){if(a!=UIIntentionalStreamMessage.SET_AUTO_INSERT)return;var c=UIIntentionalStream.instance;if(c)c.pauseAutoInsert=b.pause;};UIIntentionalStream.prototype.isAutoRefreshPaused=function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;};UIIntentionalStream.prototype.addScrollTrace=function(a,b){this.jslog.debug(a,b);};UIIntentionalStream.prototype.refreshStream=function(a,b){if(a!=UIIntentionalStreamMessage.REFRESH_STREAM)return;var c=this.getCurrentFilterKey(),d={filter:c},e={filter:c};b.noScroll&&(e.noScroll=1);this.refresh(UIIntentionalStream.REFRESH_TRANSITION,d,e);};copy_properties(UIIntentionalStream,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php'});
function FutureHomeSideNav(){this.parent.construct(this);}Class.extend(FutureHomeSideNav,'FutureSideNav');copy_properties(FutureHomeSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(Arbiter.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');this._initPageletCache();},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController('pagelet_navigation',this);if(this._cache){this._cache.registerCleanup('HomeNav/cleanup');onleaveRegister(function(){Arbiter.inform('HomeNav/cleanup');});}}},initMoreLink:function(a){this._eventHandlers.push(Event.listen(a,'click',this._showMoreSections.bind(this,a)));},_showMoreSections:function(a){var b=DOM.scry(this.root,'div.belowThreshold');CSS.hide(a);b.forEach(function(c){CSS.removeClass(c,'belowThreshold');});},handleFixedFrameChanged:function(a,b,c){if(b){var d=function(e,f){UIPagelet.loadFromEndpoint(e,f,{fixed_frame:b,selected_key:c});};d('PinnedNavigationPagelet','pagelet_pinned_nav');d('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(ge('chatFriendsOnline'))CSS.hide(ge('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;},handlePageTransition:function(a){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return this.parent.handlePageTransition(a);},_initSection:function(a){var b=this.parent._initSection(a);for(var c in this.typeSections){var d=this.typeSections[c];if(b.id==d){var e=DOM.scry(b.node,'div.navHeader')[0];if(e){var f='\/bookmarks\/('+c+')(\/)?';b.seeall=this._initItem({node:e,id:b.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:f}]});}}}return b;},_constructItem:function(a,b){return new FutureHomeSideNavItem(a,b);},_constructSection:function(a){return new FutureHomeSideNavSection(a);},getSection:function(a){return this.typeSections[a]&&this.sections[this.typeSections[a]];},_getItemForKey:function(a){var b=this.parent._getItemForKey("nf");if(b&&b.matchKey(a)){return b;}else return this.parent._getItemForKey(a);},_isCurrentPath:function(a){return ((a.getDomain()===this.uri.getDomain())&&(a.getPath()==='/'||a.getPath()==='/home.php'));},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'favorite')){Arbiter.inform(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,{key:b.numericKey,favorite:!a.equals(this.getSection("favorites")),movetop:CSS.hasClass(c,'movetop')});}else this.parent._handleMenuClick(a,b,c,event);},removeItemByKey:function(a){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_REMOVED,a);this.parent.removeItemByKey(a);},toggleItemByKey:function(a,b){var c=this.getNodeForKey(a);if(!b){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_HIDDEN,a);c&&CSS.hide(c);}else c&&CSS.show(c);var d=this._getItemForKey(a);this.getSection(d.type).refresh();},removeItem:function(a){var b=this.getSection(a.type);this.parent.removeItem(a);b.refresh();},updateFavorite:function(a,b){var c=this._findItem(function(l){return l.matchKey(b.key)&&l.canFavorite();}),d=this.getSection("favorites"),e=bagofholding,f=b.favorite?d.addEndpoint:d.removeEndpoint;if(b.movetop)f=d.editEndpoint;if(!c&&(b.favorite||b.movetop)){if(b.movetop)var g=DOM.scry(this.root,'.expandableSideNav'),h=g&&g.length&&CSS.hasClass(g[0],'expandedMode');e=function(){UIPagelet.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:h});};}else if(!c){e=function(){UIPagelet.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(b.movetop){CSS.show(c.node);this.moveItem(d,c);var i=Parent.byClass(c.node,'uiSideNav');if(i&&i.childNodes.length){var j=Parent.byClass(DOM.scry(i,'.sortableItem')[0],'sideNavItem');DOM.insertBefore(j,c.node);CSS.removeClass(c.node,'hidden');}}else{var k=this.getSection(c.type);if(b.favorite){CSS.show(c.node);this.moveItem(d,c);c.showFavorite();}else if(!k.equals(d)){this.moveItem(k,c);c.hideFavorite();}else this.removeItem(c);k.refresh();}d.refresh();b.key=c.numericKey;Arbiter.inform('NavigationMessage.FAVORITES_UPDATED');}new AsyncRequest().setURI(f).setData({id:b.key,movetop:b.movetop}).setHandler(e).send();},_doPageTransition:function(a,b){this._unloadStreams();var c=this.parent._doPageTransition(a,b);if(c&&(a.type=='groups'||a.type=='lists'||a.type=='interests')){a.setCount(0);a.hideUnreadDot();}return c;},_unloadStreams:function(){var a=window.UIIntentionalStream&&UIIntentionalStream.instances,b=['nile','global','friends','blade'];a&&b.forEach(function(c){a[c]&&a[c].unload();});},navigationFirstResponse:function(){this.setSelected(this.loading);}});function FutureHomeSideNavSection(a){this.parent.construct(this,a);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}Class.extend(FutureHomeSideNavSection,'FutureSideNavSection');copy_properties(FutureHomeSideNavSection.prototype,{refresh:function(){var a=DOM.scry(this.node,'li.sideNavItem'),b=DOM.scry(this.node,'div.actionLinks'),c=a.some(CSS.shown);CSS.conditionShow(DOM.find(this.node,'div.navHeader'),c);b.length&&CSS.conditionShow(b[0],c);}});function FutureHomeSideNavItem(a,b){this.parent.construct(this,a,b);}Class.extend(FutureHomeSideNavItem,'FutureSideNavItem');copy_properties(FutureHomeSideNavItem.prototype,{canFavorite:function(){return !!this._getFavoriteLabel();},showFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"\u0625\u0632\u0627\u0644\u0629 \u0645\u0646 \u0627\u0644\u0645\u0641\u0636\u0644\u0627\u062a");},hideFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"\u0625\u0636\u0627\u0641\u0629 \u0625\u0644\u0649 \u0627\u0644\u0645\u0641\u0636\u0644\u0627\u062a");},hideUnreadDot:function(){var a=DOM.scry(this.node,'img.unreadDot')[0];a&&CSS.hide(a);},_getFavoriteLabel:function(){return DOM.scry(this.node,'li.favorite span.itemLabel')[0];}});
__d("FeedTrackingAsync",["event-extensions","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('collectDataAttributes'),h=b('copyProperties');function i(j){Event.listen(j,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=g(k,['ft']);h(m,n);});}e.exports={init:i};});
__d("TickerController",["Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","ContextualDialogX","CSS","DOM","HTML","Keys","LayerFadeOnHide","LiveTimer","NavigationMessage","OptimisticUFI","Parent","ScrollableArea","Selector","Run","Toggler","UIPagelet","UserActivity","URI","UserAgent","Vector","$","collectDataAttributes","copyProperties","ge","goURI","throttle","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('ContextualDialogX'),n=b('CSS'),o=b('DOM'),p=b('HTML'),q=b('Keys'),r=b('LayerFadeOnHide'),s=b('LiveTimer'),t=b('NavigationMessage'),u=b('OptimisticUFI'),v=b('Parent'),w=b('ScrollableArea'),x=b('Selector'),y=b('Run'),z=b('Toggler'),aa=b('UIPagelet'),ba=b('UserActivity'),ca=b('URI'),da=b('UserAgent'),ea=b('Vector'),fa=b('$'),ga=b('collectDataAttributes'),ha=b('copyProperties'),ia=b('ge'),ja=b('goURI'),ka=b('throttle'),la=b('userAction');function ma(sa,ta){la(sa,null,null,'FORCE',ta);}var na=1,oa=2,pa=3,qa=4;function ra(){}ha(ra,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(sa){var ta=v.byClass(fa(sa),'fbFeedTicker');return ta?ra._instances[ta.id]:null;},isLoaded:function(sa){var ta=ra._placeholders[sa.id];return !ta||ta.status==pa;},show:function(sa,ta){ta=ta||bagofholding;for(var ua in ra._instances){var va=ia(ua);if(!va||va.parentNode.id==sa.id)continue;ra.hide(va.parentNode);}ra._doPositionChange(sa);n.show(sa);var wa=ra._placeholders[sa.id];if(wa&&wa.status==na){ra._fetchTickerForPlaceholder(sa,ta);}else{var xa=o.scry(sa,'.fbFeedTicker')[0],ya=xa&&ra.getInstance(xa);ra._activeInstance=ya;ya&&ya._poll();ra._placeholders[sa.id]={status:qa,callback:ta};ta();}},_doPositionChange:function(sa){if(!ra._logPositionChange||n.shown(sa))return;new j('/common/ods_endpoint.php',{k:'ticker.render.switch.'+sa.id}).send();},hide:function(sa){var ta=o.scry(sa,'.fbFeedTicker')[0],ua=ta&&ra.getInstance(ta);ua&&ua.hideActiveStory();n.hide(sa);},hideStoriesByClass:function(sa){for(var ta in ra._instances)o.scry(fa(ta),sa).forEach(n.hide);},hideStory:function(sa){var ta=sa&&ra.getInstance(sa);ta&&ta.hideStory(sa);},undoHideStory:function(sa){var ta=sa&&ra.getInstance(sa);ta&&ta.undoHideStory(sa);},insertStoriesAtBottom:function(sa){ra._activeInstance.insertStoriesAtBottom(sa);},_fetchTickerForPlaceholder:function(sa,ta){var ua={handler:function(){ra._placeholders[sa.id].status=pa;ta();}};aa.loadFromEndpoint('TickerPagelet',sa.id,ra._placeholders[sa.id].pageletData,ua);ra._placeholders[sa.id].status=oa;},registerStoryDialog:function(sa,ta){h.subscribe('ticker/init',function(){var ua=ia(sa),va=ua&&ra.getInstance(ua);va&&va.registerStoryDialog(ua,ta);},h.SUBSCRIBE_ALL);},registerPlaceholder:function(sa,ta){var ua=ra._placeholders[sa];ra._placeholders[sa]={status:na,pageletData:ta};if(ua&&ua.status==qa){ra.show(fa(sa));ua.callback();}}});ha(ra.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(sa,ta,ua){ra._instances[sa.id]=this;ra._activeInstance=this;this._root=sa;this._content=o.find(sa,'.ticker_stream');this._stories=o.find(this._root,'.tickerActivityStories');this._scrollableArea=ta;this._container=o.find(sa,'div.uiScrollableAreaWrap');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var va=Date.now();this._initTime=va;this._lastUpdate=va;this._lastPull=va;this._lastInsert=va;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=o.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!v.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();this._ua={flyout:la('ticker_flyout').set_namespace('ticker').set_ua_id('flyout'),flyout_prefetch:la('ticker_flyout_prefetch').set_namespace('ticker').set_ua_id('flyout_prefetch'),flyout_loadtime:la('ticker_flyout_loadtime').set_namespace('ticker').set_ua_id('flyout_loadtime'),stream:la('ticker_stream').set_namespace('ticker').set_ua_id('stream')};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var wa=o.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=wa;o.appendContent(this._root,wa);this._initObjectIDs();this._initPageletCache(ua);this._initConfig(ua);this._resetMorePager();this._initListeners();this._initSubscriptions(ua);h.inform('ticker/init',this,h.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}},_loadStoriesWithActions:function(){var sa=ia('rightCol');if(!sa)return;this._toggleWrapper=o.scry(sa,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var ta=o.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var ua=0;ua<ta.length;ua++){var va=ta[ua];this._storiesWithActions[va.getAttribute('data-story-key')]=va;}}},_initPageletCache:function(sa){if(window.PageletCacheController){this._cache=window.PageletCacheController.registerController(this._root.parentNode.id,this);if(this._cache){ha(sa,this._cache.loadData());this._cache.registerCleanup('Ticker/cleanup');}}},_initConfig:function(sa){ha(this,{_newest:sa.newest,_page_newest:sa.newest,_timeout:sa.timeout,_heartbeatTimeout:Math.max(15000,sa.heartbeatTimeout),_pullTimeout:Math.max(30000,sa.pullTimeout),_insertTimeout:sa.insertTimeout,_friendCount:sa.friendCount,_maxQueueLength:sa.maxQueueLength,_heartbeatEndpoint:sa.heartbeatEndpoint,_noPoll:sa.nopoll,_maxCustomQueueLength:sa.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,sa.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:sa.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(sa.insertTimeout,sa.minForceUpdateInterval),_popupOnHover:sa.popupOnHover,_priorityAppId:sa.priorityAppId,_prefetchOnHover:sa.prefetchStoriesOnHover,_userIdleTimeout:sa.userIdleTimeout,_firstCustomStoryDelay:sa.firstCustomStoryDelay,_pollOnly:sa.pollOnly,_tickerDebug:sa.tickerDebug,_tickerSource:sa.tickerSource,_prefetchAfterLoad:sa.prefetchAfterLoad,_logFlyouts:sa.logFlyouts,_userScrollGaurdDelay:sa.userScrollGaurdDelay,_rescheduleScrollToTopDelay:sa.rescheduleScrollToTopDelay,_aggressiveRegulator:sa.aggressiveRegulator});this._queueCustomStories(sa.customStories);},_initListeners:function(){this._listeners=Event.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=Event.listen(this._container,'scroll',ka(this._handleScroll.bind(this)));this._initInfiniteScrollListener.bind(this).defer();},_initSubscriptions:function(sa){y.onLeave(this._cleanup.bind(this));this._subscriptions=[h.subscribe(t.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),h.subscribe(l.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)),h.subscribe('composer/publish',this._handleComposerPublish.bind(this)),h.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),h.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),h.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),h.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),h.subscribe(u.COMMENT_SEND_EVENT,this._scrollDialogToBottom.bind(this)),h.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(sa.pushChannel)this.setPushChannel(sa.pushChannel);},_handleClick:function(event){var sa=event.getTarget();if(this._getButtonFromNode(sa)){this._logUserAction(sa,'click',event);this._handleActionButton(event);return;}var ta=this._getStoryFromNode(sa),ua=v.byClass(sa,'tickerStoryAllowClick');if(!ta||ta==this._selectedStory||ua)return;if(this._storyIsHidden(ta))return;if(ta==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(ta)){var va=ta.getAttribute('data-href');if(va&&!sa.getAttribute('href')){var wa={href:va},xa=ga(sa,['ft','gt']);la('click',wa,event,'FORCE',xa);}else this._logUserAction(sa,'click',event);this._openStoryExternally(ta,event);return;}this._logUserAction(sa,'flyout',event);this._activateStory(ta,'click');this._selectStory(ta);},_handleMouseover:function(event){this._setLocked(true);var sa=event.getTarget(),ta=this._getOpenableStory(sa);if(!ta)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(ta.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=ta.id;}this._fetchStory(ta);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var ua=this._storyCanOpenExternally(ta)?500:1000,va=this._activeStory?75:ua;if(!window.addEventListener&&document.createEventObject)event=document.createEventObject(event);this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',va);this._logUserEvent('flyout_loadtime','open');this._activateStory(ta,'hover');this._logUserAction(sa,'flyout',event);}.bind(this),va);}},_handleMouseout:function(event){var sa=event.getTarget();this._setLocked(false);if(sa==this._getStoryFromNode(sa)){var ta=o.scry(sa.parentNode,'.openToggler');for(var ua=0;ua<ta.length;ua++)x.toggle(ta[ua]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var sa=this._activeStory;if(!sa)return;var ta=Event.getKeyCode(event);switch(ta){case q.UP:case q.DOWN:var ua=this._getInsertedStories(),va;if(event.getModifiers().any){va=ta===q.UP?0:ua.length-1;}else va=ua.indexOf(sa)+(ta===q.UP?-1:1);sa=ua[va];break;case q.ESC:this._deactivateStory(true);return;default:return;}if(!sa)return;event.kill();this._activateStory(sa,'keypress');this._selectStory(sa);},_fadeTopmostStoryButton:function(){var sa=0,ta=15;if(this._storiesWithActions)for(var ua in this._storiesWithActions){var va=this._storiesWithActions[ua],wa=o.scry(va,'.tickerInlineActionButton')[0],xa=o.scry(wa,'.tickerActionIcon')[0],ya=ea.getElementPosition(wa).y-ea.getElementPosition(this._toggleWrapper).y;if(ya<sa){n.setStyle(wa,'opacity',0);n.setStyle(xa,'opacity',0);}else if(ya>=sa&&ya<ta){var za=(ya-sa)/(ta-sa);n.setStyle(wa,'opacity',za);n.setStyle(xa,'opacity',za);break;}else{n.setStyle(wa,'opacity',1);n.setStyle(xa,'opacity',1);}}},_handleScroll:function(){this._fadeTopmostStoryButton();!this._preventScrollDismiss&&this._deactivateStory(true);this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var sa=this._stories.childNodes.length,ta=this._stories.getAttribute('data-gt'),ua={ticker_scroll:1,number_stories:sa,source:ta};ma('scroll',{gt:ua});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();this._scrollableArea.adjustGripper();this._logUserEvent('stream','insert');},_handleActionButton:function(event){var sa=event.getTarget(),ta=this._getButtonFromNode(sa),ua=this._getOpenableStory(sa),va=this._getStoryDialog(ua);if(va)var wa=va.subscribe('beforehide',function(){va.unsubscribe(wa);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(sa){new g(this._container).to('scrollTop',0).ease(g.ease.end).ondone(sa).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return o.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(sa){return !n.hasClass(sa,'queuedStory')&&!n.hasClass(sa,'customStory');});},_getQueuedStories:function(){return o.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return o.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(sa){return v.byClass(sa,'tickerInlineOverlay');},_getStoryFromNode:function(sa){return v.byClass(sa,'fbFeedTickerStory');},_getActionButtonFromStory:function(sa){return o.scry(sa,'.tickerInlineActionButton')[0];},_getOpenableStory:function(sa){var ta=this._getStoryFromNode(sa);return this._storyCanOpenDialog(ta)?ta:null;},_getStoryDialog:function(sa){return window.ContextualDialogX&&m.getInstance(sa)||null;},_getStoryDialogEndpoint:function(sa){return sa&&sa.getAttribute('data-rel')=='async'&&sa.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(sa){return !!this._getStoryDialogEndpoint(sa)&&!this._storyIsHidden(sa);},_storyCanOpenExternally:function(sa){return !!sa.getAttribute('data-href')||!this._storyCanOpenDialog(sa);},_storyIsHidden:function(sa){return n.hasClass(sa,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(sa){this._deactivateStory();n.addClass(sa,'tickerStoryHidden');n.removeClass(sa,'tickerStoryClickable');},undoHideStory:function(sa){n.addClass(sa,'tickerStoryClickable');n.removeClass(sa,'tickerStoryHidden');},insertStoriesAtBottom:function(sa){if(!sa)return;var ta=o.create('div');ta.appendChild(sa);var ua=o.scry(ta,'.fbFeedTickerStory'),va=o.find(ta,'.tickerMorePager'),wa=[];for(var xa=0;xa<ua.length-1;xa++)if(!this.dedupeStory(ua[xa]))wa.push(ua[xa]);if(wa.length){wa.push(va);o.replace(o.find(this._root,'.tickerMorePager'),wa);}h.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(sa){this._scrollTopPromptVisible=sa;n.conditionShow(this._scrollTopPrompt,sa);if(sa&&!this._listeners.scrollTop){this._listeners.scrollTop=Event.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!sa&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !ba.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){this._debug('poll');if(!this._isTickerVisible()){this._debug('not polling: ticker not visible');return;}if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var sa=this._storiesToRemove.pop();this.removeStory(sa);}if(this._isUserIdle()){this._debug('not polling: idle');return ba.subscribeOnce(this._poll.bind(this));}var ta=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(ta);var ua=Date.now(),va=ua-this._lastInsert;if(va<this._insertTimeout||this._isLocked())return this._schedulePoll();var wa=this._getQueuedStories(),xa=this._getQueuedCustomStories(),ya=wa.length>0,za=xa.length>0&&(ua-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!ya&&(ua-this._lastCustomStory)>this._customStoryInsertTimeout));if(za){this.insertStory(xa.shift());this._lastCustomStory=ua;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;this._debug('not polling: should insert custom story');return this._schedulePoll();}if(ya){this.insertStory(wa.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;this._debug('not polling: should insert story');return this._schedulePoll();}var ab=xa.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&ba.isActive(this.ADS_IDLE_MS)&&((ua-this._lastUpdate)>this._minForceUpdateInterval),bb=false,cb=false;if(this._pollOnly){cb=ua-this._lastUpdate>this._heartbeatTimeout;}else bb=(ua-this._lastPull>this._pullTimeout);var db=(ab&&this._doCustomUpdate)||bb||cb;if(!db)return this._schedulePoll();if(ab)this._doCustomUpdate=false;this._debug('polling for new stories');this.update({pull:bb,fullpoll:cb,needcustomstory:ab});},update:function(sa){if(this._noPoll&&!this._pollOnly){this._debug('not updating - in no poll mode');return this._schedulePoll();}var ta={newest:(sa.fullpoll||sa.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};ha(ta,sa);new i().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(ta).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(ta.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(sa,ta,ua){this._lastInsert=Date.now();window.LiveTimer&&s.addTimeStamps(sa);n.removeClass(sa,'queuedStory');n.removeClass(sa,'customStory');if(ta!==false){var va=ua?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var wa=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(sa,wa);this._debug("insertStory: scheduled a scroll to top");}else this._scrollToTop(va.bind(this,sa));}else o.prependContent(this._stories,sa);if(this._storiesWithActions&&n.hasClass(sa,'tickerStoryWithButton'))this._storiesWithActions[sa.getAttribute('data-story-key')]=sa;this._removeOldStories();},_removeOldStories:function(){var sa=this._getInsertedStories();if(sa.length<=this._maxStoriesToKeep)return;var ta=this._minStoriesToKeep,ua=sa.slice(ta);ua.forEach(o.remove);if(this._storiesWithActions)for(var va=0;va<ua.length;va++)delete this._storiesWithActions[ua[va].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var sa=this._getInsertedStories();if(!sa||!sa.length)return;var ta=sa[sa.length-1].getAttribute('data-ticker-timestamp'),ua=o.scry(this._root,'.tickerMorePager a')[0];if(!ua||!ta)return;var va=new ca(ua.getAttribute('ajaxify'));va.addQueryData({oldest:ta});ua.setAttribute('ajaxify',va);},_setLocked:function(sa){this._locked=sa;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(sa,ta,ua){var va=this._getStoryFromNode(sa),wa=va.getAttribute('data-story-key');o.setContent(va,ta);n.addClass(va,'highlightedStory');this._setTimeout(this.removeStory.bind(this,wa),ua||6000);},_getStoryByStoryKey:function(sa){var ta=this._getAllStories();for(var ua=0;ua<ta.length;ua++){var va=ta[ua];if(va.getAttribute('data-story-key')==sa)return va;}return null;},removeStory:function(sa){this._removedStoryIDs[sa]=true;var ta=this._getStoryByStoryKey(sa);if(!ta)return;if(this._storiesWithActions)delete this._storiesWithActions[sa];if(ta==this._activeStory)this._deactivateStory();var ua=this._getStoryDialog(ta);ua&&ua.destroy();if(n.hasClass(ta,'queuedStory')){o.remove(ta);return;}this._animateStoryOut(ta);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(sa){var ta=o.create('div',{style:{marginTop:'-1000px'}},sa);n.setStyle(ta,'opacity',0);o.prependContent(this._stories,ta);var ua=ea.getElementDimensions(ta).y;n.setStyle(ta,'marginTop','-'+ua+'px');this._isInsertingStory=true;new g(ta).to('marginTop',0).ease(g.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){o.replace(ta,sa);this._afterInsert(sa);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(sa,ta){new g(this._stories).to('opacity',.5).ondone(function(){o.prependContent(this._stories,sa);if(ta)ta();new g(this._stories).to('opacity',1).ondone(function(){this._afterInsert(sa);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(sa){var ta=o.create('div',{style:{overflow:'hidden',position:'relative'}});o.insertBefore(sa,ta);o.appendContent(ta,sa);new g(ta).to('top',20).to('height',0).to('opacity',0).ease(g.ease.end).ondone(function(){o.remove.curry(ta);h.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(sa){h.inform('Ticker/afterInsert');},setPushChannel:function(sa){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=h.subscribe(l.getArbiterType(sa),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(ta,ua){this._channelConnection=ua;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){n.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(sa){this._priorityAppId=sa;},_handleTickerPush:function(sa,ta){var ua=ta.obj;if(ua.delete_id){this._storiesToRemove.push(ua.delete_id);return;}if(ua.fromups){this._debug('discarding story: dark launch');if(ua.do_logging)this._logDarkLaunch(ua);}var va=ua.story_xhp;if(!va){this._debug('discarding story: no markup');return;}this._newest=ua.story_time;var wa=p(va).getRootNode();this.queueStory(wa,ua.flyout_js_cmds);if(this._aggressiveRegulator&&ua.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new j('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:ua.actor,storyKey:wa.getAttribute('data-story-key')};},_handleComposerPublish:function(sa,ta){ta.tickerMarkup&&this.insertStory(ta.tickerMarkup);},_clearNux:function(){var sa=o.scry(document.body,'div.tickerNUXContainer');if(sa.length){sa.forEach(function(ta){var ua=m.getInstance(ta);ua&&ua.hide();});new i().setURI('/ajax/feed/ticker/nux.php').send();}this._clearNux=bagofholding;},_logDarkLaunch:function(sa){var ta={actor:sa.actor,story_time:sa.story_time,key:sa.story_obj_id,dark:1};new i().setURI('/alite/push/log.php').setData({msg:JSON.stringify(ta)}).send();},_logRender:function(){if(this._loggedRender)return;var sa=this._tickerInSidebarMode;if(sa||v.byClass(this._content,'home_right_column')){new j('/ajax/log_ticker_render.php',{sidebar_mode:sa}).send();this._loggedRender=true;}},_isTickerVisible:function(){var sa=(ra._activeInstance==this);sa&&this._logRender();return sa;},_handleResponse:function(sa){var ta=sa.getPayload();if(ta.newest)this._newest=this._page_newest=ta.newest;if(ta.content)if(ta.cache_update&&this._cache){this._cache.insertStory(ta.content);}else if(ta.content instanceof Array){for(var ua=0;ua<ta.content.length;ua++)this.queueStoryMarkup(ta.content[ua]);}else this.queueStoryMarkup(ta.content);if(ta.custom_stories&&ta.custom_stories.length){this._queueCustomStories(ta.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(sa){var ta=p(sa).getRootNode();this.queueStory(ta);},dedupeStory:function(sa){var ta=sa.getAttribute('data-story-key'),ua=ta&&(!!this._objectIDs[ta]||!!this._removedStoryIDs[ta]);if(ua)this._debug('discarding story: duplicated object id');ta&&(this._objectIDs[ta]=true);return ua;},queueStory:function(sa,ta){if(this.dedupeStory(sa))return;n.addClass(sa,'queuedStory');o.appendContent(this._storyQueue,sa);var ua=ta&&ta.length;if(ua)ta.forEach(function(wa){new Function(wa).apply();});sa.setAttribute('id',sa.id+'_'+this._root.id);var va=this._getQueuedStories();va.slice(0,-this._maxQueueLength).forEach(o.remove);if(ua)this._fetchedStories[sa.id]=true;},_queueCustomStories:function(sa){while(sa.length){var ta=sa.shift();ta=p(ta).getRootNode();var ua=ta.getAttribute('data-story-key');if(this.dedupeStory(ta))continue;n.addClass(ta,'customStory');o.appendContent(this._storyQueue,ta);}var va=this._getQueuedCustomStories();va.slice(0,-this._maxQueueLength).forEach(o.remove);},_cleanup:function(){ra._placeholders.pagelet_rhc_ticker=null;if(!v.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(h.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var sa in this._listeners)this._listeners[sa]&&this._listeners[sa].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();h.inform('Ticker/cleanup');},_onNavHandler:function(sa,ta){var ua=ta.params.key;if(ua!='lf'&&ua!='h')this._cleanup();},registerStoryDialog:function(sa,ta){if(this._uaCurStoryIDFetch==sa.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==sa.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[sa.id]=true;ta.setContext(sa);ta.subscribe('hide',this._deactivateStory.bind(this,true));ta.subscribe('success',this._focusStory.bind(this,sa));ta.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){ta.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));ta.subscribe('mouseleave',this._scheduleHide.bind(this));ta.subscribe('show',function(){this._highlightDialogScrollbar.bind(this,ta).defer();var ua=Event.listen(ta.getContent(),'click',function(){this._selectStory(sa);ua.remove();}.bind(this));}.bind(this));}if(sa==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(ta);}},_highlightDialogScrollbar:function(sa){var ta=o.scry(sa.getContent(),'.uiScrollableArea')[0];ta&&w.poke(ta);},_openStoryExternally:function(sa,event){var ta=sa.getAttribute('data-href');if(!ta||ta=='#')return;var ua=sa.getAttribute('data-story-rel');switch(ua){case 'theater':this._deactivateAndClearStory();k.loadModules(['PhotoViewer'],function(xa){xa.bootstrap(ta,sa);});return;case 'async':this._deactivateAndClearStory();i.bootstrap(ta,sa);return;}var va=sa.getAttribute('data-target'),wa=(event.which!=1||event.getModifiers().any||va=='_blank');wa?window.open(ta,'_blank'):ja(ta);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStory:function(sa){clearTimeout(this._scrollDismissal);this._preventScrollDismiss=true;this._scrollDismissal=this._setTimeout(function(){this._preventScrollDismiss=false;}.bind(this),100);sa.focus();},_selectStory:function(sa){this._selectedStory=sa;n.addClass(sa,'tickerStorySelected');n.addClass(this._root,'tickerChildSelected');},_activateStory:function(sa,ta){this._clearHoverTimeouts();if(sa==this._activeStory||!this._storyCanOpenDialog(sa))return;this._deactivateStory();this._focusStory(sa);this._activeStory=sa;n.addClass(sa,'tickerStoryActive');window.Toggler&&z.hide();if(this._logFlyouts){ta=ta||'unknown';new j('/ajax/feed/ticker/flyout.php',{src:ta}).send();}var ua=this._getStoryDialog(sa);if(ua){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(ua);return;}if(!(sa.id in this._fetchedStories)){this._uaCurStoryIDFetch=sa.id;this._logUserEvent('flyout','fetch');}this._fetchStory(sa);},_deactivateStory:function(sa){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(sa===true){this._dialog.enableBehavior(r);}else this._dialog.disableBehavior(r);this._dialog.hide();this._logUserEvent('flyout','close');}if(this._activeStory){n.removeClass(this._activeStory,'tickerStoryActive');n.removeClass(this._activeStory,'tickerStorySelected');n.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(sa,ta,event){la(ta,sa,event,'FORCE',null);},_logUserEvent:function(sa,event){if(this._ua[sa])this._ua[sa].add_event(event);},_fetchStory:function(sa){clearTimeout(this._fetchToken);var ta=[],ua=this._getInsertedStories(),va=ua.indexOf(sa);[-1,0,1].forEach(function(wa){var xa=ua[va+wa];xa&&ta.push(xa);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,ta),100);},_fetchStories:function(sa){var ta=[],ua,va=function(wa){clearTimeout(ua);sa.forEach(function(xa){n.conditionClass(xa,'tickerStoryFetching',wa);});};sa=sa.filter(function(wa){if(wa.id in this._fetchedStories)return false;this._fetchedStories[wa.id]=true;var xa=this._getStoryDialogEndpoint(wa),ya=ca(xa).getQueryData();if(!xa||!ya)return false;ya.uniq_id=wa.getAttribute('id');ya.referrer=this._tickerSource;ta.push(ya);return true;},this);if(!ta.length)return;ua=this._setTimeout(va.curry(true),500);new i('/ajax/feed/ticker/multi_story').setFinallyHandler(va.curry(false)).setErrorHandler(bagofholding).setData({stories:ta}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var sa=event.getTarget(),ta=v.byTag(sa,'a'),ua=this._getStoryFromNode(sa),va=this._getButtonFromNode(sa);if(ua&&ta&&!va&&n.hasClass(ua,'tickerStoryClickable')&&!n.hasClass(ta,'tickerStoryAllowClick')&&!this._storyIsHidden(ua)){ta.setAttribute('rel','ignore');ta.removeAttribute('onclick');ta.removeAttribute('ajaxify');ta.removeAttribute('href');}var wa=(event.button==2),xa=ua&&this._getActionButtonFromStory(ua);if(!wa&&xa)this._setClickedStory(ua);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(sa){this._clearClickedStory();n.addClass(sa,'tickerStoryClicked');this._clickedStory=sa;},_clearClickedStory:function(){if(this._clickedStory){n.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var sa=this._getInsertedStories();if(this._storiesWithActions)for(var ta=0;ta<sa.length;ta++){var ua=sa[ta];if(n.hasClass(ua,'tickerStoryWithButton'))this._storiesWithActions[ua.getAttribute('data-story-key')]=ua;}var va=Math.max(0,sa.length-this._autoloadStoryIndex);this._infiniteScrollStory=sa[va];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var sa=ea.getElementPosition(this._infiniteScrollStory).y,ta=ea.getElementPosition(this._container).y+ea.getElementDimensions(this._container).y;if(sa<ta){var ua=o.scry(this._root,'.tickerMorePager a')[0];if(ua){var va=v.byClass(ua,'stat_elem')||ua,wa=new i(ua.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(ua).setStatusElement(va).setAllowCrossPageTransition(true).send();this._logUserEvent('stream','scroll');}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(sa){if(!this._selectedStory)return;var ta=this._getStoryDialog(this._selectedStory);if(ta){ta.setFixed(sa);ta.updatePosition();}},_setTimeout:function(sa,ta){return setTimeout(sa,ta,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var sa=this._dialog&&this._dialog.getContent(),ta=sa&&o.scry(sa,'.uiScrollableAreaWrap')[0],ua=ta&&w.getInstance(ta);ua&&ua.scrollToBottom();},_openDialog:function(sa){this._dialog=sa.show();this._updateDialogPosition();this._writeSwfFrame(sa);this._initCommentFocusListener.bind(this).defer();this._initContentResizeListener.bind(this).defer();this._stupidIE7VideoResizeHack(sa);},_stupidIE7VideoResizeHack:function(sa){if(da.ie()===7){var ta=o.scry(sa.getContent(),'.uiVideoThumb .img');ta.forEach(function(ua){n.setStyle(ua,'width','');});}},_updateDialogPosition:function(){var sa=this._tickerInSidebarMode||!!v.byClass(this._root,'fixed_elem');this._dialog.setFixed(sa);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(sa){var ta=this._dialog&&this._dialog.getContent(),ua=o.scry(ta,'.swfObject')[0];if(!ua)return;var va=ua.getAttribute('data-swfid');if(va&&window[va]){var wa=window[va];wa.write(ua);}},_initCommentFocusListener:function(){var sa=this._dialog&&this._dialog.getContent(),ta=sa&&o.scry(sa,'.tickerDialogFooter textarea')[0];if(!ta)return;this._listeners.inputFocus=Event.listen(ta,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var sa=this._dialog&&this._dialog.getContent();if(!sa)return;this._listeners.contentResize=Event.listen(sa,'click',function(){this._dialog.updatePosition.bind(this._dialog).defer();}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var sa=this._dialog&&this._dialog.getContent(),ta=sa&&o.scry(sa,'.uiScrollableAreaWrap')[0];if(!ta)return;var ua=ea.getElementDimensions(ta),va=ea.getElementPosition(ta),wa=o.scry(ta,'.uiUfi .uiUfiComment'),xa=ea.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,ya=Math.min(this.FLYOUT_MAX_HEIGHT,xa),za=ya-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var ab=0;ab<wa.length;ab++){var bb=wa[ab],cb=ea.getElementPosition(bb),db=cb.y-va.y;if(Math.abs(db-za)<=this.FLYOUT_OFFSET_THRESHOLD){za=db+this.FLYOUT_COMMENT_OFFSET;break;}}if(ua.y>za){n.setStyle(ta,'height',za+'px');n.setStyle(ta,'max-height',null);}else{n.setStyle(ta,'max-height',ya+'px');n.setStyle(ta,'height',null);}},_initObjectIDs:function(){var sa=this._getAllStories();for(var ta=0;ta<sa.length;++ta){var ua=sa[ta].getAttribute('data-story-key');ua&&(this._objectIDs[ua]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},_debug:function(sa){this._tickerDebug&&false;},getNewest:function(){return this._newest;}});e.exports=ra;});
__d("legacy:TickerController",["TickerController"],function(a,b,c,d){a.TickerController=b('TickerController');},3);
function HomeTickerFirstRightColumnController(){}copy_properties(HomeTickerFirstRightColumnController.prototype,{_isFixed:false,_forcedStatic:false,_PADDING_RHC_TO_BOTTOM:75,_PADDING_RHC_TO_BOTTOM_SHORT:50,_TOP_PADDING:15,_refreshOn:false,_fixAdsOnScroll:false,init:function(a){copy_properties(this,{_adsRefreshInterval:a.adsRefreshInterval,_adsRefreshDelay:a.adsRefreshDelay,_adsRefreshOnmove:a.adsRefreshOnmove,_enableSidebar:a.enableSidebar,_fixAdsOnScroll:a.fixAdsOnScroll,_maxFixedAds:a.maxFixedAds,contentCol:$('contentCol'),blueBar:$('blueBar'),_tickerMaxHeight:(a.tickerMaxHeight||425),_tickerMinHeight:(a.tickerMinHeight||225),_tickerAbsMinHeight:(a.tickerAbsMinHeight||120),_listeners:[],_subscriptions:[]});this._listeners.push(Event.listen(window,'resize',throttle(this.handleResize.bind(this))));this.blueBarHeight=Vector2.getElementDimensions(this.blueBar).y;this.reloadRightCol();this._initSubscriptions();onleaveRegister(this.cleanup.bind(this));this._listeners.push(Event.listen(window,'scroll',throttle(this._handleScroll.bind(this))));if(this._adsRefreshOnmove)this._listeners.push(Event.listen(window,'mousemove',throttle(this._handleMove.bind(this))));this._lastAdLoadTime=Date.now();this._debounceReloadAdsIfNeeded=debounce(this._reloadAdsIfNeeded.bind(this),this._adsRefreshDelay,true);if(!CSS.hasClass(document.documentElement,'sidebarMode')){this._onSidebarHide();}else if(this._enableSidebar)this._onSidebarShow();this._handleAdsLoad();},_handleAdsLoad:function(){var a=this.handleResize.bind(this);function b(){a.defer();}var c=DOM.scry(this.egoPagelet,'img.img');c.forEach(function(d){if(!d.complete)Event.listen(d,{load:b,error:b,abort:b});});b();},_initSubscriptions:function(){this._subscriptions=[Arbiter.subscribe('page_transition',this.cleanup.bind(this)),Arbiter.subscribe('Ticker/storiesInserted',this.handleResize.bind(this)),Arbiter.subscribe('concierge/load',this.handleResize.bind(this)),Arbiter.subscribe(UIIntentionalStreamMessage.INSERT_STORIES,this.handleResize.bind(this))];if(this._enableSidebar){this._subscriptions.push(Arbiter.subscribe('sidebar/hide',this._onSidebarHide.bind(this)));this._subscriptions.push(Arbiter.subscribe('sidebar/show',this._onSidebarShow.bind(this)));}},reloadRightCol:function(){this.rightColumn=DOM.scry(ge('rightCol'),'div.home_right_column')[0];this.rightColumnWrapper=DOM.find(this.rightColumn,'div.rightColumnWrapper');this.egoPagelet=ge('pagelet_ego_pane_w');if(!this.egoPagelet)this.egoPagelet=ge('pagelet_ego_pane_m');this._refreshOn=!this.containsPremium();this.tickerPagelet=ge('pagelet_rhc_ticker');if(!this.tickerPagelet)return false;this.tickerContainer=DOM.scry(this.tickerPagelet,'.ticker_container')[0];this.tickerStream=DOM.scry(this.tickerPagelet,'.ticker_stream')[0];return this.tickerContainer&&this.tickerStream;},containsPremium:function(){if(this.egoPagelet){var a=DOM.scry(this.egoPagelet,'.fbAdUnit');for(var b=0;b<a.length;b++){var c=JSON.parse(a[b].getAttribute('data-ad')).segment;if(c==='premium')return true;}}return false;},cleanup:function(a,b){if(a==='page_transition'&&b&&b.uri){var c=b.uri;if(c.path==='/photo.php'){this._inSnowbox=true;return;}if(this._inSnowbox&&c.path==='/'){this._inSnowbox=false;return;}}this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions=[];this._listeners.forEach(function(d){d.remove();});this._listeners=[];this._debounceReloadAdsIfNeeded.reset();},_calculateDistanceFromTopOfRHCToTopOfAds:function(){if(this.forceFixingEvaluation||!this._isFixed)this.distanceFromTopOfRHCToTopOfAds=Vector2.getElementPosition(this.egoPagelet,'viewport').y-Vector2.getElementPosition(this.rightColumnWrapper,'viewport').y;},_handleScroll:function(){this._debounceReloadAdsIfNeeded();this._calculateDistanceFromTopOfRHCToTopOfAds();this._topOffset=this.blueBarHeight+Vector2.getElementPosition(this.blueBar,'viewport').y;var a=this._topOffset,b=Vector2.getElementPosition(this.rightColumn,'viewport').y;if(this._forcedStatic||!this.tickerStream){if(this._fixAdsOnScroll&&this.adsStickPoint!==null){var c=b+this.distanceFromTopOfRHCToTopOfAds,d=c<=a-this.adsStickPoint;if(this.forceFixingEvaluation||d!==this._isFixed){this.forceFixingEvaluation=false;var e=a-this.adsStickPoint-this.distanceFromTopOfRHCToTopOfAds;this._setFixed(d,e);}}return;}var f=b<=a+this._TOP_PADDING;if(f!==this._isFixed)this._setFixed(f);},_handleMove:function(){this._debounceReloadAdsIfNeeded();},_reloadAdsIfNeeded:function(){var a=Date.now();if(this._refreshOn&&this._adsRefreshInterval>0&&a-this._lastAdLoadTime>=this._adsRefreshInterval)this._reloadAds();},_reloadAds:function(){this._lastAdLoadTime=Date.now();UIPagelet.loadFromEndpoint('WebEgoPane',this.egoPagelet,{pid:27,data:{organic_only:false,ads_only:false,is_refresh:true}},{crossPage:false,handler:this._handleAdsLoad.bind(this)});},_recalculateAndReposition:function(){this.forceFixingEvaluation=true;this._calculateDistanceFromTopOfRHCToTopOfAds();this._recalculateFixingPosition();this._handleScroll();},_recalculateFixingPosition:function(){if(!this._fixAdsOnScroll)return;var a=Vector2.getViewportDimensions().y-this.blueBarHeight-this._PADDING_RHC_TO_BOTTOM_SHORT,b=Vector2.getElementDimensions(this.rightColumnWrapper).y;if(b<=a){this.adsStickPoint=0-this.distanceFromTopOfRHCToTopOfAds-this._TOP_PADDING;return;}var c=b-this.distanceFromTopOfRHCToTopOfAds,d=DOM.scry(this.egoPagelet,'div.egoOrganicColumn')[0];if(c<=a&&d){this.adsStickPoint=0;}else{var e=DOM.scry(this.egoPagelet,'div.ego_unit').reverse(),f=DOM.scry(this.egoPagelet,'div.fbAdUnit').length,g=this._maxFixedAds;if(f<=this._maxFixedAds)g=e.length;var h=null;for(var i=0;i<g;i++){var j=e[i],k=Vector2.getElementPosition(j,'viewport').y-Vector2.getElementPosition(this.rightColumnWrapper,'viewport').y,l=Vector2.getElementDimensions(this.rightColumnWrapper).y-k;if(l>a){if(i>0)h=e[i-1];break;}if(i==g-1)h=j;}if(h==null){this.adsStickPoint=null;}else this.adsStickPoint=Vector2.getElementPosition(h,'viewport').y-Vector2.getElementPosition(this.egoPagelet,'viewport').y;}},_setFixed:function(a,b){this._isFixed=a;b=b||this._topOffset;var c=a?b+'px':'';CSS.setStyle(this.rightColumnWrapper,'top',c);CSS.conditionClass(this.rightColumnWrapper,'fixed_elem',a);var d=DOM.scry(this.rightColumnWrapper,'div.displayedTickerToggleWrapper')[0];d&&CSS.conditionClass(d,'toggleWrapperWithoutMargin',this._fixAdsOnScroll&&a&&!this.tickerStream);if(this._sidebarIsHidden){var e=a?'Ticker/fixed':'Ticker/unfixed';Arbiter.inform(e);}},handleResize:function(){if(!this._sidebarIsHidden||!this.tickerStream||CSS.hasClass(document.documentElement,'tinyViewport')){this._recalculateAndReposition();return;}this._handleScroll();var a=Vector2.getViewportDimensions().y,b=61,c=Vector2.getElementDimensions(this.rightColumnWrapper).y-Vector2.getElementDimensions(this.tickerContainer).y,d=Vector2.getElementDimensions(this.tickerStream).y,e=a-c-this._PADDING_RHC_TO_BOTTOM-this._topOffset-b,f=this._tickerAbsMinHeight,g=this._tickerMinHeight;this._forcedStatic=false;if(e<f){this._forcedStatic=true;this._setFixed(false);e=f;}else if(e<g)if(e>(g-b)){e=g;}else e+=b;var h=Math.min(e,d,this._tickerMaxHeight);CSS.setStyle(this.tickerContainer,'height',h+'px');},_onSidebarHide:function(){this._sidebarIsHidden=true;this.reloadRightCol();var a=function(){if(this.reloadRightCol()){this._forcedStatic=false;this._handleScroll();this.handleResize();}};this.tickerPagelet&&TickerController.show(this.tickerPagelet,a.bind(this));},_onSidebarShow:function(){this._sidebarIsHidden=false;this.reloadRightCol();if(this._fixAdsOnScroll){this._recalculateAndReposition();}else{this._forcedStatic=true;this._setFixed(false);}this.tickerPagelet&&TickerController.hide(this.tickerPagelet);}});
__d("ContextualLayerAsyncRelative",["event-extensions","copyProperties","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('Parent');function i(j){this._layer=j;}g(i.prototype,{_layerSubscription:null,_listener:null,enable:function(){this._layerSubscription=this._layer.subscribe('show',this._attachListener.bind(this));if(this._layer.isShown())this._attachListener();},disable:function(){this._layer.unsubscribe(this._layerSubscription);this._layerSubscription=null;if(this._listener){this._listener.remove();this._listener=null;}},_attachListener:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._onclick.bind(this));},_onclick:function(j){var k=h.byTag(j.getTarget(),'A');if(!k)return;var l=k.getAttribute('ajaxify'),m=k.href,n=l||m;if(k.rel==='async'||k.rel==='async-post'){d(['AsyncRequest'],function(o){o.bootstrap(n,this._layer.getContext(),k.rel==='async-post');}.bind(this));return false;}}});e.exports=i;});
__d("MenuX",["event-extensions","Class","copyProperties","CSS","DataStore","DOM","HTML","Keys","Parent","PopoverMenuInterface","ScrollableArea","Style","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('Parent'),o=b('PopoverMenuInterface'),p=b('ScrollableArea'),q=b('Style'),r=b('UserAgent');function s(t,u,v,w){this.parent.construct(this);this._id=t;this._className=u;this._items=[];for(var x=0;x<v.length;x++)this._items[x]=new v[x].ctor(v[x]);this._config=w;}g.extend(s,o);h(s.prototype,{_focused:null,_root:null,addItem:function(t){this._items.push(t);if(this._root)this._insertItem(t);},getRoot:function(){if(!this._root)this._render();return this._root;},onShow:function(){if(this._config.maxheight)if(!this._scrollableArea){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');this._scrollableArea=p.fromNative(this._scrollableElems.root,{fade:true});q.set(this._scrollableElems.wrap,'max-height',this._config.maxheight+'px');}else{q.set(this._scrollableElems.root,'width','');q.set(this._scrollableElems.body,'width','');if(r.ie()<=7){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');}else q.set(this._scrollableElems.root,'width',this._scrollableElems.root.offsetWidth+'px');this._scrollableArea.resize();}},onHide:function(){this.blur();},focusAnItem:function(){return this._attemptFocus(0,1);},blur:function(){if(this._focused){this._focused.blur();this._focused=null;this.inform('blur');}},handleKeydown:function(t){var u=this._items.indexOf(this._focused);switch(t){case m.UP:case m.DOWN:var v=t===m.UP?-1:1;if(u!==-1){return this._attemptFocus(u+v,v);}else if(t===m.UP){return this._attemptFocus(this._items.length-1,-1);}else return this._attemptFocus(0,1);break;case m.SPACE:if(this._items.indexOf(this._focused)!==-1){this._handleItemClick(this._focused);return true;}return false;default:var w=String.fromCharCode(t).toLowerCase(),x;for(var y=u+1;y<this._items.length;y++){x=this._items[y].getAccessKey();if(x&&x.charAt(0).toLowerCase()===w)if(this._focusItem(this._items[y]))return true;}return false;}},_render:function(){this._ul=k.create('ul',{className:'uiMenuX'});this._ul.setAttribute('role','menu');this._items.forEach(this._insertItem.bind(this));Event.listen(this._ul,'click',this._handleClick.bind(this));Event.listen(this._ul,'mouseover',this._handleMouseOver.bind(this));Event.listen(this._ul,'mouseout',this._handleMouseOut.bind(this));var t=this._ul;if(this._config.maxheight){this._scrollableElems=p.renderDOM();k.setContent(this._scrollableElems.body,this._ul);t=this._scrollableElems.root;}var u='uiMenuXWrapper'+(this._className?' '+this._className:'');this._root=k.create('div',{className:u},k.create('div',{className:'uiMenuXBorder'},t));this._id&&this._root.setAttribute('id',this._id);},_handleClick:function(t){var u=this._getItemInstance(t.getTarget());if(u)return this._handleItemClick(u);},_handleItemClick:function(t){this.inform('itemclick',t);if(t.hasAction())this.done();return t.handleClick();},_handleMouseOver:function(t){var u=this._getItemInstance(t.getTarget());u&&this._focusItem(u);},_handleMouseOut:function(t){var u=this._getItemInstance(t.getTarget());if(u&&this._focused===u)this.blur();},_insertItem:function(t){var u=t.getRoot();i.addClass(u,'__MenuXItem');j.set(u,'MenuXItem',t);k.appendContent(this._ul,u);},_attemptFocus:function(t,u){var v=this._items[t];if(v)if(this._focusItem(v)){return true;}else return this._attemptFocus(t+u,u);return false;},_focusItem:function(t){if(t.focus()!==false){if(this._focused!==t){this.blur();this._focused=t;this.inform('focus');}return true;}return false;},_getItemInstance:function(t){var u=n.byClass(t,'__MenuXItem');return u?j.get(u,'MenuXItem'):null;}});e.exports=s;});
__d("MenuXItemInterface",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){}g(h.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=this.render();return this._root;},render:bagofholding,getAccessKey:bagofholding,hasAction:bagof(false),focus:bagof(false),blur:bagof(false),handleClick:bagof(false)});e.exports=h;});
__d("MenuXItemBase",["Class","copyProperties","CSS","DOM","HTML","MenuXItemInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('HTML'),l=b('MenuXItemInterface');function m(n){this.parent.construct(this);this._data=n;}g.extend(m,l);h(m.prototype,{render:function(){var n='uiMenuXItem';if(this._data.className)n+=' '+this._data.className;var o={className:n,'aria-selected':'false'};for(var p in this._data)if(p.indexOf('data-')===0)o[p]=this._data[p];return j.create('li',o,this._renderItemContent());},_renderItemContent:function(){return k(this._data.markup).getNodes();}});e.exports=m;});
__d("MenuXItem",["event-extensions","Class","copyProperties","CSS","DOM","KeyStatus","MenuXItemBase"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('KeyStatus'),l=b('MenuXItemBase');function m(n){this.parent.construct(this,n);}g.extend(m,l);h(m.prototype,{getValue:function(){return this._data.value;},getAccessKey:function(){return this._data.label&&this._data.label.charAt(0);},hasAction:bagof(true),focus:function(){if(!this._root.offsetParent)return false;i.addClass(this._anchor,'highlighted');i.addClass(this._root,'selected');this._root.setAttribute('aria-selected','true');if(k.isKeyDown())this._anchor.focus();},blur:function(){i.removeClass(this._anchor,'highlighted');i.removeClass(this._root,'selected');this._root.setAttribute('aria-selected','false');},handleClick:function(){if(typeof this._onclickHandler==='function')return this._onclickHandler();return !!((this._data.rel&&this._data.rel!=='ignore')||this._data.href);},setOnClickHandler:function(n){this._onclickHandler=n;},_renderItemContent:function(){this._anchor=j.create('a',{className:'itemAnchor'},j.create('span',{className:'itemLabel'},this._data.markup));if(this._data.icon){j.prependContent(this._anchor,this._data.icon);i.addClass(this._anchor,'hasIcon');}this._anchor.setAttribute('href',this._data.href||'#');if(this._data.rel){this._anchor.setAttribute('rel',this._data.rel);}else if(!this._data.href)this._anchor.setAttribute('rel','ignore');if(this._data.ajaxify)this._anchor.setAttribute('ajaxify',this._data.ajaxify);if(this._data.target)this._anchor.setAttribute('target',this._data.target);this._anchor.setAttribute('role','menuitem');this._anchor.setAttribute('title',this._data.title);return this._anchor;}});e.exports=m;});
__d("MenuXSelectableItem",["Class","copyProperties","CSS","MenuXItem"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('MenuXItem');function k(l){this.parent.construct(this,l);}g.extend(k,j);h(k.prototype,{_selected:false,getLabel:function(){return this._data.label;},getIcon:function(){return this._data.icon;},isSelected:function(){return this._selected;},select:function(){i.addClass(this._root,'checked');this._selected=true;},deselect:function(){i.removeClass(this._root,'checked');this._selected=false;},render:function(){var l=this.parent.render();if(this._data.selected){i.addClass(l,'checked');this._selected=true;}return l;}});e.exports=k;});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("StreamViewportTracking",["Arbiter","DOM","NavigationMessage","Run","Style","UIIntentionalStreamMessage","Vector","$","collectSubtreeData","copyProperties","debounce","userAction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('NavigationMessage'),j=b('Run'),k=b('Style'),l=b('UIIntentionalStreamMessage'),m=b('Vector'),n=b('$'),o=b('collectSubtreeData'),p=b('copyProperties'),q=b('debounce'),r=b('userAction'),s=51,t='vpv';function u(){}p(u.prototype,{init:function(v){p(this,{timeout:900,readStoryIDs:{},minSizeToBeVisible:200,timeoutHandler:null,listeners:[],arbiterSubscriptions:[],recordTNTree:v});this.fireTimer();var w=q(this.fireTimer,this.timeout,this);this.listeners.push(Event.listen(window,'scroll',w));this.listeners.push(Event.listen(window,'resize',w));this.arbiterSubscriptions.push(g.subscribe(l.UPDATE_HTML_CONTENT,w));j.onLeave(this.cleanup.bind(this));this.arbiterSubscriptions.push(g.subscribe(i.NAVIGATION_BEGIN,this.cleanup.bind(this)));},cleanup:function(){this.listeners.forEach(function(v){v.remove();});this.listeners=[];this.arbiterSubscriptions.forEach(function(v){v.unsubscribe();});this.arbiterSubscriptions=[];clearTimeout(this.timeoutHandle);this.timeoutHandle=null;},fireTimer:function(){this.getStoriesInView().forEach(this.markStoryRead.bind(this));},getStoriesInView:function(){var v=h.scry(n('home_stream'),'.uiStreamStory'),w=[],x=false;for(var y=0;y<v.length;y++){var z=v[y],aa=this.getStoryID(z);if(this.hasBeenVisible(aa))continue;if(this.isVisible(z)){w.push(z);x=true;}else if(x)break;}return w;},hasBeenVisible:function(v){return v in this.readStoryIDs;},getStoryID:function(v){var w=JSON.parse(v.getAttribute('data-ft'));return w.mf_story_key;},isVisible:function(v){var w=m.getViewportDimensions(),x=m.getElementPosition(v,'viewport'),y=m.getElementDimensions(v),z=Math.max(x.y,0),aa=Math.min(x.y+y.y,w.y),ba=Math.min(y.y,this.minSizeToBeVisible);return (aa-z)>=ba;},markStoryRead:function(v){var w=this.getStoryID(v);if(!w)return;if(!this.hasBeenVisible(w)){this.readStoryIDs[w]=true;var x={evt:s};if(this.recordTNTree){var y=o(v,['ft']);for(var z in y.ft){x[z+'_tree']=y.ft[z];if(z==='tn-debug')v.setAttribute('tn-debug_subtree',y.ft[z]);}}r(t,v,null,'FORCE',{ft:x});}}});e.exports.init=function(v){(new u()).init(v);};});
function TickerRightHideController(){}TickerRightHideController._markAsClosedHelper=function(a){var b=ge('pagelet_reminders');if(b){var c=DOM.scry(b,'div.tickerToggleWrapper')[0];if(c)CSS.conditionClass(c,'displayedTickerToggleWrapper',a);}var d=ge('pagelet_rhc_ticker');if(d){var e=DOM.scry(d,'div.tickerToggleWrapper')[0];if(e)CSS.conditionClass(e,"displayedTickerToggleWrapper",!a);CSS.conditionClass(d,"hidden_rhc_ticker",a);}};TickerRightHideController.markAsClosed=function(){TickerRightHideController._markAsClosedHelper(true);};TickerRightHideController.markAsUnclosed=function(){TickerRightHideController._markAsClosedHelper(false);};
__d("legacy:ad-logging",["Arbiter","AsyncRequest","collectDataAttributes"],function(a,b,c,d){var e=b('Arbiter'),f=b('AsyncRequest'),g=b('collectDataAttributes'),h={};function i(l){return (l.getAttribute&&(l.getAttribute('ajaxify')||l.getAttribute('data-endpoint'))||l.action||l.href||l.name);}function j(l,m){if(m.doublelog&&typeof(m.ei)==="string"){new f('/ajax/ssinfeed/end/').setData({doublelog:true,ei:m.ei}).setAllowCrossPageTransition(true).setMethod('POST').send();}else if(l!==null&&typeof(l.ei)==="string"){var n=Date.now(),o=500;l.duplicate_click=!!h[l.ei]&&(n-h[l.ei]<o);h[l.ei]=n;new f('/ajax/ssinfeed/end/').setData(l).setAllowCrossPageTransition(true).setMethod('POST').send();}}function k(l,m){if(!m.node)return;var n=i(m.node);if(!n||!m.event||m.event.type!=='click')return;var o=g(m.node,['ft','ad']);o.ft.href=n;j(o.ft,o.ad);}e.subscribe("UserAction/new",k);},3);
function HomeAdFirstRightColumnController(){}copy_properties(HomeAdFirstRightColumnController.prototype,{init:function(a){copy_properties(this,{_enableSidebar:a.enableSidebar,_tickerHeightOffset:200,contentCol:$('contentCol'),blueBar:$('blueBar'),_tickerMaxHeight:(a.tickerMaxHeight||500),_listeners:[],_subscriptions:[]});this._topOffset=0;this.PADDING_TICKER_TO_TOP=5;this.PADDING_RHC_TO_BOTTOM=60;this._sidebarIsHidden=true;this._listeners.push(Event.listen(window,'resize',this.handleResize.bind(this)));this._blueBarHeight=Vector2.getElementDimensions(this.blueBar).y;this.reloadRightCol();this._initSubscriptions();onunloadRegister(this.cleanup.bind(this));this._listeners.push(Event.listen(window,'scroll',this._handleScroll.bind(this)));if(!CSS.hasClass(document.documentElement,'sidebarMode')){this._onSidebarHide();}else if(this._enableSidebar)this._onSidebarShow();this.handleResize();},_initSubscriptions:function(){this._subscriptions=[Arbiter.subscribe('Ticker/storiesInserted',this.handleResize.bind(this)),Arbiter.subscribe('concierge/load',this.handleResize.bind(this)),Arbiter.subscribe(UIIntentionalStreamMessage.INSERT_STORIES,this.handleResize.bind(this))];if(this._enableSidebar){this._subscriptions.push(Arbiter.subscribe('sidebar/hide',this._onSidebarHide.bind(this)));this._subscriptions.push(Arbiter.subscribe('sidebar/show',this._onSidebarShow.bind(this)));}},_onNavHandler:function(a,b){var c=b.params.key;if(c!='lf'&&c!='h')this.cleanup();},reloadRightCol:function(){this.fixedScrollingContainer=ge('fixed_scrolling_container');this.fixedScrollingWrapper=DOM.scry(this.fixedScrollingContainer,'.fixed_scrolling_wrapper')[0];this.tickerPagelet=ge('pagelet_rhc_ticker');if(!this.tickerPagelet)return false;this.tickerContainer=DOM.scry(this.tickerPagelet,'.ticker_container')[0];this.tickerStream=DOM.scry(this.tickerPagelet,'.ticker_stream')[0];return this.tickerContainer&&this.tickerStream;},cleanup:function(){this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions=[];this._listeners.forEach(function(a){a.remove();});this._listeners=[];},_handleScroll:function(){if(!this._sidebarIsHidden||!this.tickerStream)return;this._topOffset=this.PADDING_TICKER_TO_TOP+this._blueBarHeight;var a=CSS.hasClass(document.documentElement,'tinyViewport'),b=!a;if(b){var c=Vector2.getElementPosition(this.fixedScrollingContainer,'viewport');if(!c||c.y>=this._topOffset)b=false;}if(b!==CSS.hasClass(this.fixedScrollingWrapper,'fixed_elem'))this._setFixedRightCol(b);},_setFixedRightCol:function(a){var b=a?this._topOffset+'px':'';CSS.setStyle(this.fixedScrollingWrapper,'top',b);CSS.conditionClass(this.fixedScrollingWrapper,'fixed_elem',a);var c=a?'Ticker/fixed':'Ticker/unfixed';Arbiter.inform(c);},handleResize:function(){if(!this._sidebarIsHidden||!this.tickerStream||CSS.hasClass(document.documentElement,'tinyViewport'))return;this._handleScroll();var a=Vector2.getViewportDimensions().y,b=Vector2.getElementDimensions(this.fixedScrollingWrapper).y-Vector2.getElementDimensions(this.tickerContainer).y,c=a-this._topOffset-b-this.PADDING_RHC_TO_BOTTOM,d=Vector2.getElementDimensions(this.tickerStream).y,e=Math.min(c,d,this._tickerMaxHeight);CSS.setStyle(this.tickerContainer,'height',e+'px');},_onSidebarHide:function(){this._sidebarIsHidden=true;this.reloadRightCol();var a=function(){if(this.reloadRightCol())this.handleResize();};this.tickerPagelet&&TickerController.show(this.tickerPagelet,a.bind(this));},_onSidebarShow:function(){this._sidebarIsHidden=false;this.reloadRightCol();this._setFixedRightCol(false);this.tickerPagelet&&TickerController.hide(this.tickerPagelet);}});
__d("HomeFixedNav",["Arbiter","CSS","DOMQuery","URI","Vector","$","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOMQuery'),j=b('URI'),k=b('Vector'),l=b('$'),m=b('throttle'),n=0,o=1,p=false,q=[],r=l('leftCol'),s=l('blueBar').offsetHeight,t=false,u=false,v=0,w=k.getViewportDimensions().y,x=function(){var ba=j.getRequestURI().path.indexOf('/messages/')!=-1||j.getRequestURI().path.indexOf('/calendar/')!=-1;p=!ba;w=k.getViewportDimensions().y;if(p)z();q.forEach(function(ca){ca.setFixed(p&&t);});},y=function(){if(!p)return;var ba=i.getDocumentScrollElement(),ca=ba.scrollTop;if(n<ca){o=1;}else if(n>ca)o=-1;n=ca;z();q.forEach(function(da){da.setFixed(t);da.updatePosition();});},z=function(){if(r.offsetHeight+s>w){var ba=r.getBoundingClientRect();v=n+ba.top-s;if(o<0&&ba.top>=s||o>0&&ba.bottom-w<=0||ba.top>w||ba.bottom<s){if(!t){var ca=o>0?'fixedBottom':'fixedTop';r.style.top=o>0?'auto':s+'px';h.setClass(r,'fixed_elem '+ca);t=true;}}else if(t){h.setClass(r);r.style.top=v+'px';t=false;}}else if(!t||v>0){h.setClass(r,'fixed_elem fixedTop');r.style.top=s+'px';v=0;t=true;}},aa={enable:function(){x();var ba=i.scry(l('leftCol'),'.moreSectionsLink');if(ba.length>0)Event.listen(ba.pop(),'click',x);Event.listen(window,'resize',m(x));g.subscribe('page_transition',x);Event.listen(window,'scroll',y);},addContextualDialog:function(ba){ba.setFixed(p&&t);q.push(ba);}};e.exports=aa;});