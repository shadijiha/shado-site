/*1339442744,176820663*/

if (window.CavalryLogger) { CavalryLogger.start_js(["r\/4RY"]); }

__d("legacy:key-event-constants",["Keys"],function(a,b,c,d){a.KEYS=b('Keys');},3);
__d("legacy:error-dialog",["ErrorDialog"],function(a,b,c,d){var e=b('ErrorDialog');a.ErrorDialog=e;},3);
__d("notifications-counter",["Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DocumentTitle'),i=b('JSLogger'),j={messages:0,notifications:0,requests:0};a.NotificationCounter=e.exports={init:function(){g.subscribe('update_title',this._handleUpdate.bind(this));g.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var k=0;for(var l in j){var m=Number(j[l]);if(typeof j[l]=='string'&&isNaN(m))return j[l];if(isNaN(m)||m<0){i.create('jewels').error('bad_count',{jewel:l,count:j[l]});continue;}k+=m;}return k;},updateTitle:function(){var k=this.getCount(),l=h.get();l=k?'('+k+') '+l:l;h.set(l,true);},_handleCountUpdate:function(k,l){j[l.jewel]=l.count;this.updateTitle();},_handleUpdate:function(k,l){this.updateTitle();}};},3);
__d("legacy:ChannelConnection",["ChannelConnection"],function(a,b,c,d){a.ChannelConnection=b('ChannelConnection');},3);
__d("CacheStorage",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={localstorage:i};function i(){this._store=a.localStorage;}i.available=function(){return !!a.localStorage;};g(i.prototype,{keys:function(){var k=[];for(var l=0;l<this._store.length;l++)k.push(this._store.key(l));return k;},get:function(k){return this._store.getItem(k);},set:function(k,l){this._store.setItem(k,l);},remove:function(k){this._store.removeItem(k);},clear:function(){this._store.clear();}});function j(k,l){this._key_prefix=l||'_cs_';this._magic_prefix='_@_';if(k=='AUTO')for(var m in h){var n=h[m];if(n.available()){k=m;break;}}if(k)if(!h[k]||!h[k].available()){this._backend=null;}else this._backend=new h[k]();this._memcache={};}g(j.prototype,{keys:function(){var k=[];if(this._backend){var l=this._backend.keys();for(var m=0;m<l.length;m++)if(l[m].substr(0,this._key_prefix.length)==this._key_prefix)k.push(l[m].substr(this._key_prefix.length));return k;}for(var n in this._memcache)k.push(n);return k;},set:function(k,l){this._memcache[k]=l;if(this._backend){if(typeof l=='string'){l=this._magic_prefix+l;}else l=JSON.stringify(l);this._backend.set(this._key_prefix+k,l);}},get:function(k,l){if(this._memcache[k]!==undefined)return this._memcache[k];var m;if(this._backend){m=this._backend.get(this._key_prefix+k);if(m!==null){if(m.substr(0,this._magic_prefix.length)==this._magic_prefix){m=m.substr(this._magic_prefix.length);}else m=JSON.parse(m);this._memcache[k]=m;}else m=undefined;}if(m===undefined&&l!==undefined){m=l;this._memcache[k]=m;if(this._backend){var n;if(typeof m=='string'){n=this._magic_prefix+m;}else n=JSON.stringify(m);this._backend.set(this._key_prefix+k,n);}}return m;},remove:function(k){delete this._memcache[k];if(this._backend)this._backend.remove(this._key_prefix+k);}});e.exports=j;});
__d("FBDesktopPlugin",["CacheStorage","DOM","Env","FBDesktopDetect","HTML","URI","$"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('DOM'),i=b('Env'),j=b('FBDesktopDetect'),k=b('HTML'),l=b('URI'),m=b('$'),n=new g('localstorage','_socialfox_'),o={_plugin:'_not_checked',arbiterInform:function(p,q){var r=JSON.stringify({name:p,payload:q});this._transmitCommand('arbiterinform',r);},bringToFront:function(){this._transmitCommand('bringtofront');},getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(j.isPluginInstalled()){var p=h.create('div');document.body.appendChild(p);h.setContent(p,k('<object id="kiwi_plugin" '+'type="'+j.mimeType+'" width="0" height="0">'+'</object>'));this._plugin=m('kiwi_plugin');}}return this._plugin;},getUserID:function(){var p=this.getPlugin();return p&&'getUserID' in p&&p.getUserID();},isAppRunning:function(){var p=this.getPlugin();return p&&'isAppRunning' in p&&p.isAppRunning();},logout:function(p){p=p||"0";var q=this.getPlugin();if(q)q.logout(p);},recheck:function(){if(this._plugin===null)this._plugin='_not_checked';},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressUserMessages:function(){var p=this.getUserID();if(p){return p===i.user;}else return this.isAppRunning();},shouldSuppressSidebar:function(){var p=this.getPlugin(),q=p&&'isAppDocked' in p&&p.isAppDocked(),r=n&&n.get('active')==='true';return q||r;},transferAuthToken:function(p,q){if(p&&p.length>0){var r=this.getPlugin();if(r){r.setAccessToken(p,q);var s=setInterval(function(){r.setAccessToken(p,q);},500);setTimeout(function(){clearInterval(s);},10*1000);}}if(this.redirectHome)window.location.href=l().setPath().toString();},_transmitCommand:function(p,q){q=q||'';var r=this.getPlugin();if(r&&'transmitCommand' in r)r.transmitCommand(p,q);}};e.exports=o;});
__d("legacy:fbdesktop-plugin",["FBDesktopPlugin"],function(a,b,c,d){a.FbDesktopPlugin=b('FBDesktopPlugin');},3);
function FriendBrowserCheckboxController(){}copy_properties(FriendBrowserCheckboxController,{instances:{},getInstance:function(a){return this.instances[a];}});copy_properties(FriendBrowserCheckboxController.prototype,{init:function(a,b){FriendBrowserCheckboxController.instances[a]=this;this._id=a;this._form=b;this._contentGrid=DOM.find(b,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=DOM.find(b,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=DOM.find(b,'.friendBrowserCheckboxResults');this._contentPager=DOM.find(b,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};},addTypeahead:function(a,b){a.subscribe('select',this.onHubSelect.bind(this,a,b));},onHubSelect:function(a,b,event,c){if(!((event=='select')&&c.selected))return;var d=this.buildNewCheckbox(b,c.selected.text,c.selected.uid),e=DOM.find(this._form,'.checkboxes_'+b);DOM.appendContent(e.firstChild,d);var f=DOM.scry(a.getElement(),'input[type="button"]');if(f&&f[0])f[0].click();this.getNew(true);},buildNewCheckbox:function(a,b,c){var d=a+'_ids_'+c,e=a+'_ids[]',f=$N('input',{id:d,type:'checkbox',value:c,name:e,checked:true});Event.listen(f,'click',bind(this,'getNew',false));var g=$N('td',null,f);CSS.addClass(g,'vTop');CSS.addClass(g,'hLeft');var h=$N('label',null,b),i=$N('td',null,h);CSS.addClass(i,'vMid');CSS.addClass(i,'hLeft');var j=$N('tr');j.appendChild(g);j.appendChild(i);return j;},showMore:function(){var a=DOM.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!a)return false;if(CSS.hasClass(a,'async_saving'))return false;var b=this.numGetNewRequests,c=Form.serialize(this._form);c.show_more=true;var d=new AsyncRequest().setURI('/ajax/growth/friend_browser/checkbox.php').setData(c).setHandler(bind(this,function(e){this.showMoreHandler(e,b);})).setStatusElement(a).send();},showMoreHandler:function(a,b){if(b==this.numGetNewRequests){var c=a.payload;DOM.appendContent(this._contentGrid,c.results);this.updatePagerAndExtraData(c.pager,c.extra_data);}},getNew:function(a){this.numGetNewRequests++;var b=this.numGetNewRequests;CSS.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(ge('friendBrowserCI'))CSS.addClass($('friendBrowserCI'),'friendBrowserCheckboxContentOnload');CSS.show(this._loadingIndicator);var c=Form.serialize(this._form);c.used_typeahead=a;new AsyncRequest().setURI('/ajax/growth/friend_browser/checkbox.php').setData(c).setHandler(bind(this,function(d){this.getNewHandler(d,b);})).send();},getNewHandler:function(a,b){if(b==this.numGetNewRequests){var c=a.payload;DOM.setContent(this._contentGrid,c.results);CSS.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(ge('friendBrowserCI'))CSS.hide($('friendBrowserCI'));CSS.hide(this._loadingIndicator);this.updatePagerAndExtraData(c.pager,c.extra_data);}},updatePagerAndExtraData:function(a,b){DOM.setContent(this._contentPager,a);this.setupOnVisible();DOM.replace(this._form.elements.extra_data,b);},setupOnVisible:function(){var a=DOM.scry(this._contentPager,'.friendBrowserMorePager')[0];if(a&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new OnVisible(a,bind(this,'showMore'),false,1000);}}});
function RequestsJewel(){}copy_properties(RequestsJewel.prototype,{init:function(a,b,c){this.countNew=0;this.jewel=a;this.jewelFlyoutCase=a.getRoot();this.jewelFlyout=ge('fbRequestsFlyout');this.newCountSpan=ge('newRequestCount');this.folder=b;this.doNewMarkRead=c;this._requestList={};this._requestCount=0;var d=ge('requestsMarkReadButton');if(d)Event.listen(d,'click',this._markRead.shield(this));this.jewel.subscribe('marked-seen',this._markSeenCallback.shield(this));this.jewel.subscribe('closed',this._clearNewItems.shield(this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));LinkController.registerHandler(this._handleLink.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('jewel/requests/add'),this._addRequest.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('jewel/requests/remove_old'),this._removeOldRequest.bind(this));Event.listen(this.jewelFlyout,'submit',function(f){var g=Parent.byClass(f.getTarget(),'objectListItem');if(g){CSS.removeClass(g,'jewelItemNew');CSS.addClass(g,'jewelItemResponded');}}.bind(this));var e=DOM.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(e){this._scrollableWrap=e;this._lastLinkPosition=0;this._scrollListener=Event.listen(e,'scroll',this._handleScroll.bind(this),Event.Priority._BUBBLE);}return this;},fromDom:function(){DOM.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(a){var b=a.getAttribute('id'),c=b&&parseInt(this._parseID(b).requester,10);if(c&&!isNaN(c)){this._requestList[c]=b;++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(a){var b=a.match(/^(\d+)_(\d+)/);return (b)?{requester:b[1],type:b[2]}:undefined;},_handleLink:function(a,event){var b=Parent.byClass(a,'jewelItemNew');if(b&&Parent.byClass(b,'fbRequestList')&&Parent.byClass(b,'beeperEnabled')){var c=this._parseID(b.id);c&&this._markSeenCallback(c.requester,c.type);Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});CSS.removeClass(b,'jewelItemNew');}return true;},_handleScroll:function(){var a=DOM.scry(this._scrollableWrap,'.uiMorePager')[0];if(a){var b=Vector2.getElementPosition(a,'viewport').y;if(b>0)CSS.addClass(Parent.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var c=DOM.find(a,'a');if(!c)return;var d=Vector2.getElementPosition(c,'viewport').y;if(d==this._lastLinkPosition)return;var e=Vector2.getElementPosition(this._scrollableWrap,'viewport').y+Vector2.getElementDimensions(this._scrollableWrap).y;if(d-300<e&&d>0){this._lastLinkPosition=d;var f=c.getAttribute('ajaxify');if(f){new AsyncRequest(f).setRelativeTo(c).setStatusElement(Parent.byClass(c,'stat_elem')).send();}else FriendBrowserCheckboxController.getInstance('jewel').showMore();}}},_addRequest:function(a,b){if(!b||this._requestList[b.obj.from])return;var c=DOM.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!c)return;DOM.prependContent(c,b.obj.markup);var d={jewel:'requests',count:++this.countNew};Arbiter.inform('jewel/count-updated',d);this._requestList[b.obj.from]=elem.id;++this._requestCount;this._conditionShowEmptyMessage();},_removeOldRequest:function(a,b){if(!b)return;var c=this._requestList[b.obj.from],d=c&&ge(c);if(d){CSS.hasClass(d,'jewelItemNew')&&Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!CSS.hasClass(d,'jewelItemResponded')){DOM.remove(d);delete this._requestList[c];--this._requestCount;this._conditionShowEmptyMessage();}}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(a,b){new AsyncSignal('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder}).send();var c=typeof a!='undefined'&&typeof b!='undefined'?{requester:a,type:b}:{};this.doNewMarkRead&&new AsyncSignal('/ajax/requests/mark_read/',c).send();},_removeRequest:function(a,b){var c=b.obj.item_id;if(c){var d=ge(c),e=d&&CSS.hasClass(d,'jewelItemNew');d?DOM.remove(d):false;e&&Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(a,b){DOM.scry(this.jewel.root,'li.jewelItemNew').forEach(function(c){CSS.removeClass(c,'jewelItemNew');});},_updateCount:function(a,b){this.countNew=b.count;CSS.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);CSS.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var c=this.countNew==1?tx._("{num} \u0637\u0644\u0628\u0627\u062a \u062c\u062f\u064a\u062f\u0629.",{num:this.countNew}):tx._("{num} \u0637\u0644\u0628 \u062c\u062f\u064a\u062f",{num:this.countNew});DOM.setContent(this.newCountSpan,c);}},_conditionShowEmptyMessage:function(){DOM.scry(this.jewelFlyout,'li.empty').forEach(function(a){CSS.conditionShow(a,this._requestCount<=0);}.bind(this));},_openHandler:function(){var a=DOM.scry(this.jewelFlyout,'.uiScrollableArea')[0];a&&ScrollableArea.poke(a);}});
__d("JewelX",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DOM","HTML","Toggler","copyProperties","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOM'),l=b('HTML'),m=b('Toggler'),n=b('copyProperties'),o=b('userAction'),p=function(q,r){q&&r&&this.init(q,r);};n(p,{_instancesByName:{},_resizeListener:null});n(p.prototype,h,{init:function(q,r){this.name=r.name;this.root=q;this.countNew=0;this.initialCount=0;p._instancesByName[this.name]=this;m.listen(['show','hide'],this.root,function(s){var t=s==='show';t&&this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform(t?'opened':'closed');g.inform(t?'layer_shown':'layer_hidden',{type:'Jewel'});}.bind(this));g.subscribe('jewel/count-updated',function(s,t){t.jewel==this.name&&this.update(t);}.bind(this));g.subscribe('jewel/count-initial',function(s,t){t.jewel==this.name&&this.setInitial(t);}.bind(this));g.subscribe('jewel/reset',function(s,t){t.jewel==this.name&&this.reset();}.bind(this));p._resizeListener=p._resizeListener||(function(){var s=null;return Event.listen(window,'resize',function(event){clearTimeout(s);s=g.inform.bind(g,'jewel/resize',event).defer(100,false);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(q){var r=k.find(this.root,'ul.jewelItemList');k.setContent(r,l(q));},update:function(q){this.countNew=q.count;var r=k.find(this.root,'span.jewelCount span');k.setContent(r,this.countNew);var s=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',s);this.inform('updated',q);},setInitial:function(q){this.initialCount=q;},markSeen:function(){g.inform('jewel/count-updated',{jewel:this.name,count:0},g.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=bagofholding;o('jewel_click',null,null,'FORCE',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=p;});
__d("legacy:DocumentTitle",["DocumentTitle"],function(a,b,c,d){a.DocumentTitle=b('DocumentTitle');},3);
__d("legacy:Poller",["Poller"],function(a,b,c,d){a.Poller=b('Poller');},3);
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=b('createObjectFrom'),j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;this._resources.remove(l);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(){return this._resources.length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict&&this._skipOnStrictHandler)l=l.filter(this._skipOnStrictHandler);return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&k.start+k.limit>m.length){return false;}else return m.slice(k.start,k.start+k.limit);},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('copyProperties'),k=c('MercuryConstants').ChatNotificationConstants,l=c('ChatSidebarCalloutData').isShown,m=h.getWebChatNotification(),n=l,o=j(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;}});function p(){o.inform(o.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var q=m,r=h.getWebChatNotification();m=r;if(q!=r)p();});g.subscribe('chat/set_does_page_occlude_tabs',function(q,r){n=!!r;p();});e.exports=o;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","copyProperties","MessagingReliabilityLogger","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('MessagingReliabilityLogger'),k=b('MercuryParticipants'),l=b('PresenceUtil'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=b('MercuryThreads'),p=c('MercuryConstants');function q(ga,ha){var ia=ha.obj.to;o.getCanonicalThreadToGroup(ia,function(ja){var ka=ja.thread_id;m.getServerThreadID(ka,function(la){var ma=z(ia,ha.obj.from,ha.obj.msg.time),na={obj:{message:{action_id:null,body:ha.obj.msg.text,is_unread:true,mid:ma,mercury_author_id:'fbid:'+ha.obj.from,mercury_source:p.MercurySourceType.CHAT_WEB,sender_fbid:ha.obj.from,tid:la,timestamp:ha.obj.msg.time,threading_id:ha.obj.sync_id},folder:'group_chat'}};r(h.getArbiterType('messaging'),na);});});}function r(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.message){j.addEntry('channel_receive','invalid_data');return;}var ia=ha.obj.message,ja={author:ia.mercury_author_id,body:ia.body,subject:ia.subject,has_attachment:ia.has_attachment,attachments:ia.attachments,is_html:ia.is_html,thread_id:ia.tid,message_id:ia.mid,source:ia.mercury_source,threading_id:ia.threading_id,timestamp:ia.timestamp,timestamp_absolute:new Date(ia.timestamp).toLocaleString(),action_type:p.MercuryActionType.USER_GENERATED_MESSAGE,is_unread:ia.is_unread,action_id:ia.action_id,is_forward:false,forward_count:ia.forward_count||ia.forward,forward_message_ids:ia.forward_msg_ids,location_text:ia.location_text,folder:ha.obj.folder},ka=[i({},ja)];ka=ka.concat(ia.forward_actions||[]);var la=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;m.handleUpdateWaitForThread({actions:ka,payload_source:la},ia.tid);if(!ia.is_unread&&ia.mercury_author_id===k.user){var ma={};ma[ia.tid]=ha.obj.folder;s(h.getArbiterType('messaging'),{obj:{event:p.MessagingEventTypes.READ,tids:[ia.tid],folder_info:ma}});}j.addEntry('channel_receive','success',[ja.thread_id,ja.message_id,l.getSessionID()]);}function s(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.tids)return;var ia=[],ja=ha.obj.event==p.MessagingEventTypes.READ;ha.obj.tids.forEach(function(ka){ia.push({action_type:p.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:ka,mark_as_read:ja,timestamp:ha.obj.timestamp||0,folder:ha.obj.folder_info[ka]});});m.handleUpdate({actions:ia,payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function t(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.tids)return;var ia=[];ha.obj.tids.forEach(function(ja){ia.push({action_type:p.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ja});});m.handleUpdate({actions:ia,payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function u(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.tids||!ha.obj.mids)return;var ia=ha.obj.tids[0],ja={action_type:p.MercuryActionType.DELETE_MESSAGES,action_id:null,thread_id:ia,message_ids:ha.obj.mids};m.handleUpdate({actions:[ja],payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function v(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.folder||ha.obj.folder!=p.MessagingTag.INBOX)return;var ia={action_type:p.MercuryGlobalActionType.MARK_ALL_READ,action_id:ha.obj.action_id};m.handleUpdate({global_actions:[ia]});}function w(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj.tids)return;var ia=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;ha.obj.tids.forEach(function(ja){var ka={action_type:p.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ja,archived:ha.obj.state};m.handleUpdateWaitForThread({actions:[i({},ka)],payload_source:ia},ja);});}function x(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj.tids)return;var ia=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE,ja;ha.obj.tids.forEach(function(ka){if(ha.obj.event==p.MessagingEventTypes.TAG){ja=ha.obj.tag;}else ja=ha.obj.marked_as_spam?p.MessagingTag.SPAM:p.MessagingTag.INBOX;var la={action_type:p.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ka,new_folder:ja};m.handleUpdateWaitForThread({actions:[i({},la)],payload_source:ia},ka);});}function y(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj.tag)return;switch(ha.obj.tag){case p.MessagingTag.ACTION_ARCHIVED:w(ga,ha);break;case p.MessagingTag.INBOX:case p.MessagingTag.OTHER:x(ga,ha);break;}}function z(ga,ha,ia){return ga+':'+ha+':'+ia;}function aa(ga,ha){if(ga!=h.getArbiterType('inbox')||!ha.obj||!ha.obj.seen_timestamp)return;m.handleUpdate({message_counts:[{seen_timestamp:ha.obj.seen_timestamp,folder:p.MessagingTag.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:p.MessagingTag.INBOX}],payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function ba(ga,ha){if(ga!=h.getArbiterType('mercury')||!ha.obj)return;n.synchronizeInforms(function(){var ia=ha.obj,ja=[];(ia.actions||[]).forEach(function(ka){var la=p.MercuryActionType.USER_GENERATED_MESSAGE;if(ka.action_type==p.MercuryActionType.LOG_MESSAGE){var ma=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;m.handleUpdateWaitForThread({actions:[i({},ka)],payload_source:ma},ka.thread_id);}else if(ka.action_type!=la)ja.push(ka);});ia.actions=ja;ia.payload_source=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;m.handleUpdate(ia);});}function ca(ga,ha){m.handleRoger(ha.obj);}function da(ga,ha){switch(ha.obj.event){case p.MessagingEventTypes.DELIVER:r(ga,ha);break;case p.MessagingEventTypes.READ:case p.MessagingEventTypes.UNREAD:s(ga,ha);break;case p.MessagingEventTypes.READ_ALL:v(ga,ha);break;case p.MessagingEventTypes.DELETE:t(ga,ha);break;case p.MessagingEventTypes.DELETE_MESSAGES:u(ga,ha);break;case p.MessagingEventTypes.TAG:y(ga,ha);break;case p.MessagingEventTypes.REPORT_SPAM:x(ga,ha);break;case p.MessagingEventTypes.READ_RECEIPT:ca(ga,ha);break;}}var ea=[],fa={turnOn:function(){if(!ea.length){var ga={mercury:ba,messaging:da,group_msg:q,inbox:aa};for(var ha in ga)ea.push(g.subscribe(h.getArbiterType(ha),ga[ha]));}},turnOff:function(){if(ea.length){ea.forEach(g.unsubscribe);ea=[];}}};fa.turnOn();e.exports=fa;});
__d("MercuryUnseenState",["Arbiter","copyProperties","TimestampConverter","KeyedCallbackManager","JSLogger","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('TimestampConverter'),j=b('KeyedCallbackManager'),k=b('JSLogger'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=c('MercuryConstants'),p=o.MercuryThreadlistConstants.MAX_UNSEEN_COUNT,q=0,r=0,s=false,t=new j(),u='unseen_thread_hash',v='unseen_thread_list',w=k.create('mercury_unseen_state'),x={getUnseenCount:function(){if(this.exceedsMaxCount()){w.error('unguarded_unseen_count_fetch',{});return 0;}return ba();},exceedsMaxCount:function(){return s||(ba()>p);},markAsSeen:function(){if(ba()>0||s){m.markSeen();da(i.convertActionIDToTimestamp(m.getLastActionID()),[]);}},markThreadSeen:function(ka,la){var ma={};ma[ka]=null;fa(ma,la);}};function y(ka){t.setResource(u,ka);t.setResource(v,Object.keys(ka));}function z(ka){var la=t.executeOrEnqueue(u,ka),ma=t.getUnavailableResources(la);if(ma.length)m.fetchUnseenThreadIDs();}function aa(){return t.getResource(u);}function ba(){var ka=t.getResource(v);if(ka){return ka.length;}else return q;}function ca(ka){var la=ja(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=o.MessagingTag.INBOX)return;var xa=ha(wa.thread_ids),ya=r;if(la&&la.seen_timestamp)ya=la.seen_timestamp;da(ya,xa);if(la&&la.unseen_count>p)s=true;});}else if(la&&la.seen_timestamp){r=la.seen_timestamp;if(la.unseen_count>p){s=true;y({});}else{q=la.unseen_count;if(q===0)y({});}}else{if(s)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==o.MessagingTag.INBOX;if(!ua)continue;if(ra==o.MercuryActionType.USER_GENERATED_MESSAGE||ra==o.MercuryActionType.LOG_MESSAGE){var va=i.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==o.MercuryActionType.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}ea(na);fa(oa);}}function da(ka,la){var ma=aa();if(ma===undefined||ka>r||s){r=ka;la=la||[];if(la.length<=p)s=false;var na={},oa=aa()||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(ga(qa))na[pa]=qa;}var ra=h(l(la,true),na);y(ra);n.updatedUnseenState();}}function ea(ka){if(s)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(ga(oa)){la[na]=oa;ma=true;}}if(!ma)return;z(function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&ga(ra))pa[qa]=la[qa];}y(pa);n.updatedUnseenState();});}function fa(ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)z(function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=i.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){y(oa);n.updatedUnseenState();if(la&&ba()===0)m.markSeen();}});}function ga(ka){return i.convertActionIDToTimestamp(ka)>r;}function ha(ka){return ka.map(m.convertThreadIDIfAvailable);}function ia(ka){var la=aa();if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}y(la);}function ja(ka){var la=(ka.message_counts||[]);for(var ma=0;ma<la.length;ma++)if(la[ma].folder==o.MessagingTag.INBOX)return la[ma];return null;}m.subscribe('update-unseen',function(ka,la){ca(la);});m.subscribe('update-thread-ids',function(ka,la){ia(la);});g.subscribe(k.DUMP_EVENT,function(ka,la){la.messaging=la.messaging||{};la.messaging.unseen=h({},aa());la.messaging.unseen_max_count=s;la.messaging.unseen_time=r;});e.exports=x;});
__d("MercuryJewelCountControl",["Arbiter","DOM","JewelX","MercuryUnseenState","MercuryServerRequests","MercuryThreadInformer","copyProperties","tx","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=c('MercuryConstants'),i=b('DOM'),j=b('JewelX'),k=b('MercuryUnseenState'),l=b('MercuryServerRequests'),m=b('MercuryThreadInformer'),n=b('copyProperties'),o=b('tx'),p,q,r,s=function(u){if(u||r.isOpen())k.markAsSeen();},t=function(u,v){p=u;q=i.find(p,'#mercurymessagesCountValue');r=v;this.render();l.subscribe('model-update-completed',function(w,x){s(false);});m.subscribe('unseen-updated',this.render.bind(this));r.subscribe('marked-seen',s.shield(this,true));};n(t.prototype,{render:function(){var u='';if(k.exceedsMaxCount()){u=o._("\u0623\u0643\u062b\u0631 \u0645\u0646 {count}",{count:h.MercuryThreadlistConstants.MAX_UNSEEN_COUNT});}else u=k.getUnseenCount().toString();g.inform('jewel/count-updated',{jewel:'mercurymessages',count:u},g.BEHAVIOR_STATE);}});e.exports=t;});
__d("MercuryOrderedThreadlist",["JSLogger","MercuryFolders","MercuryServerRequests","RangedCallbackManager","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryFolders'),i=b('MercuryServerRequests'),j=b('RangedCallbackManager'),k=b('MercuryThreadInformer'),l=b('MercuryThreads'),m=c('MercuryConstants'),n=g.create('ordered_threadlist_model'),o=h.getSupportedFolders(),p={};o.forEach(function(y){p[y]=new j(function(z){return l.getThreadMetaNow(z).timestamp;},function(z,aa){return aa-z;},i.canLinkExternally.bind(i));});function q(y,z){var aa=[],ba=false,ca=(y||[]).filter(function(da){return da.folder==z||(!da.folder&&z==m.MessagingTag.INBOX);});ca.forEach(function(da){aa=aa.concat(da.thread_ids);var ea=da.end-da.start;if(da.thread_ids.length<ea)ba=true;});p[z].addResources(aa);if(ba)p[z].setReachedEndOfArray();}function r(y){o.forEach(function(z){q(y,z);});}function s(y){var z={};o.forEach(function(aa){z[aa]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});y.forEach(function(aa){if(aa.is_forward)return;var ba=aa.thread_id,ca=u(ba);function da(){z[ca].to_add.push(ba);if(!p[ca].hasReachedEndOfArray()&&!p[ca].hasResource(ba))z[ca].to_remove_if_last_after_add[ba]=true;}if(!ca){if(aa.action_type===m.MercuryActionType.CHANGE_FOLDER||aa.action_type===m.MercuryActionType.CHANGE_ARCHIVED_STATUS)o.forEach(function(ea){if(ea!==ca)p[ea].removeResources([ba]);});return;}switch(aa.action_type){case m.MercuryActionType.DELETE_THREAD:z[ca].to_remove.push(ba);break;case m.MercuryActionType.CHANGE_ARCHIVED_STATUS:case m.MercuryActionType.CHANGE_FOLDER:da();o.forEach(function(ea){if(ea!==ca)z[ea].to_remove.push(ba);});break;case m.MercuryActionType.USER_GENERATED_MESSAGE:case m.MercuryActionType.LOG_MESSAGE:if(v(ba,ca))z[ca].to_add.push(ba);break;}});o.forEach(function(aa){var ba=p[aa];ba.addResources(z[aa].to_add);for(var ca=ba.getCurrentArraySize()-1;ca>=0;ca--){var da=ba.getResourceAtIndex(ca);if(!z[aa].to_remove_if_last_after_add[da])break;z[aa].to_remove.push(da);}ba.removeResources(z[aa].to_remove);});}function t(y){var z={};o.forEach(function(aa){z[aa]=[];});y.forEach(function(aa){var ba=u(aa.thread_id);if(ba&&v(aa.thread_id,ba))z[ba].push(aa.thread_id);});o.forEach(function(aa){if(z[aa].length>0)p[aa].addResources(z[aa]);});}function u(y){var z=l.getThreadMetaNow(y),aa=null;if(!z){aa='No thread metadata';}else if(!z.folder)aa='No thread folder';if(aa){var ba={error:aa,tid:y};n.warn('no_thread_folder',ba);return null;}var ca=z.folder;if(z.is_archived)ca=m.MessagingTag.ACTION_ARCHIVED;if(p[ca]){return ca;}else return null;}function v(y,z){var aa=l.getThreadMetaNow(y);return aa&&aa.timestamp&&u(y)==z;}var w={getThreadlist:function(y,z,aa,ba,ca){var da=p[aa],ea=da.executeOrEnqueue(y,z,ba,ca),fa=da.getUnavailableResources(ea);if(fa.length){if(da.getCurrentArraySize()<y){var ga={start:y,limit:z,resources_size:da.getCurrentArraySize()};n.warn('range_with_gap',ga);z+=y-da.getCurrentArraySize();y=da.getCurrentArraySize();}i.fetchThreadlistInfo(y,z,aa);}return ea;},getThreadlistUntilTimestamp:function(y,z){return p[z].getElementsUntil(y);},unsubscribe:function(y,z){p[z].unsubscribe(y);}};function x(y){switch(y){case m.MercuryPayloadSource.CLIENT_CHANGE_ARCHIVED_STATUS:case m.MercuryPayloadSource.CLIENT_CHANGE_FOLDER:case m.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE:case m.MercuryPayloadSource.CLIENT_DELETE_MESSAGES:case m.MercuryPayloadSource.CLIENT_DELETE_THREAD:case m.MercuryPayloadSource.CLIENT_SEND_MESSAGE:case m.MercuryPayloadSource.SERVER_INITIAL_DATA:case m.MercuryPayloadSource.SERVER_SEND_MESSAGE:case m.MercuryPayloadSource.SERVER_CONFIRM_MESSAGES:case m.MercuryPayloadSource.SERVER_FETCH_THREADLIST_INFO:case m.MercuryPayloadSource.SERVER_THREAD_SYNC:return true;default:return false;}}i.subscribe('update-threadlist',function(y,z){if(!x(z.payload_source))return;var aa=z.ordered_threadlists;if(aa&&aa.length){r(aa);}else{var ba=(z.actions||[]).filter(function(ca){return ca.thread_id;});t(z.threads||[]);s(ba);}k.updatedThreadlist();});e.exports=w;});
__d("Emote",["DOM","Env","StringEscape"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('StringEscape'),j=e.exports={_initialized:false,_imageBase:null,_emoteMap:null,_emoteOrderMap:null,_fbidEmoticonPattern:'\\[\\[([A-Za-z0-9\\.]+)\\]\\]',_fbidEmoticonRegex:null,_imageURLs:null,_regex:null,_init:function(){var k=h.static_base;j._imageBase=k+'images/emote/';j._blankImgSrc=k+'images/blank.gif';var l=['smile','frown','tongue','grin','gasp','wink','glasses','sunglasses','grumpy','unsure','cry','devil','angel','kiss','heart','kiki','squint','confused','upset','pacman','colonthree','like'];j._emoteMap={':-)':['\\:\\-\\)','smile'],':)':['\\:\\)','smile'],':]':['\\:\\]','smile'],'=)':['=\\)','smile'],':-(':['\\:\\-\\(','frown'],':(':['\\:\\(','frown'],':[':['\\:\\[','frown'],'=(':['=\\(','frown'],':-P':['\\:\\-P','tongue'],':P':['\\:P','tongue'],':-p':['\\:\\-p','tongue'],':p':['\\:p','tongue'],'=P':['=P','tongue'],':-D':['\\:\\-D','grin'],':D':['\\:D','grin'],'=D':['=D','grin'],':-O':['\\:\\-O','gasp'],':O':['\\:O','gasp'],':-o':['\\:\\-o','gasp'],':o':['\\:o','gasp'],';-)':['\\;\\-\\)','wink'],';)':['\\;\\)','wink'],'8-)':['8\\-\\)','glasses'],'8)':['8\\)','glasses'],'B-)':['B\\-\\)','glasses'],'B)':['B\\)','glasses'],'8-|':['8\\-\\|','sunglasses'],'8|':['8\\|','sunglasses'],'B-|':['B\\-\\|','sunglasses'],'B|':['B\\|','sunglasses'],'>:(':['>\\:\\(','grumpy'],'>:-(':['>\\:\\-\\(','grumpy'],':/':['\\:/','unsure'],':-/':['\\:\\-/','unsure'],':\\':['\\:\\\\','unsure'],':-\\':['\\:\\-\\\\','unsure'],":'(":["\\:'\\(",'cry'],'3:)':['3\\:\\)','devil'],'3:-)':['3\\:\\-\\)','devil'],'O:)':['O\\:\\)','angel'],'O:-)':['O\\:\\-\\)','angel'],':-*':['\\:\\-\\*','kiss'],':*':['\\:\\*','kiss'],'<3':['<3','heart'],'&lt;3':['&lt\\;3','heart'],'\u2665':['\u2665','heart'],'^_^':['\\^_\\^','kiki'],'-_-':['\\-_\\-','squint'],'o.O':['o\\.O','confused'],'O.o':['O\\.o','confused'],'>:O':['>\\:O','upset'],'>:-O':['>\\:\\-O','upset'],'>:o':['>\\:o','upset'],'>:-o':['>\\:\\-o','upset'],'>_<':['>_<','upset'],'>.<':['>\\.<','upset'],':v':['\\:v','pacman'],':|]':['\\:\\|\\]','robot'],':3':['\\:3','colonthree'],'<(")':['<\\(\\"\\)','penguin'],':putnam:':['\\:putnam\\:','putnam'],'(^^^)':['\\(\\^\\^\\^\\)','shark'],':42:':['\\:42\\:','42'],':like:':['\\:like\\:','like'],'(y)':['\\(y\\)','like'],'(Y)':['\\(Y\\)','like']};var m=[];if(h.fbid_emoticons){j._fbidEmoticonRegex=new RegExp(j._fbidEmoticonPattern);m.push(j._fbidEmoticonPattern);}for(var n in j._emoteMap)m.push(j._emoteMap[n][0]);var o='(?:^|\\s|\'|"|\\.)('+m.join('|')+')(?:\\s|\'|"|\\.|,|!|\\?|<br>|$)';j._regex=new RegExp(o);j._emoteOrderMap={};for(var p=0;p<l.length;p++)j._emoteOrderMap[l[p]]=p;j._initialized=true;},htmlEmote:function(k,l){if(typeof l!='function')l=i.htmlize;if(!j._initialized)j._init();var m=k,n=[];while(true){var o=j._regex.exec(m);if(!o||!o.length)break;var p=o[1],q=m.indexOf(p),r=m.substring(0,q);if(r)n.push(l(r));n.push('<span class="emote_text">');n.push(p);n.push('</span>');var s={title:p},t=j._fbidEmoticonRegex&&(j._fbidEmoticonRegex.exec(p)||[])[1];if(t){s.className='emote_custom';s.src=window.location.protocol+'//graph.facebook.com/'+encodeURIComponent(t)+'/picture';}else{var u=j._emoteMap[p][1],v=j._emoteOrderMap[u];if(v===undefined){s.className='emote_custom';s.src=j._imageBase+u+'.gif';}else{var w=v*-16;s.className='emote_img';s.src=j._blankImgSrc;s.style={backgroundPosition:w+'px 0'};}}var x=g.create('img',s);n.push(g.create('span',{},x).innerHTML);m=m.substring(q+p.length);}if(m)n.push(l(m));return n.join('');}};});
__d("MercuryThreadMetadataRenderer",["DOM","HTML","Emote","CSS","LiveTimer","MercuryAttachment","MercuryParticipants","MercuryServerRequests","MercuryThreads","Tooltip","URI","createArrayFrom","tx","MercuryImageTemplates","MercuryThreadlistIconTemplates","MercuryStatusTemplates","MercuryConstants","MercuryConfig"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('HTML'),i=b('Emote'),j=b('CSS'),k=b('LiveTimer'),l=b('MercuryAttachment'),m=b('MercuryParticipants'),n=b('MercuryServerRequests'),o=b('MercuryThreads'),p=b('Tooltip'),q=b('URI'),r=c('MercuryImageTemplates'),s=c('MercuryThreadlistIconTemplates'),t=c('MercuryStatusTemplates'),u=c('MercuryConstants'),v=c('MercuryConfig'),w=b('createArrayFrom'),x=b('tx');e.exports={renderLiveTimestamp:function(ba,ca,da,ea){if(ca){ba.setAttribute('data-utime',Math.floor(ea/1000));ba.setAttribute('title',ca);if(da)k.updateNode(ba,da);k.addTimeStamps(ba);j.show(ba);}},renderCoreThreadlist:function(ba,ca,da){o.getThreadMeta(ba,function(ea){this.renderThreadImage(ea.thread_id,ca.getNode('image'));this.renderCommaSeparatedParticipantList(ea.thread_id,ca.getNode('name'));var fa=ca.getNode('timestamp');this.renderLiveTimestamp(fa,ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);this.renderSnippet(ea.thread_id,ca.getNode('snippet'));da(ca,ea);}.bind(this));},renderCommaSeparatedParticipantList:function(ba,ca){ca=w(ca);return this._renderParticipantList(ba,ca,true,false,false,true);},renderAndSeparatedParticipantList:function(ba,ca,da,ea,fa){ca=w(ca);return this._renderParticipantList(ba,ca,false,da,ea,false,fa);},renderSnippet:function(ba,ca){o.getThreadMeta(ba,function(da){if(da.participants.length>0&&da.participants[0]==m.user){var ea=s[':fb:mercury:replied-indicator'].build().getRoot();g.appendContent(ca,ea);}if(da.snippet_has_attachment)if(!da.snippet&&da.snippet_attachments){da.snippet_attachments.forEach(function(ia){if(ia.attach_type!=u.MercuryAttachmentType.FILE)return;var ja=l.getAttachIconClass(ia.icon_type),ka=s[':fb:mercury:attachment-icon-text'].build().getRoot();g.appendContent(ka,ia.name);j.addClass(ka,ja);g.appendContent(ca,ka);}.bind(this));}else{var fa=s[':fb:mercury:attachment-indicator'].build().getRoot();g.appendContent(ca,fa);}if(da.is_forwarded_snippet){var ga;if(da.snippet){ga="\u0627\u0644\u0631\u0633\u0627\u0644\u0629 \u0627\u0644\u0645\u0639\u0627\u062f \u062a\u0648\u062c\u064a\u0647\u0647\u0627:";}else ga="\u0627\u0644\u0631\u0633\u0627\u0644\u0629 \u0627\u0644\u0645\u0639\u0627\u062f \u062a\u0648\u062c\u064a\u0647\u0647\u0627";g.appendContent(ca,g.$N('strong',{className:'mercuryLeftAlignStatusIndicator'},ga));}var ha=da.snippet;if(ha)if(ha.substr(0,4)=='?OTR'){ha="[\u0631\u0633\u0627\u0644\u0629 \u0645\u0634\u0641\u0631\u0629]";}else ha=ha.replace(/\r\n|[\r\n]/g," ");g.appendContent(ca,h(i.htmlEmote(ha)));}.bind(this));},renderTitanLink:function(ba,ca,da){var ea=ba.indexOf(':'),fa=new q().setSubdomain('www'),ga,ha;if(ba.substr(0,ea)=='user'){ga=v.MessagesMercuryIntegrationGK?'/webmessenger/':'/messages/';fa.setPath(ga+ba.substr(ea+1));ca.setAttribute('href',fa.toString());da&&da();}else n.getServerThreadID(ba,function(ia){if(v.MessagesMercuryIntegrationGK){ga='/webmessenger';ha='selection';}else{ga='/messages/';ha='read';}fa.setPath(ga);fa.setQueryData({action:ha,tid:ia});ca.setAttribute('href',fa.toString());da&&da();});},renderThreadImage:function(ba,ca){o.getThreadMeta(ba,function(da){if(da.image_src){this._renderThreadImageSingle(da.image_src,ca);return;}var ea=[],fa=da.participants.filter(function(ga){return ga!=m.user;});if(!fa.length){ea=[m.user];}else if(fa.length==1){ea=[fa[0]];}else{ea=fa.slice(0,3);if(ea.length==2)ea.push(m.user);}m.getMulti(ea,function(ga){var ha=ea.map(function(ia){return ga[ia];});this.renderParticipantImages(ha,ca);}.bind(this));}.bind(this));},renderParticipantImages:function(ba,ca){if(ba.length>2){this._renderThreadImageSplit(ba,ca);}else this._renderThreadImageSingle(ba[0].image_src,ca);},renderErrorIndicator:function(ba,ca){var da=t[':fb:mercury:error-indicator'].render(),ea;switch(ba){case u.MercuryActionStatus.REQUEST_ERROR:case u.MercuryActionStatus.TRANSPORT_ERROR:case u.MercuryActionStatus.FAILED_UNKNOWN_REASON:case u.MercuryActionStatus.UNABLE_TO_CONFIRM:ea="\u062a\u0639\u0630\u0651\u0631 \u0625\u0631\u0633\u0627\u0644 \u0647\u0630\u0647 \u0627\u0644\u0631\u0633\u0627\u0644\u0629. \u0627\u0636\u063a\u0637 \u0644\u0625\u0639\u0627\u062f\u0629 \u0625\u0631\u0633\u0627\u0644\u0647\u0627.";break;default:throw new Error('Invalid error code '+ba);}p.set(da,ea,'above','center');if(ca){Event.listen(da,'click',ca);j.addClass(da,'mercuryClickableErrorIndicator');}return da;},renderResendIndicator:function(){return t[':fb:mercury:resend-indicator'].render();},renderStatusIndicator:function(ba,ca){var da=u.MercuryActionStatus,ea;if(ba==da.RESENDING){ea=this.renderResendIndicator();}else if(ba!=da.UNCONFIRMED&&ba!=da.SUCCESS)ea=this.renderErrorIndicator(ba,ca);return ea;},_renderParticipantList:function(ba,ca,da,ea,fa,ga,ha){o.getThreadMeta(ba,function(ia){if(ia.name){ca.forEach(function(ka){var la=z(ia.name,ga?ia.unread_count:0);g.setContent(ka,la);});return;}var ja=ia.participants;if(ia.participants.length>1)ja=ia.participants.filter(function(ka){return ka!=m.user;});m.getMulti(ja,function(ka){var la=ja.map(function(na){return ka[na];}),ma=this.renderParticipantList(ba,la,ja.length,da,ea,false,ha);ca.forEach(function(na){ma=z(ma,ga?ia.unread_count:0);g.setContent(na,ma);if(fa&&na.scrollWidth>na.clientWidth){var oa=this.renderParticipantList(ba,la,ja.length,da,ea,true,ha);oa=z(oa,ga?ia.unread_count:0);g.setContent(na,oa);}}.bind(this));}.bind(this));}.bind(this));},renderParticipantList:function(ba,ca,da,ea,fa,ga,ha){var ia=null;if(ca.length==1){ia=ca[0].name;}else if(ca.length==2){var ja={participant1:y(ca[0],fa),participant2:y(ca[1],fa)};if(ea){ia=x._("{participant1} \u0648{participant2}",ja);}else ia=x._("{participant1} \u0648{participant2}",ja);}else if(ea){if(ca.length==3){ia=x._("{participant1} \u0648{participant2} \u0648{participant3}",{participant1:y(ca[0],fa),participant2:y(ca[1],fa),participant3:y(ca[2],fa)});}else ia=g.tx._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:y(ca[0],fa),participant2:y(ca[1],fa),participant3:y(ca[2],fa),others_link:aa(ba,da-3,ha)});}else{var ka=y(ca[0],fa),la=y(ca[1],fa),ma=y(ca[2],fa);if(ga){ia=g.tx._("{participant1} and {others_link}",{participant1:ka,others_link:aa(ba,da-1,ha)});}else if(ca.length==3){ia=x._("{participant1} \u0648{participant2} \u0648{participant3}",{participant1:ka,participant2:la,participant3:ma});}else ia=g.tx._("{participant1}, {participant2}, and {others_link}",{participant1:ka,participant2:la,others_link:aa(ba,da-2,ha)});}return ia;},_renderThreadImageSingle:function(ba,ca){var da=r[':fb:mercury:thread-image:single'].build().getRoot();da.src=ba;g.setContent(ca,da);},_renderThreadImageSplit:function(ba,ca){var da=r[':fb:mercury:thread-image:split'].build().setNodeProperty('left','src',ba[0].image_src).setNodeProperty('topRight','src',ba[1].image_src).setNodeProperty('bottomRight','src',ba[2].image_src);g.setContent(ca,da.getRoot());}};function y(ba,ca){return ca?ba.short_name:ba.name;}function z(ba,ca){var da=ba;if(ca&&ca>1)da=g.tx._("{conversation_title} ({unread_count})",{conversation_title:ba,unread_count:ca});return da;}function aa(ba,ca,da){var ea=n.getServerThreadIDNow(ba),fa=ca>1?x._("{others_count} others",{others_count:ca}):"1 other";if(da&&ea){var ga=q('/ajax/messaging/profile_browser/profile_browser.php').setQueryData({tid:ea}),ha=g.create('a',{className:'hoverlistLink',href:ga,rel:'dialog'},fa);return ha;}else return fa;}});
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){var g={SELECTION:'selection',COMPOSE:'compose',SEARCH_THREAD:'search-thread',SEARCH_THREAD_SELECTION:'search-thread-selection',SEARCH_SNIPPET:'search-snippet',SEARCH_SNIPPET_SELECTION:'search-snippet-selection',STATE_CHANGE_EVENT:'state-changed',COMPOSE_SHOWING_CONTEXT:'showing_context',COMPOSE_SHOWING_TYPEAHEAD_RESULTS:'showing_typeahead_results',COMPOSE_SHOWING_ALL_PEOPLE:'showing_all_people',MESSAGE_ACTION:{DELETE:'delete',FORWARD:'forward'}};e.exports=g;});
__d("Token",["CSS","DataStore","DOM","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('copyProperties'),k=b('tx');function l(m,n){this.info=m;this.paramName=n;}j(l.prototype,{getInfo:function(){return this.info;},getText:function(){return this.info.text;},getValue:function(){return this.info.uid;},isFreeform:function(){return !!this.info.freeform;},getElement:function(){if(!this.element)this.setElement(this.createElement());return this.element;},setElement:function(m){h.set(m,'Token',this);this.element=m;return this;},isRemovable:function(){return g.hasClass(this.element,'removable');},createElement:function(){var m=this.paramName,n=this.getText(),o=this.getValue(),p=i.$N('a',{href:'#','aria-label':k._("\u0625\u0632\u0627\u0644\u0629 {item}",{item:n}),className:'remove uiCloseButton uiCloseButtonSmall'}),q=i.$N('input',{type:'hidden',value:o,name:m+'[]',autocomplete:'off'}),r=i.$N('input',{type:'hidden',value:n,name:'text_'+m+'[]',autocomplete:'off'}),s=i.$N('span',{className:'removable uiToken'},[n,q,r,p]);return s;}});e.exports=l;});
__d("WebMessengerPermalinks",["MercuryIDs","MercuryParticipants","MercuryServerRequests","WebMessengerStateConstants","URI","goURI","Token","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryIDs'),h=b('MercuryParticipants'),i=b('MercuryServerRequests'),j=b('WebMessengerStateConstants'),k=b('URI'),l=b('goURI'),m=b('Token'),n=c('MercuryConstants'),o={BASE_PATH:'/webmessenger',goNextURI:function(u,v){if(t(u,v)){var w=o.getURI(u,v);l(w);return true;}return false;},getURI:function(u,v){var w=new k().setSubdomain('www');w.setPath(o.BASE_PATH);if(u){w.addQueryData({action:u});if(v.thread_id){var x=i.getServerThreadIDNow(v.thread_id),y=x?x:v.thread_id;w.addQueryData({tid:y});}if(v.folder)w.addQueryData({folder:v.folder});if(v.query)w.addQueryData({query:v.query});if(v.message_id)w.addQueryData({mid:v.message_id});if(v.no_focus)w.addQueryData({no_focus:true});}return w;},processURI:function(u){if(u.getPath()!=o.BASE_PATH)return false;var v={redirect:false,data:{}},w=u.getQueryData().action||j.COMPOSE;v.state=w;var x=u.getQueryData().folder||n.MessagingTag.INBOX;v.data.folder=x;if(u.getQueryData().no_focus)v.data.no_focus=true;switch(w){case j.SELECTION:return s(u,v);case j.COMPOSE:return p(u,v);case j.SEARCH_THREAD:case j.SEARCH_SNIPPET:return r(u,v);case j.SEARCH_THREAD_SELECTION:v=r(u,v);return s(u,v);case j.SEARCH_SNIPPET_SELECTION:v=r(u,v);v=s(u,v);return q(u,v);}v.redirect=true;return v;}};function p(u,v){var w=u.getQueryData().to;if(w){var x=h.getNow('fbid:'+w);if(x){var y={uid:w,text:x.name};v.data.new_tokens=[new m(y)];}}v.data.start=true;v.data.contents_state=j.COMPOSE_SHOWING_CONTEXT;return v;}function q(u,v){var w=u.getQueryData().mid;if(w){v.data.message_id=w;}else v.redirect=true;return v;}function r(u,v){var w=u.getQueryData().query;v.data.query=w;return v;}function s(u,v){var w=u.getQueryData().tid;if(w){var x=g.isValid(w)?w:i.getClientThreadIDNow(w);if(x){v.data.thread_id=x;}else v.redirect=true;}else v.data.thread_id=null;return v;}function t(u,v){if(u==j.COMPOSE&&!v.start)return false;return !v.message_action;}e.exports=o;});
__d("MercuryJewelThreadlistControl",["CSS","copyProperties","DOM","MercuryOrderedThreadlist","Parent","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","tx","WebMessengerStateConstants","WebMessengerPermalinks","MercuryConfig","MercuryConstants","MercuryJewelTemplates"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('copyProperties'),i=b('DOM'),j=b('MercuryOrderedThreadlist'),k=b('Parent'),l=b('MercuryThreadInformer'),m=b('MercuryThreadMetadataRenderer'),n=b('MercuryThreads'),o=b('tx'),p=b('WebMessengerStateConstants'),q=b('WebMessengerPermalinks'),r=c('MercuryConfig'),s=c('MercuryConstants'),t=c('MercuryJewelTemplates');function u(v){this._rootElement=v;this._contentElement=i.find(this._rootElement,'.jewelContent');this._loadingElement=i.find(this._rootElement,'.jewelLoading');l.subscribe('threadlist-updated',this.render.bind(this));this.render();}h(u.prototype,{render:function(){i.empty(this._contentElement);g.show(this._loadingElement);var v=i.$N('div');i.appendContent(this._contentElement,v);j.getThreadlist(s.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,s.MercuryThreadlistConstants.JEWEL_THREAD_COUNT,s.MessagingTag.INBOX,this.renderThreads.bind(this,v),true);},renderThreads:function(v,w){if(w.length){w.forEach(function(x){var y=t[':fb:mercury:jewel:threadlist-row'].build();m.renderCoreThreadlist(x,y,this.renderSingleThread.bind(this));i.appendContent(v,y.getRoot());}.bind(this));}else i.setContent(this._rootElement,this.renderEmptyThreadlist());g.hide(this._loadingElement);},renderSingleThread:function(v,w){if(w.unread_count>0)g.addClass(v.getRoot(),'jewelItemNew');if(r.MessagesMercuryIntegrationGK){v.getNode('link').setAttribute('href',q.getURI(p.SELECTION,{thread_id:w.thread_id}).toString());}else m.renderTitanLink(w.thread_id,v.getNode('link'));Event.listen(v.getRoot(),'mouseover',function(event){var x=v.getRoot();if(!k.byClass(x,'notifNegativeBase'))g.addClass(x,'selected');});Event.listen(v.getRoot(),'mouseout',function(event){g.removeClass(v.getRoot(),'selected');});},renderEmptyThreadlist:function(){return i.$N('li',{className:'empty'},"\u0645\u0627 \u0645\u0646 \u0631\u0633\u0627\u0626\u0644");}});e.exports=u;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests'),k=false;e.exports=function(m,n,o,p){j.handleUpdate(p);var q=new g(n,o),r=h.find(m,'#MercuryJewelThreadList');if(o.getRoot()&&o.isOpen()){l(r);}else o.subscribe('opened',l.bind(null,r));};function l(m){if(!k){var n=new i(m);k=true;}}});
__d("MessagingEvents",["array-extensions","Arbiter","ChannelConstants","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('isEmpty'),k={},l=new g();function m(n){if(!j(k))return;for(var o in n)l.inform('count/'+o,n[o]);}l.subscribe('mark-as-read',function(n,o){(o.tids||o.chat_ids||[]).forEach(function(p){p=''+p;if(!(p in k)){k[p]=true;var q=function(){l.unsubscribe(r);clearTimeout(s);delete k[p];},r=l.subscribe('read',function(t,u){if((u.tids||[]).contains(p)||(u.chat_ids||[]).contains(p))q();}),s=q.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(n,o){var p=i({},o.obj),event=p.event||'';delete p.type;delete p.event;l.inform(event,p);if('unread_counts' in p){var q=p.unread_counts;m({unread:q.inbox,other_unseen:q.other});}});g.subscribe(h.getArbiterType('inbox'),function(n,o){var p=i(o.obj);delete p.type;m(p);});a.MessagingEvents=e.exports=l;},3);
__d("TitanLeftNav",["CounterDisplay","MessagingEvents"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('MessagingEvents'),i={initialize:function(){h.subscribe('count/other_unseen',function(j,k){g.setCount('other_unseen',k);});}};e.exports=i;});
__d("DoublyLinkedListMap",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){this._head=null;this._tail=null;this._nodes={};this._nodeCount=0;}g(h.prototype,{get:function(i){return this._nodes[i]?this._nodes[i].data:null;},_insert:function(i,j,k,l){k&&!this._nodes[k]&&(k=null);var m=(k&&this._nodes[k])||(l?this._head:this._tail),n={data:j,key:i,next:null,prev:null};if(m){this.remove(i);if(l){n.prev=m.prev;m.prev&&(m.prev.next=n);m.prev=n;n.next=m;}else{n.next=m.next;m.next&&(m.next.prev=n);m.next=n;n.prev=m;}}n.prev===null&&(this._head=n);n.next===null&&(this._tail=n);this._nodes[i]=n;this._nodeCount++;return this;},insertBefore:function(i,j,k){return this._insert(i,j,k,true);},insertAfter:function(i,j,k){return this._insert(i,j,k,false);},prepend:function(i,j){return this.insertBefore(i,j,this._head&&this._head.key);},append:function(i,j){return this.insertAfter(i,j,this._tail&&this._tail.key);},remove:function(i){var j=this._nodes[i];if(j){var k=j.next,l=j.prev;k&&(k.prev=l);l&&(l.next=k);this._head===j&&(this._head=k);this._tail===j&&(this._tail=l);delete this._nodes[i];this._nodeCount--;}return this;},find:function(i){for(var j=this._head;j;j=j.next)if(i(j.data))return j.key;return null;},reduce:function(i,j){for(var k=this._head;k;k=k.next)j=i(k.data,j);return j;},exists:function(i){return !!this._nodes[i];},isEmpty:function(){return !this._head;},reset:function(){this._head=null;this._tail=null;this._nodes={};this._nodeCount=0;},map:function(i){for(var j=this._head;j;j=j.next)i(j.data);},getCount:function(){return this._nodeCount;}});e.exports=h;});
__d("setTimeoutAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setTimeout(h,i,false);}e.exports=g;});
__d("endsWith",[],function(a,b,c,d,e,f){function g(h,i){return h.indexOf(i,h.length-i.length)>-1;}e.exports=g;});
__d("MusicButtonStore",[],function(a,b,c,d,e,f){var g={},h={addButton:function(i,j){g[i]=j;return j;},getButton:function(i){return g[i];},getButtons:function(){return g;},removeButton:function(i){g[i]&&g[i].resetLoadingTimers();delete g[i];}};e.exports=h;});
__d("MusicEvents",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');e.exports=a.MusicEvents=new g();});
__d("MusicProviders",[],function(a,b,c,d,e,f){e.exports=a.MusicProviders={SPOTIFY:'open.spotify.com'};});
__d("MusicConstants",["Arbiter","MusicEvents","MusicProviders"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MusicEvents'),i=b('MusicProviders'),j={DEBUG:false,LIVE_LISTEN_MIN_SPOTIFY_VERSION:'spotify-0.6.6.0.g5a9eaca5',enableDebug:function(){this.DEBUG=true;},sameURLs:function(k,l){var m=/\/$/;if(k&&l){k=URI(k);l=URI(l);return k.getDomain()==l.getDomain()&&k.getPath()==l.getPath();}return false;},greaterOrEqualToMinimumVersion:function(k,l){var m=/(?:\d+\.)+/,n=k.match(m)[0].split('.').slice(0,-1),o=l.match(m)[0].split('.').slice(0,-1);if(n.length!==o.length)return false;for(var p=0;p<o.length;p++)if(+n[p]<+o[p]){return false;}else if(+n[p]>+o[p])return true;return true;},sanitizeForProviders:function(k){var l={};for(var m in k)if(this.ALLOWED_EXTERNAL_CONTEXT_PARAMS[m])l[m]=k[m];return l;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR',INCORRECT_ONLINE_STATE:'INCORRECT_ONLINE_STATE',LOG_SEND_OP:'LOG_SEND_OP',REQUEUE_OP:'REQUEUE_OP'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};e.exports=a.MusicConstants||j;});
__d("MusicWaterfallLogger",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('music_waterfall'),i={click:function(l){j('click',l);},musicLoadedFromClick:function(l){j('music_loaded_from_click',l);},playPause:function(l){j('play_pause',l);}};function j(l,m){h.debug(l+'_debug',m);h.bump(l);h.bump(l+'_'+k(m));}function k(l){return l?l.replace(/\.|-/g,'_'):'';}e.exports=i;});
__d("MusicButton",["Bootloader","copyProperties","CSS","DOM","MusicButtonStore","MusicConstants","MusicEvents","MusicWaterfallLogger","Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('MusicButtonStore'),l=b('MusicConstants'),m=b('MusicEvents'),n=b('MusicWaterfallLogger'),o=b('Parent'),p=b('Tooltip'),q=function(r,s,t,u,v,w){this.provider=r;this.buttonElem=s;this.url=t;this.context=u||{};this.mediaType=v;this.setState(this.STATES.OFFLINE);this.tooltip=w||'';m.subscribe(l.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};h(q,{tracksetableTypes:[]});h(q.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:4000,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(r){if(r!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||r;}if(r===this.STATES.PLAYING){p.set(this.buttonElem,this.tooltip);}else p.set(this.buttonElem,'');var s=this.buttonElem.parentNode;this.state&&i.removeClass(s,this.state);this.state=r;i.addClass(s,this.state);},isTracksetable:function(r){return q.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(r,s){clearTimeout(this._showLoadingTimer);if(s&&s.provider&&s.provider!=this.provider)return;switch(r){case l.DIAGNOSTIC_EVENT.ONLINE:case l.STATUS_CHANGE_EVENT.track:case l.STATUS_CHANGE_EVENT.playing:var t=s&&s.track&&s.track.uri,u=s&&s.context&&s.context.uri;if(s&&s.playing&&(l.sameURLs(t,this.url)||l.sameURLs(u,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=this.setState.bind(this,this.STATES.PAUSED).defer(this.RECENTLY_ONLINE_TIMEOUT,false);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case l.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case l.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(r,s){if(s!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}n.click(this.provider);var t=this.isTracksetable()&&o.byClass(this.buttonElem,'music_trackset_container'),u=[];if(t){var v=t.getAttribute('data-trackset-title'),w=this.provider,x=j.scry(t,'.music_button');for(var y=0;y<x.length;y++){var z=k.getButton([x[y].id]);if(z&&z.provider==w&&z.isTracksetable())u.push(z.url);}}if(!a.Music)this.showLoading(true);g.loadModules(['Music'],function(aa){n.musicLoadedFromClick(this.provider);var ba=(t&&u.length>1)?aa.playPauseSongList(this.provider,this.url,u,v,this.context):aa.playPauseSong(this.provider,this.url,this.context);this.showLoading(!ba);}.bind(this));},showLoading:function(r){this.resetLoadingTimers();this._hideLoadingTimer=this._timeout.bind(this,r).defer(this.HIDE_LOADING_TIMEOUT,false);this._showLoadingTimer=this.setState.bind(this,this.STATES.LOADING).defer(this.SHOW_LOADING_TIMEOUT,false);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(r){a.Music&&a.Music.reInform([this.provider]);if(!r&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});e.exports=q;});
__d("MusicButtonManager",["DOM","Layer","MusicButton","MusicButtonStore","MusicConstants","MusicEvents","Parent","$","event-extensions","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Layer'),i=b('MusicButton'),j=b('MusicButtonStore'),k=b('MusicConstants'),l=b('MusicEvents'),m=b('Parent'),n=b('$'),o=b('event-extensions').$E,p=b('copyProperties'),q=b('ge'),r=(function(){var s=null,t={};function u(event){var z=o(event).getTarget(),aa=m.byClass(z,'music_button');aa=aa||(!event.getModifiers().any&&v(z));if(!aa)return;return w(aa,event);}function v(z){var aa=m.byClass(z,'music_button_trigger')&&m.byClass(z,'music_button_trigger_group');if(aa){var ba=g.scry(aa,'.music_button');if(ba.length)return ba[0];}return null;}function w(z,event){event&&o(event).stop();l.inform(k.MUSIC_BUTTON.ACTIVATE,z);return false;}function x(z){a.Music&&a.Music.reInform(z);}function y(z,aa){var ba=j.getButtons();for(var ca in ba)if(ba[ca].noGC||q(ca)){ba[ca].handleIncomingEvent(z,aa);}else j.removeButton(ca);}return {init:function(z){if(s)return;s=true;i.tracksetableTypes=z||[];Event.listen(document.body,'click',u);l.subscribe([k.STATUS_CHANGE_EVENT.playing,k.STATUS_CHANGE_EVENT.track,k.DIAGNOSTIC_EVENT.OFFLINE,k.DIAGNOSTIC_EVENT.ALL_OFFLINE,k.DIAGNOSTIC_EVENT.ONLINE],y);},addButton:function(z,aa,ba,ca,da,ea){s||r.init();if(!q(aa))return;var fa=j.getButton(aa);fa;var ga=n(aa);fa=j.addButton(aa,new i(z,ga,ba,p({button_id:aa},ca),da,ea));var ha=m.byClass(ga,'uiOverlay');if(ha){fa.noGC=true;var ia=h.subscribe('destroy',function(ja,ka){if(g.contains(ka.getRoot(),ga)){j.removeButton(aa);h.unsubscribe(ia);}});}if(z&&!t[z])t[z]=function(){var ja=Object.keys(t);ja.length&&x(ja);t={};}.defer();return fa;}};})();e.exports=a.MusicButtonManager||r;});
__d("NotificationList",["Arbiter","ArbiterMixin","Class","CSS","DOM","DoublyLinkedListMap","HTML","URI","$","copyProperties","ge","isEmpty","tx","hasArrayNature"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOM'),l=b('DoublyLinkedListMap'),m=b('HTML'),n=b('URI'),o=b('$'),p=b('copyProperties'),q=b('ge'),r=b('isEmpty'),s=b('tx'),t=b('hasArrayNature'),u=k.$N,v="0",w="1",x="2";function y(ba){return ba==w||ba==x;}function z(ba){return ba==w;}function aa(ba,ca){this._list=new l();this._filter_func=null;this.unseenCount=0;this.contentRoot=ba;this.noItemsElement=null;this.ITEM_TAG='li';this.ITEM_CLASS='notification';this.NO_ITEMS_ID='jewelNoNotifications';this.NO_ITEMS_CLASS='empty';this.compare=ca.compare||this.compare;this.shouldBlockAnimation=ca.shouldBlockAnimation||null;this.unseenVsUnread=ca.unseenVsUnread||false;this.animations={};}p(aa,{ITEM_UNREAD_CLASS:'jewelItemNew',MARK_READ_TYPE:'mark_read',UNREAD_COUNT_CHANGE_TYPE:'unread_count_change',INSERTION_TYPE:'insert',REMOVAL_TYPE:'remove',getIdFromDom:function(ba){return ba.getAttribute('id').replace('notification_','');},localizeUrls:function(ba){k.scry(ba,'a').forEach(function(ca){n(ca.href).isFacebookURI()&&(ca.href=n(ca.href).getUnqualifiedURI().getQualifiedURI().setSubdomain(n(ca.href).getSubdomain()).toString());});}});p(aa.prototype,h,{_getField:function(ba,ca){var da=this._list.get(ba);return da&&da[ca];},getDomObj:function(ba){return this._getField(ba,'obj');},fromDom:function(){var ba=this.ITEM_TAG+'.'+this.ITEM_CLASS,ca=k.scry(this.contentRoot,ba);for(var da=0;da<ca.length;++da){var ea=ca[da],fa=aa.getIdFromDom(ea);this.insert(fa,ea.getAttribute('data-notiftime'),null);}},compare:function(ba,ca){return ba.time<ca.time||(ba.time===ca.time&&ba.id<ca.id);},insert:function(ba,ca,da,ea,fa,ga){var ha=w,ia=0,ja=this._list.exists(ba),ka=ga&&this._list.exists(ga),la=null,ma;if(ja||ka)if(!(ea&&da)){return false;}else{if(this._filter_func){ma={notif_id:ba,notif_time:ca,notif_markup:da,replace:ea,ignoreUnread:fa,notif_alt_id:ga};if(this._filter_func(ma))return false;}ha=this._getField(ba,'readness');ia=this._getField(ba,'time');if(ia>ca)return false;la=ja?ba:ga;this._remove(la);}var na=(da&&m(da).getRootNode())||o('notification_'+ba),oa=Math.max(ca,ia),pa=na.getAttribute('data-readness');if(!this.unseenVsUnread&&x==pa)pa=v;ma={id:ba,obj:na,time:oa,readness:pa,app_id:na.getAttribute('data-appid')};this._insert(ma);aa.localizeUrls(na);this.noItemsElement&&j.hide(this.noItemsElement);if(z(pa)){fa&&!y(ha)&&this.markRead([ba]);this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}var qa=!la||ia<oa||(pa&&!ha&&!fa);this.inform(aa.INSERTION_TYPE,{id:ba,is_new:qa,obj:na,replaced_id:la,time:oa});return true;},showNoNotifications:function(){if(null==this.noItemsElement)this.noItemsElement=q(this.NO_ITEMS_ID);if(null==this.noItemsElement){this.noItemsElement=u(this.ITEM_TAG,{id:this.NO_ITEMS_ID,className:this.NO_ITEMS_CLASS},"\u0644\u0627 \u062a\u0648\u062c\u062f \u0625\u0634\u0639\u0627\u0631\u0627\u062a \u062c\u062f\u064a\u062f\u0629");k.appendContent(this.contentRoot,this.noItemsElement);}j.show(this.noItemsElement);},_insert:function(ba){this._list.remove(ba.id);var ca=null;this._list.find(function(ea){var fa=this.compare(ea,ba);!fa&&(ca=ea.id);return fa;}.bind(this));var da=this.getDomObj(ca);if(da){this._list.insertAfter(ba.id,ba,ca);k.insertAfter(da,ba.obj);}else{this._list.prepend(ba.id,ba);k.prependContent(this.contentRoot,ba.obj);}},_remove:function(ba){var ca=this._getField(ba,'obj');if(!ca)return false;this.inform(aa.REMOVAL_TYPE,{id:ba});this._list.remove(ba);k.remove(ca);this.isEmpty()&&this.showNoNotifications();return true;},getUnreadIds:function(){return this._list.reduce(function(ba,ca){y(ba.readness)&&ca.push(ba.id);return ca;},[]);},getUnseenIds:function(){return this._list.reduce(function(ba,ca){z(ba.readness)&&ca.push(ba.id);return ca;},[]);},getIds:function(){return this._list.reduce(function(ba,ca){ca.push(ba.id);return ca;},[]);},isUnreadId:function(ba){return y(this._getField(ba,'readness'));},isUnseenId:function(ba){return z(this._getField(ba,'readness'));},markRead:function(ba,ca){ba=ba?ba.filter(this.isUnreadId.bind(this)):this.getUnreadIds();var da=false;for(var ea=0;ea<ba.length;ea++){var fa=this._list.get(ba[ea]);if(fa){if(this._setReadness(ba[ea],v))da=true;if(ca){this._markReadInDom(ba[ea],fa.obj);}else this.animateMarkRead(fa.obj);}}if(da){this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}},markSeen:function(ba){if(!t(ba))return;if(!this.unseenVsUnread){this.markRead(ba);return;}ba=ba.filter(this.isUnseenId.bind(this));var ca=false;for(var da=0;da<ba.length;da++)if(this._setReadness(ba[da],x))ca=true;if(ca){this.unseenCount=this.getUnseenIds().length;this.inform(aa.UNREAD_COUNT_CHANGE_TYPE);}},_setReadness:function(ba,ca){var da=this._list.get(ba);if(!da||da.readness==ca)return false;if(da.readness==v&&ca==x)return false;da.readness=ca;da.obj.setAttribute('data-readness',ca);return true;},_markReadInDom:function(ba,ca){if(this.isUnreadId(ba))return;var da=o(ca);if(da){this.stopAnimation(ba);j.removeClass(da,aa.ITEM_UNREAD_CLASS);}},animateMarkRead:function(ba){if(!j.hasClass(ba,aa.ITEM_UNREAD_CLASS))return;var ca=aa.getIdFromDom(ba),da=this._markReadInDom.bind(this,ca,ba);if(j.hasClass(ba,'fbJewelBeep')){da();return;}if(this.shouldBlockAnimation&&this.shouldBlockAnimation(ba))return;da.defer(10000);},stopAnimation:function(ba){ba in this.animations&&this.animations[ba].stop();delete this.animations[ba];return true;},insertMany:function(ba,ca){if('object'==typeof ba&&!r(ba)){for(var da in ba){var ea=ba[da];this.insert(da,ea.time,ea.markup,true,ca,ea.alt_id||null);}this.noItemsElement&&j.hide(this.noItemsElement);}else this.isEmpty()&&this.showNoNotifications();},isEmpty:function(){return this._list.isEmpty();},getEarliestNotifTime:function(){return this._list.isEmpty()?0:Math.min.apply(null,this.getIds().map(function(ba){return this._getField(ba,'time');}.bind(this)));},setFilterFn:function(ba){this._filter_func=ba;},toggleNotifsSimilarTo:function(ba,ca,da){var ea=this._getField(ba,'app_id');if(ea){var fa=this.getIds();for(var ga=0;ga<fa.length;++ga)if(ea==this._getField(fa[ga],'app_id')){var ha=this.getDomObj(fa[ga]);if(ba!=fa[ga])ca?j.hide(ha):j.show(ha);var ia=k.scry(ha,'.first_receipt_div');if(ia.length==1)if(da){j.hide(ia[0]);j.removeClass(ha,'first_receipt');}else{j.show(ia[0]);j.addClass(ha,'first_receipt');}}}}});e.exports=aa;});
__d("legacy:notifications-list",["NotificationList"],function(a,b,c,d){a.NotificationList=b('NotificationList');},3);
function Notifications(a){this.updateTime=a.updateTime||Date.now();this.update_period=a.updatePeriod||60000;this.latest_notif_time=a.latestNotif||0;this.latest_read_notif_time=a.latestReadNotif||0;this.cache_version=a.cacheVersion||0;this.notifReceivedType=a.notifReceivedType||'notification';this.wrapperID=a.wrapperID||'notificationsWrapper';this.contentID=a.contentID||'jewelNotifs';this.shouldLogImpressions=a.shouldLogImpressions||false;this.allowDesktopNotifications=a.allowDesktopNotifications||false;this.useInfiniteScroll=a.useInfiniteScroll||false;this.useUnaggregatedBeeper=a.unaggregatedBeeper||false;this.unseenVsUnread=a.unseenVsUnread||false;this.scrollableAreaNode=null;this.firstReceiptMap={};this.user=Env.user;this.timeElement='small.time';this.ua=new UserNoOp();this._init();}Notifications.BEEPS_EXPIRED='beeper/beeps_expired';copy_properties(Notifications.prototype,{_init:function(){this.BEEPER_APPID=30729425562;this.ignoreBeeps=false;this.cookieName='notifications_'+this.user;this.beepsExpiredToken=null;this.updateCheckCount=0;this.fetchListeners=[];this.currentFetchRequest=null;this.wrapper=ge(this.wrapperID);this.content=ge(this.contentID);this.jewelFlyout=ge('fbNotificationsFlyout');this.loadingIndicator=ge(this.contentID+'_loading_indicator');this.NOTIF_JEWEL_REF='notif_jewel';this.BEEPER_REF='beeper';NotificationCounter.init();this.alertList=new NotificationList(this.content,this._getListParams());this._updateCount();window.MinNotifications&&MinNotifications.fetchSent()&&(this.fetch=bagofholding);Arbiter.subscribe(ChannelConstants.getArbiterType(this.notifReceivedType),this._handleNotificationMsg.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('notifications_read'),this._handleNotificationsReadMsg.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('notifications_seen'),this._handleNotificationsSeenMsg.bind(this));Arbiter.subscribe('jewel/resize',this._hideOverflow.shield(this));this.alertList.subscribe(NotificationList.UNREAD_COUNT_CHANGE_TYPE,this._updateCount.bind(this));this._poller=new Poller(this.update_period,this._update.bind(this),true);this.notifLogger=JSLogger.create('notifications');if(this.wrapper)this.countSpan=DOM.find(this.wrapper,'span.jewelCount span');this.initializeEvents();this.fromDom();if(this.useInfiniteScroll){this._autoLoadNotifIndex=1;this._truncate=false;this.alertList.subscribe(NotificationList.INSERTION_TYPE,this._handleInsert.bind(this));}},_getListParams:function(){return {shouldBlockAnimation:function(a){return Toggler.getInstance(this.wrapper).getActive()===this.wrapper;}.bind(this),unseenVsUnread:this.unseenVsUnread};},fromDom:function(){this.ignoreBeeps=true;this.alertList.fromDom();window.MinNotifications&&MinNotifications.fetched()&&this.alertList.isEmpty()&&this.alertList.showNoNotifications();this.ignoreBeeps=false;},initializeEvents:function(){var a=this.alertList.ITEM_TAG,b=null;Event.listen(this.content,{mouseover:function(event){var d=event.getTarget();b=Parent.byTag(d,a);if(b&&d!=b)if(Parent.byClass(b,'notifNegativeBase')){CSS.addClass(b,'notifHover');}else CSS.addClass(b,'selected');},mouseout:function(event){b&&CSS.removeClass(b,'selected');b&&CSS.removeClass(b,'notifHover');b=null;},mousedown:this.onContentMouseDown.bind(this)});Event.listen(this.wrapper,'mouseover',this.onMouseOver.bind(this));Toggler.listen('show',this.wrapper,this.onClick.bind(this));Toggler.listen('hide',this.wrapper,this.onHide.bind(this));this.shouldLogImpressions&&Toggler.listen('show',this.wrapper,this._logImpression.bind(this));var c=function(d){this._poller.requestNow();this.notifLogger.bump(d);}.bind(this);SystemEvents.subscribe(SystemEvents.TIME_TRAVEL,c.curry('time_travel'));SystemEvents.subscribe(SystemEvents.ONLINE,function(d,e){e&&c('online');});if(Parent.byClass(this.wrapper,'notifJewelBeeper')&&!FbDesktopPlugin.shouldSuppressBeeper()&&(this.beeper=window.NotifBeeper))this._initBeeper();this.negativeNotifs={};this._initNotifNegativeFeedback();if(this.useInfiniteScroll){this._setupScroll();this._initializeScrollEvents();this._updateScrollDataStructures.bind(this).defer();this._hideOverflow();}},_setupScroll:function(){this._scrollArea=DOM.scry(this.jewelFlyout,'div.uiScrollableAreaWrap')[0];this._morePagerLink=DOM.find(this.jewelFlyout,'.notifMorePager a');this._morePager=Parent.byClass(this._morePagerLink,'notifMorePager')||this._morePagerLink;this._infiniteScrollNotif=null;this.afterFirstFetch=false;this.animate=false;if(window.MinNotifications&&MinNotifications.fetched()){this.afterFirstFetch=true;CSS.show(this._morePager);}},_initializeScrollEvents:function(){Event.listen(this._scrollArea,'scroll',throttle(this._handleScroll.bind(this)));Event.listen(this._morePagerLink,'success',function(a){this.fetchHandler(a.getData().response);}.bind(this));},_updateScrollDataStructures:function(){var a=this.alertList.getIds(),b=Math.max(0,a.length-this._autoLoadNotifIndex);this._infiniteScrollNotif=this.alertList.getDomObj(a[b]);this._annotateMorePagerURI();},_annotateMorePagerURI:function(){this._morePagerLink.setAttribute('ajaxify',new URI(this._morePagerLink.getAttribute('ajaxify')).addQueryData({earliest_time:this.alertList.getEarliestNotifTime()}));},onContentMouseDown:function(event){var a=Parent.byTag(event.getTarget(),this.alertList.ITEM_TAG),b=a&&NotificationList.getIdFromDom(a);if(b&&this.alertList.isUnreadId(b))this.markRead(true,[b]);},onMouseOver:function(event){this.ua=user_action('jewel',event.target,event).set_namespace('notifs').set_ua_id('prefetch').add_event('hover');this.fetch();},onClick:function(){this.beeper&&this.beeper.clearBeeps();window.ArbiterMonitor&&this.fetch!=bagofholding&&Arbiter.registerCallback(bagofholding,['notifs/fetched']);this.ua.add_event('show');this.fetch();this.markRead(true);this._hideOverflow();},onHide:function(){this.animate=false;this.animation&&this.animation.stop();this.ua.add_event('hide');this.markRead(true);},_handleScroll:function(){if(this._checkInfiniteScroll()){this._autoLoadNotifIndex=5;this._sendFetchRequest(this._morePager);}},_handleInsert:function(a,b){if(b.is_new)this._newDataFromInsert=true;this._updateScrollDataStructures();},_checkInfiniteScroll:function(){if(this._infiniteScrollNotif&&this._scrollArea){var a=Vector2.getElementPosition(this._infiniteScrollNotif).y,b=Vector2.getElementPosition(this._scrollArea).y+Vector2.getElementDimensions(this._scrollArea).y;return a<b;}return false;},_initBeeper:function(){this.beeper.init(this.jewelFlyout);!this.useUnaggregatedBeeper&&this.alertList.subscribe(NotificationList.INSERTION_TYPE,function(a,b){if(Toggler.getInstance(this.wrapper).getActive()!==this.wrapper&&!this.ignoreBeeps&&this.alertList.isUnreadId(b.id)){b.is_new?this.beeper.addBeep(b.id,b.obj):this.beeper.updateBeep(b.replaced_id,b.id,b.obj);this.logImpressionIds([b.id],this.BEEPER_REF);}}.bind(this));!this.useUnaggregatedBeeper&&this.alertList.subscribe(NotificationList.REMOVAL_TYPE,function(a,b){this.beeper.removeBeep(b.id);}.bind(this));this.useUnaggregatedBeeper&&new LiveMessageReceiver('unaggregated_beep').setAppId(this.BEEPER_APPID).setHandler(function(a){Toggler.getInstance(this.wrapper).getActive()!==this.wrapper&&this.beeper.fromMessage(a);}.bind(this)).register();},_initNotifNegativeFeedback:function(){this.notifXList=null;var a=function(b){Bootloader.loadComponents('notif-experiment-negative-notif',b);};a(function(){this.notifXList=window.NotifXList;this.notifXList.init(this);this.alertList.setFilterFn(this.notifXList.filterStoreClicked);Toggler.listen('hide',$(this.wrapperID),function(){for(var b in this.negativeNotifs)if(b)this.negativeNotifs[b] instanceof NegativeNotif&&this.negativeNotifs[b].reset();}.bind(this));Arbiter.subscribe('notif/negativeCancel',function(b,c){this.negativeNotifs[c.id]&&this.negativeNotifs[c.id].restore();}.bind(this));Arbiter.subscribe('notif/negativeConfirmed',function(b,c){this.negativeNotifs[c.id]&&this.negativeNotifs[c.id].onTurnedOff();this.alertList.toggleNotifsSimilarTo(c.id,true,true);this._hideOverflow();this._handleScroll();}.bind(this));Arbiter.subscribe('notif/negativeUndid',function(b,c){this.negativeNotifs[c.id]&&this.negativeNotifs[c.id].onUndid();this.alertList.toggleNotifsSimilarTo(c.id,false,true);this._hideOverflow();}.bind(this));Arbiter.subscribe('notif/negativeMarkedSpam',function(b,c){this.negativeNotifs[c.id]&&this.negativeNotifs[c.id].onMarkedSpam();}.bind(this));Arbiter.subscribe('notif/negativeFirstReceiptYes',function(b,c){this.negativeNotifs[c.id]&&this.negativeNotifs[c.id].onFirstReceiptYes();this.alertList.toggleNotifsSimilarTo(c.id,false,true);}.bind(this));Arbiter.subscribe('notif/negativeFirstReceiptNo',function(b,c){this.negativeNotifs[c.id]&&this.negativeNotifs[c.id].onFirstReceiptNo();this.alertList.toggleNotifsSimilarTo(c.id,false,true);}.bind(this));}.bind(this));this.alertList.subscribe(NotificationList.INSERTION_TYPE,function(b,c){a(function(){var d=DOM.scry(c.obj,'.notif_x');if(d.length==1)this.negativeNotifs[c.id]=new NegativeNotif(this,c);}.bind(this));this._updateFirstReceipt(c);}.bind(this));},_sendIDs:function(a,b,c){var d=c||{};for(var e=0;e<a.length;++e)d['alert_ids['+e+']']=a[e];new AsyncSignal(URI(b).getQualifiedURI().toString(),d).send();},_waitForFetch:function(a){return this.currentFetchRequest&&this.fetchListeners.push(a.bind(this));},_logImpression:function(){var a=this.alertList.getIds();if(a.length===0&&this._waitForFetch(this._logImpression))return;this.logImpressionIds(a,this.NOTIF_JEWEL_REF);},logImpressionIds:function(a,b){this.shouldLogImpressions&&this._sendIDs(a,'/ajax/notifications/impression.php',{ref:b});},markRead:function(a,b){var c=!hasArrayNature(b);b=c?this.alertList.getUnseenIds():b.filter(this.alertList.isUnreadId.bind(this.alertList));if(b.length){a&&this._sendIDs(b,'/ajax/notifications/mark_read.php',{seen:c?1:0});var d=a;c?this.alertList.markSeen(b):this.alertList.markRead(b,d);}c&&this._waitForFetch(this.markRead.bind(this,a));},markAllRead:function(){var a=this.alertList.getUnreadIds();this.markRead(true,a);},_updateErrorHandler:function(a){},_updateURI:'/ajax/presence/update.php',_update:function(a){a.setHandler(this._handleUpdate.bind(this)).setOption('suppressErrorAlerts',true).setErrorHandler(this._updateErrorHandler.bind(this)).setData({notif_latest:this.latest_notif_time,notif_latest_read:this.latest_read_notif_time}).setURI(this._updateURI).setAllowCrossPageTransition(true);},_handleUpdate:function(a){var b=a.payload.notifications;if(!b.no_change){this.updateTime=a.payload.time;this.latest_notif_time=b.latest_notif;this.latest_read_notif_time=b.latest_read_notif;this._updateDisplayDelayed();this.alertList.insertMany(b.notifications);}},_updateDisplayDelayed:function(){if(typeof Beeper!='undefined'){this.beepsExpiredToken=Arbiter.subscribe(Notifications.BEEPS_EXPIRED,this._updateDisplay.bind(this));}else this._updateDisplay();},_updateDisplay:function(){if(!this.content)return;this._updateCount();if(this.beepsExpiredToken)this.beepsExpiredToken.unsubscribe();},_updateCount:function(){Arbiter.inform('jewel/count-updated',{jewel:'notifications',count:this.alertList.unseenCount},Arbiter.BEHAVIOR_STATE);this._hideOverflow();},fetch:function(a){this._sendFetchRequest(a);},_getFetchQueryData:function(){var a={time:this.latest_notif_time,user:this.user,version:this.cache_version,locale:Env.locale};if(this.useInfiniteScroll)a.earliest_time=this.alertList.getEarliestNotifTime();return a;},_sendFetchRequest:function(a){if(this.useInfiniteScroll){this._infiniteScrollNotif=null;this._newDataFromInsert=false;this._truncate=true;}var b=URI('/ajax/notifications/get.php'),c=a||this.loadingIndicator;if(this.currentFetchRequest)return true;this.ua.add_event('fetch');b.setQueryData(this._getFetchQueryData());this.currentFetchRequest=new AsyncRequest().setURI(b).setStatusElement(c).setMethod('GET').setReadOnly(true).setTimeoutHandler(30000,this.fetchErrorHandler.bind(this)).setHandler(this.fetchHandler.bind(this)).setErrorHandler(this.fetchErrorHandler.bind(this)).setAllowCrossPageTransition(true);!this.currentFetchRequest.send()&&this.fetchErrorHandler();return true;},fetchErrorHandler:function(a){this.currentFetchRequest=null;this.ua.add_event('fetch_error');this.useInfiniteScroll&&this._updateScrollDataStructures();},fetchHandler:function(a){this.ua.add_event('fetch_success');var b=a.getPayload();this.alertList.insertMany(b.notifications,true);this.loadingIndicator&&CSS.hide(this.loadingIndicator);this.loadingIndicator=null;this.currentFetchRequest=null;this.fetch=bagofholding;if(this.fetchListeners){for(var c=0;c<this.fetchListeners.length;c++)this.fetchListeners[c]();this.fetchListeners=[];}window.ArbiterMonitor&&Arbiter.inform('notifs/fetched','',Arbiter.BEHAVIOR_STATE);var d=b.generated,e=Math.round((new Date()).getTime()/1000);if(e-d>15)d=e;Bootloader.loadComponents('live-timer',function(){LiveTimer.restart(d);LiveTimer.startLoop(0);});if(this.useInfiniteScroll){if(is_empty(b.notifications)||!this._newDataFromInsert){this._noMoreNotifications();}else CSS.show(this._morePager);this._updateScrollDataStructures();if(Toggler.getInstance(this.wrapper).getActive()==this.wrapper&&this.afterFirstFetch)this.animate=true;this.afterFirstFetch=true;}this._hideOverflow();},_noMoreNotifications:function(){CSS.hide(this._morePager);this.useInfiniteScroll=false;},_mergeNotification:function(a,b,c,d){var e=!this.alertList.isUnreadId(a);this.alertList.insert(a,b,c,true,null,d||null);this.latest_notif_time=0;if(e)this._updateCount();var f=this.alertList.getDomObj(a);if(f)Bootloader.loadComponents('live-timer',function(){LiveTimer.addTimeStamps(f);});},_handleNotificationMsg:function(a,b){var c=b.obj;if(typeof this.useDesktopNotifications=='undefined'){var d;this.useDesktopNotifications=this.allowDesktopNotifications&&window.webkitNotifications&&window.webkitNotifications.checkPermission()===0;}if(this.useDesktopNotifications)Bootloader.loadComponents('desktop-notifications',function(){DesktopNotifications.addNotification(c.alert_id);});if(c.markup){this._mergeNotification(c.alert_id,c.time,c.markup,c.alt_id||null);}else this._poller.requestNow();},_handleNotificationsReadMsg:function(a,b){var c=b.obj;if(typeof Beeper!='undefined')Beeper.getInstance().markRead(false,c.alert_ids);this.markRead(false,c.alert_ids);this.beeper&&this.beeper.fadeOutBeeps(b.obj.alert_ids);},_handleNotificationsSeenMsg:function(a,b){if(!this.unseenVsUnread){this._handleNotificationsReadMsg(a,b);return;}var c=b.obj;if(typeof Beeper!='undefined')Beeper.getInstance().markRead(false,c.alert_ids);this.alertList.markSeen(c.alert_ids);this.beeper&&this.beeper.fadeOutBeeps(b.obj.alert_ids);},_hideOverflow:function(a,b){a=a||DOM.find(this.jewelFlyout,'.jewelFooter');b=b||DOM.scry($('fbNotificationsList'),'.notification');this.scrollableAreaNode=this.scrollableAreaNode||DOM.scry(this.jewelFlyout,'.uiScrollableArea')[0];var c=20;if(!b.length||(CSS.hasClass(document.documentElement,'tinyViewport')&&!CSS.hasClass(document.body,'fixedBody'))){CSS.setStyle(this.scrollableAreaNode,'height','100%');return;}var d=this.scrollableAreaNode||b[0],e=Vector2.getViewportDimensions().y-Vector2.getElementPosition(d,'viewport').y-Vector2.getElementDimensions(a).y-5,f=e,g=0;for(;g<b.length&&f>0;++g)if(CSS.shown(b[g]))f-=Vector2.getElementDimensions(b[g]).y;var h=530,i=Math.min(h,e-Math.max(f,0));if(f>=0&&i<h){if(!this.useInfiniteScroll||(this.beeper&&this.beeper.hasBeeps())){i='100%';}else{if(this._truncate&&b.length>=5)i-=c;i+='px';}}else i+='px';if(this.useInfiniteScroll&&this.animate&&i!='100%'){this.animation&&this.animation.stop();this.animation=animation(this.scrollableAreaNode).to('height',i).duration(200).go();}else{var j=ScrollableArea.getInstance(this.scrollableAreaNode);j&&j.showScrollbar.bind(j).defer();CSS.setStyle(this.scrollableAreaNode,'height',i);}},_updateFirstReceipt:function(a){var b=a.obj.getAttribute('data-appid'),c=DOM.scry(a.obj,'.first_receipt_div');if(b&&c.length==1){if(this.firstReceiptMap[b]){if(a.id!=this.firstReceiptMap[b].id&&this.firstReceiptMap[b].time>a.time)return;CSS.removeClass(this.firstReceiptMap[b].obj,'first_receipt');}this.firstReceiptMap[b]=a;CSS.addClass(a.obj,'first_receipt');}}});var OriginalNotifications=Notifications;
__d("SearchDataSource",["event-extensions","Arbiter","AsyncResponse","Class","DataSource","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncResponse'),i=b('Class'),j=b('DataSource'),k=b('copyProperties'),l=b('createArrayFrom');function m(n){this._token=n.token||'';this._lazyonload=n.lazyonload===false?false:true;this._extraTypes=n.extraTypes;this._buckets=n.buckets;this._noMultiFetch=n.noMultiFetch||false;var o=n.maxResults||8;this.parent.construct(this,n);this._numResults={min:3,max:o};this._genTime=n.genTime;}i.extend(m,j);k(m.prototype,{init:function(){this.parent.init();this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();Event.listen(window,'resize',this._updateMaxResults.bind(this));},dirty:function(){this.parent.dirty();this._fetchOnUseRequests=[];},asyncErrorHandler:function(n){if(window.Dialog&&window.Dialog.getCurrent()==null&&n.getError()==1400003)h.verboseErrorHandler(n);},fetch:function(n,o,p){p=p||{};p.fetch_start=Date.now();this.parent.fetch(n,o,p);},fetchHandler:function(n,o){var p=n.getPayload(),q=k({fetch_end:Date.now()},o),r=q.value?g.BEHAVIOR_EVENT:g.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:n});if(o.type=='lean'){this._leanPayload=p;this._processLean();}else{if(p.coeff2_ts)q.coeff2_ts=p.coeff2_ts;this.parent.fetchHandler(n,o);if(o.bootstrap&&!n.getRequest().getData().no_cache)q.browserCacheHit=(p.timestamp<this._genTime);if(o.bootstrap&&!p.no_data&&this._bootstrapRequestsPending>0){o.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(p.no_data||p.token!==this._token){var s=k({},n.getRequest().getData());if(s.lazy){delete s.lazy;s.token=this._token;this._fetchOnUse(s,o);}}}this.inform('endpointStats',q,r);},_bootstrapPostProcess:function(){var n={time:Date.now()};this.inform('bootstrapped',n,g.BEHAVIOR_PERSISTENT);this._processLean();},_processLean:function(){if(this._leanPayload){var n,o=this._leanPayload.entries;for(var p in o){n=this.getEntry(p);n&&(n.index=o[p]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}},_updateMaxResults:function(){var n=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((n-370)/56)))));},_bootstrapFetch:function(n,o){var p=k(o,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)p.lazy=1;this.fetch(this.bootstrapEndpoint,p,{bootstrap:true,type:n});++this._bootstrapRequestsPending;},_fetchOnUse:function(n,o){for(var p in this.bootstrapData)!n.hasOwnProperty(p)&&(n[p]=this.bootstrapData[p]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:n,ctx:o});}else this.fetch(this.bootstrapEndpoint,n,o);},_fetchLean:function(){var n={no_cache:1};n.options=l(n.options);n.options.push('lean');this._fetchOnUse(n,{type:'lean'});},bootstrap:function(n){if(!n){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var o={filter:['event'],no_cache:1};this._fetchOnUse(o,{type:'event'});var p=['app','page','group','friendlist'];p=p.concat(this._extraTypes||[]);if(this._noMultiFetch){p.push('user');this._bootstrapFetch('user',{filter:p});}else{this._bootstrapFetch('other',{filter:p});if(this._buckets){for(var q=0;q<this._buckets.length;++q){var r={filter:['user'],buckets:this._buckets[q]};this._bootstrapFetch('user',r);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;},_flushFetchOnUseRequests:function(){var n=this._fetchOnUseRequests.length;for(var o=0;o<n;++o){var p=this._fetchOnUseRequests[o];this.fetch(this.bootstrapEndpoint,p.args,p.ctx);}this._fetchOnUseRequests=[];},onLoad:function(n,o){this.inform('onload',{time:Date.now()},g.BEHAVIOR_PERSISTENT);if(n)this.bootstrap.bind(this,o).defer();},mergeUids:function(n,o,p,q){var r=p[0]?this.getEntry(p[0]):null,s=o[0]?this.getEntry(o[0]):null,t=(r&&r.replace_results)?r:null;t=(!t&&s&&s.replace_results)?s:t;var u=this.parent.mergeUids(n,o,p,q);if(t){this.inform('backend_topreplace',{});return this.deduplicateByKey([t.uid].concat(u));}return u;}});e.exports=m;});
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["event-extensions","function-extensions","Arbiter","Class","DOM","Input","Parent","TypeaheadCore","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('Class'),i=b('DOM'),j=b('Input'),k=b('Parent'),l=b('TypeaheadCore'),m=b('URI'),n=b('copyProperties');function o(p){this.parent.construct(this,p);}h.extend(o,l);n(o.prototype,{init:function(p,q,r){this.parent.init(p,q,r);var s=k.byTag(r,'form'),t=this.reset.bind(this);g.subscribe('pre_page_transition',function(event,v){var w=/^\/search/,x=w.test(v.from.path),y=w.test(v.to.path);if(x&&!y)t.defer();});if(s){var u=i.find(s,'input.search_sid_input');Event.listen(s,'submit',function(){if(this.data&&this.data.queryData)u.value=this.data.queryData.sid;t.defer();}.bind(this),Event.Priority.URGENT);}},select:function(){this.reset();this.element.focus();(function(){this.element.blur();}).bind(this).defer();},handleTab:function(event){var p=this.view.getQuerySuggestion(this.value);if(p){j.setValue(this.element,p);this.checkValue();event.kill();}else this.parent.handleTab(event);}});e.exports=o;});
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","Class","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('Class'),j=b('ContextualLayerUpdateOnScroll'),k=b('copyProperties'),l=b('DOM'),m=b('goURI'),n=b('MusicConstants'),o=b('MusicEvents'),p=b('tx'),q=b('URI');function r(s,t){this.parent.construct(this,s,t);}i.extend(r,h);k(r.prototype,{initializeLayer:function(){this.parent.initializeLayer();this.layer.setOffsetY(-1);this.layer.enableBehavior(j);},ignoreClick:function(event){event.prevent();},shouldShowSeeMore:true,queryData:{init:'quick'},render:function(s,t,u){var v={results:t};this.inform('beginRender',v);return this.parent.render(s,v.results,u);},buildBuckets:function(s,t){var u=t.length;this.setWebSuggLoggingParams(s,t);t=this.parent.buildBuckets(s,t);if(s&&this.shouldShowSeeMore)t.push(this.buildSeeMore(s,u));return t;},buildSeeMore:function(s,t){var u=t>0?p._("\u0645\u0634\u0627\u0647\u062f\u0629 \u0627\u0644\u0645\u0632\u064a\u062f \u0645\u0646 \u0646\u062a\u0627\u0626\u062c {query}",{query:s}):p._("\u0645\u0634\u0627\u0647\u062f\u0629 \u0646\u062a\u0627\u0626\u062c {query}",{query:s}),v=t==1?"\u064a\u062c\u0631\u064a \u0639\u0631\u0636 \u0627\u0644\u0646\u062a\u0627\u0626\u062c \u0627\u0644\u0623\u0648\u0644\u0649":p._("\u064a\u062c\u0631\u064a \u0639\u0631\u0636 \u0627\u0644\u0646\u062a\u0627\u0626\u062c \u0627\u0644\u0640 {number} \u0627\u0644\u0623\u0648\u0644\u0649",{number:t}),w=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getSeeMoreEndpoint(s),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'seeMore'},[u,l.create('span',{className:'arrow'})]),l.create('span',{className:'subtext'},[v])])])]);w.setAttribute('aria-label',u);return {uid:'search',node:w,search:true};},searchPageQueryData:function(s){return k({q:s},this.queryData||{});},select:function(s){var t=this.index,u=this.results[t];if(!u||u.type=='header')return;var v=this.items[t],w=l.scry(v,'a')[0];if(u.song){if(w)o.inform(n.MUSIC_BUTTON.ACTIVATE,w);s&&this.inform('highlight',{index:t,selected:u});}else{this.parent.select(s);if(w&&w.href)if(w.target=='_blank'){window.open(w.href);}else m(w.href);}},setSid:function(s){this.queryData.tas=s;},getSeeMoreEndpoint:function(s){return q(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(s)).toString();},show:function(){if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});this.parent.show();}},hide:function(){if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});this.parent.hide();}},getQuerySuggestion:function(s){var t=this.results[this.index],u=t&&t.type!='header'?t.text.toLowerCase():'';return u==s.toLowerCase()?'':u;},setWebSuggLoggingParams:function(s,t){var u=0,v=0;for(var w=0;w<t.length;w++)if(t[w].type==='websuggestion'){if(v===0)v=w+1;var x='FR'+(w-u)+'AS'+u,y=w+1;t[w].path+='&wssk='+x+'&wssp='+y+'&wspq='+encodeURIComponent(s);u++;}var z='&wssc='+t.length+'-'+s.length+'&wsbp='+u+'-'+v;for(w=0;w<t.length;w++)if(t[w].type==='websuggestion')t[w].path+=z;}});e.exports=r;});
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["AsyncRequest","Keys","$","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Keys'),i=b('$'),j=b('copyProperties'),k=b('userAction');function l(m){this.init(m);this.initEvents();}j(l.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',init:function(m){this.core=m.getCore();this.data=m.getData();this.view=m.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this.initStartTime=i('search_first_focus').value;this.bootstrapStats={bootstrapped:0};this._reset();},_reset:function(){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this._topreplace=false;this._inflightRequests={};var m=Math.random();this.data.setQueryData({sid:m});this.view.setSid(m);this.recordStat('sid',m);},initEvents:function(){this.core.subscribe('focus',function(event){if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());}.bind(this));this.core.subscribe('blur',function(event){var m=Date.now();for(var n in this._inflightRequests){var o=this._inflightRequests[n],p=m-o;this.recordAvgStat('search_endpoint_ms_from_js',p);}this.recordStat('session_end_time',m);this.submit();}.bind(this));this.view.subscribe('select',function(m,n){this.recordSelectInfo(n);}.bind(this));this.view.subscribe('render',function(m,n){this.recordRender(n);}.bind(this));this.view.subscribe('recordAfterReorder',function(m,n){this._reorderInfo=n;}.bind(this));this.data.subscribe('activity',function(m,n){this.recordStat('pending_request',n.activity);}.bind(this));this.data.subscribe('beforeQuery',function(m,n){if(!n.value)return;if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=n.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(m,n){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',n.value.length);this._inflightRequests[n.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(m,n){this._onloadTime=n.time;}.bind(this));this.data.subscribe('bootstrapped',function(m,n){this.bootstrapStats.endTime=n.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.data.subscribe('endpointStats',function(m,n){var o=n.fetch_end-n.fetch_start;if(n.value){this.recordAvgStat('search_endpoint_ms_from_js',o);}else this.bootstrapStats[n.type]=o;if(n.coeff2_ts)this.bootstrapStats.coeff2_ts=n.coeff2_ts;if(typeof n.browserCacheHit!='undefined')this.recordCountStat(n.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[n.value])delete this._inflightRequests[n.value];}.bind(this));this.data.subscribe('query',function(m,n){this.recordAvgStat('num_results_from_cache',n.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(m,n){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));Event.listen(this.element,'keydown',function(event){if(Event.getKeyCode(event)==h.BACKSPACE){if(!this._backspacing){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));},recordStat:function(m,n){this.stats[m]=n;},recordCountStat:function(m){var n=this.stats[m];this.stats[m]=n?n+1:1;},recordAvgStat:function(m,n){if(this.avgStats[m]){this.avgStats[m][0]+=n;++this.avgStats[m][1];}else this.avgStats[m]=[n,1];},recordAppendStat:function(m,n){if(!this.appendStats.hasOwnProperty(m))this.appendStats[m]=[];this.appendStats[m].push(n);},recordRender:function(m){this.results=m.filter(function(n){return n.uid!='search'&&n.type!='header';});if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());},recordSelectInfo:function(m){var n=m.selected,o=m.index-n.groupIndex-1,p={href:n.path},q=n.dataGT?{gt:JSON.parse(n.dataGT)}:{};k('click',p,null,null,q);if(n.uid=='search'){this.recordStat('selected_search',1);}else{var r=n.rankType||n.render_type||n.type,s=(r=='friend'?'user':r);this.recordStat('selected_'+s,1);this.recordStat('selected_position',o);this.recordStat('selected_type',r);this.recordStat('selected_name_length',n.text.length);this.recordStat('selected_id',n.uid);this.recordStat('selected_degree',n.bootstrapped?1:2);}this.recordStat('selected_with_mouse',m.clicked?1:0);},_dataToSubmit:function(){this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this._reorderInfo){var m=this._reorderInfo;this.recordStat('s_organic_results',JSON.stringify(m.organic));this.recordStat('s_candidate_tokens',JSON.stringify(m.tokens));}var n=this.stats;for(var o in this.avgStats){var m=this.avgStats[o];n[o]=m[0]/m[1];}for(var p in this.appendStats)n[p]=JSON.stringify(this.appendStats[p]);return n;},buildResults:function(){var m=(this.results||[]).map(function(n,o){var p=n.rankType||n.render_type||n.type,q=n.bootstrapped?1:0,r=n.s_token||'';if(typeof n.groupIndex=='number')return [n.groupIndex,n.indexInGroup,n.uid,p,q,r];return [0,o,n.uid,p,q,r];});return JSON.stringify(m);},submit:function(){var m=this._dataToSubmit();if(Object.keys(m).length>0)new g().setURI(this._endPoint).setMethod('POST').setData({stats:m}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(n){m.retry=true;new g().setURI(this._endPoint).setMethod('POST').setData({stats:m}).setOption('asynchronous',false).send();}.bind(this)).send();this._reset();}});e.exports=l;});
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties"],function(a,b,c,d,e,f){var g=b('SearchTypeaheadRecorder'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{enable:function(){new g(this._typeahead);},disable:bagofholding});e.exports=i;});
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d){var e=b('TypeaheadSearchRecorderBasic');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(f){f.enableBehavior(e);};},3);
__d("SearchTypeaheadRenderer",["DOM","Env","MusicButtonManager","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('MusicButtonManager'),j=b('TypeaheadUtil');function k(l,m){var n=[];if(l.photo){n.push(g.create('img',{className:'photo',alt:'',src:l.photo}));if(l.song){n.push(g.create('span',{className:'playButton'}));n.push(g.create('span',{className:'playLoader'}));}}if(l.text){var o=l.alias,p=this.value,q=l.text,r=[q];if(o&&j.isQueryMatch(p,o)&&!j.isQueryMatch(p,q))r.push(g.create('span',{className:'alias'},[' \xB7 '+o]));n.push(g.create('span',{className:'text'},r));}if(l.category){var s=[l.category];if(l.is_external)s.push(g.create('span',{className:'arrow'}));var t=l.message?'preCategory':'category';n.push(g.create('span',{className:t},s));}if(l.message)n.push(g.create('span',{className:'category'},[l.message]));var u=l.subtextOverride||l.subtext;if(u)n.push(g.create('span',{className:'subtext'},[u]));var v=l.classNames||l.type||'',w=l.is_external?'_blank':'',x=!l.song&&l.path||'';if(x){if(!(/^https?\:\/\//).test(x))x=h.www_base+x.substr(1);x+=(x.indexOf('?')>0?'&':'?')+'ref=ts';}var y=g.create('a',{href:x,rel:'ignore',target:w},n);if(l.song){y.id='mb_'+(Math.random()*1e+06|0);i.addButton.curry(l.song.provider,y.id,l.song.url,l.song.context,l.song.media_type).defer();y.onclick=this.ignoreClick;}var z=g.create('li',{className:v},[y]);z.setAttribute('role','option');if(l.text)z.setAttribute('aria-label',l.text);return z;}k.className='search';e.exports=k;});
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(k,l){if(l.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=l.filter_type;}),g.subscribe('page_transition',function(k,l){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;},g.SUBSCRIBE_NEW)];},disable:function(){this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;}});e.exports=i;});
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d){var e=b('TypeaheadSearchFilter');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(f){f.enableBehavior(e);};},3);
__d("Quickling",["AjaxPipeRequest","Arbiter","Class","DataStore","DocumentTitle","DOM","HTML","OnloadHooks","PageTransitions","Run","URI","UserAgent","copyProperties","goOrReplace","isEmpty"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('Class'),j=b('DataStore'),k=b('DocumentTitle'),l=b('DOM'),m=b('HTML'),n=b('OnloadHooks'),o=b('PageTransitions'),p=b('Run'),q=b('URI'),r=b('UserAgent'),s=b('copyProperties'),t=b('goOrReplace'),u=b('isEmpty'),v={isActive:function(){return v._is_active||false;},init:function(x,y,z){if(v._is_initialized)return;s(v,{_is_initialized:true,_is_active:true,_session_length:y,_is_in_transition:false,_title_interval:false,_ie_cache_title:'',_version:x});v._instrumentTimeoutFunc('setInterval');v._instrumentTimeoutFunc('setTimeout');v._inactivePageRegex=new RegExp(z);o.registerHandler(v._transitionHandler,1);},_startQuicklingTransition:function(){v._is_in_transition=true;},_stopQuicklingTransition:function(){(function(){v._is_in_transition=false;}).defer();},isPageActive:function(x){if(x=='#')return false;x=new q(x);if(x.getDomain()&&x.getDomain()!=q().getDomain())return false;if(x.getPath()=='/l.php'){var y=x.getQueryData().u;if(y){y=q(unescape(y)).getDomain();if(y&&y!=q().getDomain())return false;}}var z=x.getPath(),aa=x.getQueryData();if(!u(aa))z+='?'+q.implodeQuery(aa);return !v._inactivePageRegex.test(z);},_setHTML:function(x,y){if(r.ie()<=6){x.innerHTML=y;}else l.setContent(x,m(y).setDeferred(true));},_transitionHandler:function(x){g.setCurrentRequest(null);if(v._isTimeToRefresh())return false;if(!v.isPageActive(x))return false;window.ExitTime=(new Date()).getTime();p.__removeHook('onafterloadhooks');p.__removeHook('onloadhooks');n.runHooks('onleavehooks');h.inform('onload/exit',true);v._startQuicklingTransition();new w(x).setCanvasId('content').send();return true;},_changePageTitle:function(x){x=x||'Facebook';k.set(x);if(r.ie()){v._ie_cache_title=x;if(!v._title_interval)v._title_interval=window.setInterval(function(){var y=v._ie_cache_title,z=k.get();if(y!=z)k.set(y);},5000,false);}},_replaceSyndicationLinks:function(x){var y=document.getElementsByTagName('link');for(var z=0;z<y.length;++z){if(y[z].rel!='alternate')continue;l.remove(y[z]);}if(x.length){var aa=l.find(document,'head');aa&&l.appendContent(aa,m(x[0]));}},_isTimeToRefresh:function(){v._load_count=(v._load_count||0)+1;return v._load_count>=v._session_length;},_instrumentTimeoutFunc:function(x){window[x+'_native']=(function(y){var z=function aa(ba,ca){return y(ba,ca);};return z;})(window[x]);window[x]=function y(z,aa,ba){var ca=window[x+'_native'](z,aa);if(aa>0)if(ba!==false)p.onLeave(function(){clearInterval(ca);});return ca;};}};function w(x){var y={version:v._version};this.parent.construct(this,x,{quickling:y});}i.extend(w,g);s(w.prototype,{_preBootloadFirstResponse:function(x){return true;},_fireDomContentCallback:function(){this._request.cavalry&&this._request.cavalry.setTimeStamp('t_domcontent');v._stopQuicklingTransition();o.transitionComplete();this._onPageDisplayed&&this._onPageDisplayed(this.pipe);this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this._request.cavalry){this._request.cavalry.setTimeStamp('t_hooks');this._request.cavalry.setTimeStamp('t_layout');this._request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},isPageActive:function(x){return v.isPageActive(x);},_versionCheck:function(x){if(x.version!=v._version){var y=['quickling','ajaxpipe','ajaxpipe_token'];t(window.location,q(x.uri).removeQueryData(y),true);return false;}else return true;},_processFirstResponse:function(x){var y=x.getPayload();v._changePageTitle(y.title);v._replaceSyndicationLinks(y.syndication||[]);window.scrollTo(0,0);var z=y.body_class||'';document.body.className=z;},getSanitizedParameters:function(){return ['quickling'];}});e.exports=a.Quickling=v;});
__d("legacy:SimpleDrag",["SimpleDrag"],function(a,b,c,d){a.SimpleDrag=b('SimpleDrag');},3);
function SidebarTicker(){}copy_properties(SidebarTicker.prototype,{ALMOST_ZERO:1e-07,init:function(){this._ticker=$('pagelet_ticker');this._initSubscriptions();CSS.addClass(document.documentElement,'ticker');if(CSS.hasClass(document.documentElement,'sidebarMode'))this._onSidebarShow();return this;},initResizeBehavior:function(a){var b=this._ticker,c=b.parentNode,d=this._saveResizedState.bind(this),e=this.ALMOST_ZERO,f,g,h,i=function(l,event){f=event.clientY;g=b.offsetHeight;h=c.offsetHeight;},j=function(l,event){var m=g+(event.clientY-f),n=100-(((h-m)/h)*100);n=Math.max(e,Math.min(90,n));b.style.height=n+'%';if(l=='end'){d(n);Arbiter.inform('Ticker/resized');}window.ChatSidebar&&ChatSidebar.resize();},k=new SimpleDrag(a);k.subscribe('start',i);k.subscribe(['update','end'],j);},_saveResizedState:function(a){new AsyncRequest('/ajax/feed/ticker/resize').setData({height:''+a}).setMethod('POST').send();},_initSubscriptions:function(){this._subscriptions=[Arbiter.subscribe('sidebar/show',this._onSidebarShow.bind(this))];},_onSidebarShow:function(){TickerController.show(this._ticker);}});
__d("legacy:MusicButtonManager",["MusicButtonManager"],function(a,b,c,d){a.MusicButtonManager=b('MusicButtonManager');},3);
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.compact=b('CompactTypeaheadRenderer');},3);
__d("BanzaiODS",["Banzai"],function(a,b,c,d,e,f){var g=b('Banzai'),h={};function i(k,l,m,n){var o=h[k]||(h[k]={});o=o[l]||(o[l]={});o=o[m]||(o[m]=[]);for(var p=0;p<n.length;p++){var q=n[p]==null?1:Number(n[p]);if(isFinite(q))o[p]=(o[p]||0)+q;}}g.subscribe(g.SEND,function(){for(var k in h){g.post('ods',h);break;}h={};});var j={bumpEntityKey:function(k,l,m){i('bEK',k,l,[m]);},bumpFraction:function(k,l,m,n){i('bF',k,l,[m,n]);}};e.exports=j;});
__d("OptionStorage",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=window.localStorage||null;function i(j,k,l){this.name=j;this.reviver=k||this._reviver;this.replacer=l||this._replacer;this._read();}g(i.prototype,{_read:function(j,k){if(h&&h[this.name]){this.options=JSON.parse(h[this.name],this.reviver);}else this.options={};},_write:function(){if(h){var j=g({},this.options);h[this.name]=JSON.stringify(j,this.replacer);}},_reviver:function(j,k){if(k){var l=/^\[RegExp (.*)\]$/.test(k)&&RegExp.$1;if(l)k=new RegExp(l.replace(/^\/|\/$/g,''));return k;}},_replacer:function(j,k){if(k instanceof RegExp){k='[RegExp '+k+']';this[j]=k;}return k;},get:function(j,k){return j in this.options?this.options[j]:k;},set:function(j,k){if(k==null){delete this.options[j];}else this.options[j]=k;this._write();}});e.exports=i;});
__d("UserActionHistory",["Arbiter","ClickRefUtils","throttleAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ClickRefUtils'),i=b('throttleAcrossTransitions'),j={click:1,submit:1},k=false,l={log:[],len:0},m=i(function(){try{k._ua_log=JSON.stringify(l);}catch(p){k=false;}},1000);function n(){try{if(a.sessionStorage){k=a.sessionStorage;k._ua_log&&(l=JSON.parse(k._ua_log));}}catch(p){k=false;}l.log[l.len%10]={ts:Date.now(),path:'-',index:l.len,type:'init',iref:'-'};l.len++;g.subscribe("UserAction/new",function(q,r){var s=r.ua,t=r.node,event=r.event;if(!event||!(event.type in j))return;var u={path:window._script_path,type:event.type,ts:s._ue_ts,iref:h.get_intern_ref(t)||'-',index:l.len};l.log[l.len++%10]=u;k&&m();});}function o(){return l.log.sort(function(p,q){return (q.ts!=p.ts)?(q.ts-p.ts):(q.index-p.index);});}n();e.exports={getHistory:o};});
function FansJewel(){}copy_properties(FansJewel.prototype,{init:function(a){this.jewel=a;this.jewel.subscribe('marked-seen',this._markSeenCallback.shield(this));},_markSeenCallback:function(a,b){new AsyncRequest('/ajax/pages/fans_seen.php').setMethod('POST').send();}});
__d("OGSliderAnimPager",["event-extensions","Animation","CSS","DOM","Style","Parent","copyProperties","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('CSS'),i=b('DOM'),j=b('Style'),k=b('Parent'),l=b('copyProperties'),m=b('tx');function n(o,p,q){this._pagenum=0;this._total=p;this._peekurls=q;this._pages=i.scry(o,'.page');this._prevlink=i.find(o,'.ogSliderAnimPagerPrevContent');this._nextlink=i.find(o,'.ogSliderAnimPagerNextContent');this._prevarrow=i.find(o,'.ogSliderAnimPagerPrevWrapper .ogSliderAnimPagerPrevSlider');this._nextarrow=i.find(o,'.ogSliderAnimPagerNextWrapper .ogSliderAnimPagerNextSlider');this._nextBackground=i.find(o,'.ogSliderAnimPagerNextBackground');this._rangetext=i.scry(o,'.rangeText')[0];this._story=k.byClass(o,'uiStreamStory');this._storyContent=i.find(this._story,'.storyContent');this._actorPhoto=i.scry(this._story,'.actorPhoto')[0];this._highlightSelector=i.scry(this._story,'.highlightSelector')[0];this._slider=i.find(o,'.ogSliderAnimPagerMainColumn .ogSliderAnimPagerAllStories');this.addListeners();this.init();this.transition(0);}l(n.prototype,{init:function(){this.SLIDING_TIME=250;this.FADING_TIME=200;this.BK_IMG_OPC=.2;this.BK_IMG_HIGHLIGHT_OPC=.4;this.BK_LEFT_OPC=.4;this.ARROW_OPC=.6;this.ARROW_HIGHLIGHT_OPC=1;j.set(this._story,'border-right-width','1px');j.set(this._story,'z-index','0');j.set(this._story,'position','relative');if(this._actorPhoto){j.set(this._actorPhoto,'z-index','1');j.set(this._actorPhoto,'position','relative');}if(this._highlightSelector)j.set(this._highlightSelector,'margin-top','-1px');this._leftShadow=i.create('div',{className:'ogSliderAnimPagerLeftShadow'});this._storyContent.appendChild(this._leftShadow);this._rightShadow=i.create('div',{className:'ogSliderAnimPagerRightShadow'});this._storyContent.appendChild(this._rightShadow);},addListeners:function(){Event.listen(this._storyContent,'mouseover',this.storyContentMouseOver.bind(this));Event.listen(this._storyContent,'mouseleave',this.storyContentMouseLeave.bind(this));Event.listen(this._prevlink,'mouseover',this.prevLinkMouseOver.bind(this));Event.listen(this._prevlink,'mouseleave',this.prevLinkMouseLeave.bind(this));Event.listen(this._prevlink,'click',this.transition.bind(this,-1));Event.listen(this._nextlink,'mouseover',this.nextLinkMouseOver.bind(this));Event.listen(this._nextlink,'mouseleave',this.nextLinkMouseLeave.bind(this));Event.listen(this._nextlink,'click',this.transition.bind(this,1));},transition:function(o){if(o){this._pagenum+=o;this._hiddenElems=[];var p=i.scry(this._pages[this._pagenum],'.ogSingleStoryStatus');if(p.length){p=p.shift();this._hiddenElems.push(p);}var q=i.scry(this._pages[this._pagenum],'.ogSingleStoryActionLinks');if(q.length)this._hiddenElems.push(q[0]);for(var r=0;r<this._hiddenElems.length;r++){var s=this._hiddenElems[r];h.setStyle(s,'opacity',0);}h.setStyle(this._pages[this._pagenum],'visibility','visible');h.setStyle(this._pages[this._pagenum],'opacity',1);h.hide(this._nextlink);h.hide(this._prevlink);}if(this._rangetext){var t=m._("{page} \u0645\u0646 {total}",{page:this._pagenum+1,total:this._total});i.setContent(this._rangetext,t);}if(this._pagenum+1!==this._total)h.setStyle(this._nextBackground,'background-image',this._peekurls[this._pagenum+1]);if(o>0){this.slideLeft();}else if(o<0){this.slideRight();}else{h.conditionShow(this._prevlink,this._pagenum>0);h.conditionShow(this._nextlink,this._pagenum+1!==this._total);}},slideLeft:function(){new g(this._slider).by('left','-411px').duration(this.SLIDING_TIME).ease(g.ease.end).checkpoint(1,this.clearupAnimation.bind(this)).go();this.fadeoutPageToLeft();this.fadeoutHiddenElems();if(this._pagenum+1!=this._pages.length){h.setStyle(this._pages[this._pagenum+1],'opacity',this.BK_IMG_OPC);h.setStyle(this._pages[this._pagenum+1],'visibility','visible');}},fadeoutPageToLeft:function(){new g(this._pages[this._pagenum-1]).to('opacity',this.BK_LEFT_OPC).duration(this.SLIDING_TIME).go();},slideRight:function(){new g(this._slider).by('left','411px').duration(this.SLIDING_TIME).ease(g.ease.end).checkpoint(1,this.clearupAnimation.bind(this)).go();this.fadeoutPageToRight();this.fadeoutHiddenElems();},fadeoutPageToRight:function(){new g(this._pages[this._pagenum+1]).to('opacity',this.BK_IMG_OPC).duration(this.SLIDING_TIME).go();},fadeoutHiddenElems:function(){for(var o=0;o<this._hiddenElems.length;o++){var p=this._hiddenElems[o];new g(p).to('opacity',1).duration(this.FADING_TIME).go();}},clearupAnimation:function(){if(this._pagenum>0){h.show(this._prevlink);h.setStyle(this._pages[this._pagenum-1],'visibility','hidden');h.setStyle(this._pages[this._pagenum-1],'opacity',1);}if(this._pagenum+1!==this._total){h.show(this._nextlink);h.setStyle(this._pages[this._pagenum+1],'visibility','hidden');h.setStyle(this._pages[this._pagenum+1],'opacity',1);}for(var o=0;o<this._hiddenElems.length;o++){var p=this._hiddenElems[o];h.setStyle(p,'visibility','auto');}},prevLinkMouseOver:function(){h.setStyle(this._prevarrow,'opacity',this.ARROW_HIGHLIGHT_OPC);},prevLinkMouseLeave:function(){h.setStyle(this._prevarrow,'opacity',this.ARROW_OPC);},nextLinkMouseOver:function(){h.setStyle(this._nextarrow,'opacity',this.ARROW_HIGHLIGHT_OPC);h.setStyle(this._nextBackground,'opacity',this.BK_IMG_HIGHLIGHT_OPC);},nextLinkMouseLeave:function(){h.setStyle(this._nextarrow,'opacity',this.ARROW_OPC);h.setStyle(this._nextBackground,'opacity',this.BK_IMG_OPC);},storyContentMouseOver:function(){h.setStyle(this._leftShadow,'visibility','visible');h.setStyle(this._rightShadow,'visibility','visible');h.setStyle(this._story,'border-right-color','#ccc');},storyContentMouseLeave:function(){h.setStyle(this._leftShadow,'visibility','hidden');h.setStyle(this._rightShadow,'visibility','hidden');h.setStyle(this._story,'border-right-color',h.getStyle(this._story,'border-left-color'));}});e.exports=n;});