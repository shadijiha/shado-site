/*1337574643,169776065*/

if (window.CavalryLogger) { CavalryLogger.start_js(["FnYgE"]); }

function UIThumbPager(a,b,c,d,e){if(!a)return false;copy_properties(this,{root:$(a),ancestor:c||a.parentNode,thumbs:DOM.scry(a,'div.UIThumbPager_Thumbs img'),thumbRoot:DOM.find(a,'div.UIThumbPager_Thumbs'),loaded:[],index:0,loadCount:0,lastLoadCount:0,onloadCallback:bagofholding,onhideCallback:bagofholding,input:null,originalWidthInput:0,originalHeightInput:0,timeout:null,finished:false,minWidth:d,minHeight:e});this.loader=DOM.find(this.root,'div.UIThumbPager_Loader');if(b)if(!this.input){this.input=$N('input',{name:b,type:'hidden'});this.originalWidthInput=$N('input',{name:'uithumbpager_width',type:'hidden'});this.originalHeightInput=$N('input',{name:'uithumbpager_height',type:'hidden'});this.ancestor.appendChild(this.input);this.ancestor.appendChild(this.originalWidthInput);this.ancestor.appendChild(this.originalHeightInput);}this.maxWidth=CSS.getStyle(this.root,'width');this.root.getUIThumbPager=bagof(this);}UIThumbPager.prototype.setOnloadCallback=function(a){this.onloadCallback=a;this.init();return this;};UIThumbPager.prototype.setOnhideCallback=function(a){this.onhideCallback=a;return this;};UIThumbPager.prototype.init=function(){this.thumbs.forEach(function(a){if(a.complete){this.onload(a);}else{var b=false;Event.listen(a,'load',function(){if(!b){this.onload(a);b=true;}}.bind(this));}}.bind(this));this.timeout=setInterval(this.timeoutTriggered.bind(this),UIThumbPager.loadtimeout);};UIThumbPager.prototype.timeoutTriggered=function(){if(this.lastLoadCount==this.loadCount&&!this.finished)this.onfinish();this.lastLoadCount=this.loadCount;};UIThumbPager.prototype.onload=function(a){if(this.checkLimits(a)){CSS.setStyle(a,'width',this.maxWidth);this.addLoadedImage(a);this.onloadCallback(this.loaded.length);}if(++this.loadCount==this.thumbs.length)this.onfinish();};UIThumbPager.prototype.addLoadedImage=function(a){var b=a.width*a.height,c=this.loaded.push(a)-1;if(!this.finished)while(c>0){var d=Math.floor(c/2),e=this.loaded[d],f=e.width*e.height;if(b<=f){break;}else{this.loaded[d]=a;this.loaded[c]=e;c=d;}}};UIThumbPager.prototype.onfinish=function(){clearInterval(this.timeout);if(this.finished)return;this.finished=true;if(this.loaded.length){if(this.index==0){this.loaded=UIThumbPager.sort(this.loaded);this.first();}}else{CSS.hide(this.root);this.onhideCallback();}};UIThumbPager.prototype.page=function(a,b){if(this.index==a)return true;if(!this.finished)this.finished=true;if(this.loader){CSS.setStyle(this.loader,'display','none');this.loader=null;}var c=this.index;this.index+=b;var d=new Image();d.src=this.loaded[this.index].src;d.onload=function(){this.originalWidthInput.value=d.width;this.originalHeightInput.value=d.height;}.bind(this);UIThumbPager.swap(this.loaded[c],this.loaded[this.index],this.input);if(this.index==a)return true;return false;};UIThumbPager.prototype.first=function(){return this.page(null,-this.index);};UIThumbPager.prototype.prev=function(){return this.page(0,-1);};UIThumbPager.prototype.next=function(){return this.page(this.loaded.length-1,1);};UIThumbPager.prototype.getPageNumber=function(){return this.index+1;};UIThumbPager.swap=function(a,b,c){if(a!==b)CSS.addClass(a,UIThumbPager.hiddenClass);CSS.removeClass(b,UIThumbPager.hiddenClass);thumbURI=URI(b.src);if((thumbURI.isFacebookURI()||thumbURI.getDomain().toLowerCase().match('\\.fbcdn\\.net$'))&&thumbURI.getPath().match('/safe_image.php')){c.value=thumbURI.getQueryData().url;}else c.value=b.src;};UIThumbPager.prototype.showThumbs=function(a){CSS.conditionClass(this.thumbRoot,'hidden_elem',!a);};UIThumbPager.sort=function(a){for(var b=0;b<a.length-1;b++)for(var c=b+1;c<a.length;c++)if(a[b].width*a[b].height<a[c].width*a[c].height){tmp=a[b];a[b]=a[c];a[c]=tmp;}return a;};UIThumbPager.prototype.checkLimits=function(a){CSS.removeClass(a,UIThumbPager.hiddenClass);var b=a.offsetWidth,c=a.offsetHeight;CSS.addClass(a,UIThumbPager.hiddenClass);return !(b&&(c<(this.minHeight||UIThumbPager.minHeight)||b<(this.minWidth||UIThumbPager.minWidth)||c/b>UIThumbPager.maxRatio||b/c>UIThumbPager.maxRatio));};copy_properties(UIThumbPager,{hiddenClass:'UIThumbPager_Hidden',loadtimeout:5000,timeout:3000,minWidth:50,minHeight:50,maxRatio:3});
function UIThumbPagerControl(a,b){if(!a)return false;copy_properties(this,{root:a,pager:b,buttons:DOM.find(a,'div.UIThumbPagerControl_Buttons'),buttonText:DOM.find(a,'div.UIThumbPagerControl_Text'),buttonLeft:DOM.find(a,'a.UIThumbPagerControl_Button_Left'),buttonRight:DOM.find(a,'a.UIThumbPagerControl_Button_Right'),loadedCount:0,pageCurrent:DOM.find(a,'span.UIThumbPagerControl_PageNumber_Current'),pageTotal:DOM.find(a,'span.UIThumbPagerControl_PageNumber_Total'),noThumb:DOM.find(a,'input.UIThumbPagerControl_NoPicture'),end:true});this.pager.setOnhideCallback(this.onhide.bind(this));this.root.getUIThumbPagerControl=bagof(this);this.attachHandlers();}UIThumbPagerControl.prototype.attachHandlers=function(){this.pager.setOnloadCallback(this.onload.bind(this));Event.listen(this.buttonLeft,'click',function(){this.click(this.pager.prev);}.bind(this));Event.listen(this.buttonRight,'click',function(){this.click(this.pager.next);}.bind(this));Event.listen(this.noThumb,'click',function(){this.pager.showThumbs(!this.noThumb.checked);CSS.conditionClass(this.buttons,'hidden_elem',this.noThumb.checked);CSS.conditionClass(this.buttonText,'hidden_elem',this.noThumb.checked);}.bind(this));};UIThumbPagerControl.prototype.onload=function(a){this.loadedCount=a;if(a==1)DOM.setContent(this.pageCurrent,a);if(a>this.pager.getPageNumber())CSS.removeClass(this.root,'UIThumbPagerControl_Last');DOM.setContent(this.pageTotal,a);};UIThumbPagerControl.prototype.onhide=function(){CSS.hide(this.root);this.noThumb.checked=true;};UIThumbPagerControl.prototype.click=function(a){if(this.loadedCount<=1)return;var b=['UIThumbPagerControl_Last','UIThumbPagerControl_First'];if(a==this.pager.prev)b.push(b.shift());if(this.end)CSS.removeClass(this.root,b[1]);if(this.end=a.bind(this.pager)())CSS.addClass(this.root,b[0]);DOM.setContent(this.pageCurrent,this.pager.getPageNumber());};
function InlineEditor(a,b,c,d,e){this._name=b;this._obj=a;this._root=c;this._target=d;this._more_than_meets_the_eye=true;this._original_value=a.firstChild.nodeValue;this._is_textarea=e;this._edit=$N(e?'textarea':'input',{value:this._original_value,className:'inputtext inline_edit'});var f=this._edit;a.parentNode.insertBefore(f,a);a.parentNode.removeChild(a);f.onblur=this._onblur.bind(this);f.onchange=this._onchange.bind(this);f.onkeypress=function(event){return this._onkeypress(event?event:window.event);}.bind(this);f.focus();f.select();}copy_properties(InlineEditor.prototype,{_onkeypress:function(event){switch(event?event.keyCode:0){case 27:if(ua.firefox()<3&&this._valueIsWhitespace(this._original_value))this._edit.value=InlineEditor.FIREFOX_2_BLANK_SUMMARY;this._edit.value=this._original_value;case 13:this._onblur();return false;}},_onblur:function(){if(!this._more_than_meets_the_eye)return false;this._more_than_meets_the_eye=false;this._onchange();var a=this._is_textarea;if(!this._edit.value||this._valueIsWhitespace(this._edit.value))if(ua.firefox()<3){this._edit.value=InlineEditor.FIREFOX_2_BLANK_SUMMARY;}else this._edit.value=InlineEditor.DEFAULT_BLANK_SUMMARY;var b=this._root,c=this._target,d=$N('a',{href:'#',className:'inline_edit',onmousedown:function(){return false;},onclick:function(){new InlineEditor(this,e,b,c,a);return false;}},this._edit.value),e=this._name;this._edit.parentNode.insertBefore(d,this._edit);this._edit.parentNode.removeChild(this._edit);},_valueIsWhitespace:function(a){return !!!(a.trim().length);},_onchange:function(){if(!this._target){this._target=$N('input',{name:this._name,type:'hidden'});this._root.appendChild(this._target);}this._target.value=this._edit.value;}});copy_properties(InlineEditor,{FIREFOX_2_BLANK_SUMMARY:'...',DEFAULT_BLANK_SUMMARY:'\u00A0\u00A0\u00A0'});
var Sharer={init:function(a,b,c){Selector.listen(a,"change",function(){var d=Selector.getValue(a);b.value=d;var e="mode"+d.charAt(0).toUpperCase()+d.slice(1);CSS.setClass(c,e);});},initPages:function(a,b,c,d){Selector.listen(a,"change",function(){var e=Selector.getSelectedOptions(a)[0],f=DOM.find(e,"input").getAttribute("value");CSS.conditionShow(b,f);CSS.conditionShow(c,f);CSS.conditionShow(d,!f);});},close:function(a){if(typeof(a)=='string'&&a){window.location.href=a;}else window.close();return false;}};