/*1339422854,169775812*/

if (window.CavalryLogger) { CavalryLogger.start_js(["HQWsO"]); }

var QuestionsOpinionPollForm={replaceRow:function(a,b,c){var d='.pollRow_'+b;DOM.scry(a,d).map(function(e){DOM.replace(e,c);});}};
__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("IntlDateFormats",[],function(a,b,c,d,e,f){var g={},h={setFormats:function(i,j){g=j;},getFormat:function(i){if(!(i in g))return i;return g[i];}};e.exports=h;});
__d("date-extensions",["IntlDateFormats","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('IntlDateFormats'),h=b('copyProperties'),i=b('tx'),j=["\u0627\u0644\u0623\u062d\u062f","\u0627\u0644\u0627\u062b\u0646\u064a\u0646","\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621","\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621","\u0627\u0644\u062e\u0645\u064a\u0633","\u0627\u0644\u062c\u0645\u0639\u0629","\u0627\u0644\u0633\u0628\u062a"],k=["\u0627\u0644\u0623\u062d\u062f","\u0627\u0644\u0625\u062b\u0646\u064a\u0646","\u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621","\u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621","\u0627\u0644\u062e\u0645\u064a\u0633","\u0627\u0644\u062c\u0645\u0639\u0629","\u0627\u0644\u0633\u0628\u062a"],l=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"],m=["\u064a\u0646\u0627\u064a\u0631","\u0641\u0628\u0631\u0627\u064a\u0631","\u0645\u0627\u0631\u0633","\u0623\u0628\u0631\u064a\u0644","\u0645\u0627\u064a\u0648","\u064a\u0648\u0646\u064a\u0648","\u064a\u0648\u0644\u064a\u0648","\u0623\u063a\u0633\u0637\u0633","\u0633\u0628\u062a\u0645\u0628\u0631","\u0623\u0643\u062a\u0648\u0628\u0631","\u0646\u0648\u0641\u0645\u0628\u0631","\u062f\u064a\u0633\u0645\u0628\u0631"];function n(o,p){p=p||2;o=''+o;while(o.length<p)o='0'+o;return o;}Date.format=function(o,p,q){var r=p?new Date(p*1000):new Date();return r.format(o,q);};h(Date.prototype,{format:function(o,p){if(!o)return '';var q=[],r=null,s=null,t=(p?'getUTC':'get'),u=this[t+'Date'](),v=this[t+'Day'](),w=this[t+'Month'](),x=this[t+'FullYear'](),y=this[t+'Hours'](),z=this[t+'Minutes'](),aa=this[t+'Seconds'](),ba=this[t+'Milliseconds']();for(var ca=0;ca<o.length;ca++){s=o.charAt(ca);if(s=='\\'){ca++;q.push(o.charAt(ca));continue;}switch(s){case 'd':r=n(u);break;case 'D':r=j[v];break;case 'j':r=u;break;case 'l':r=k[v];break;case 'F':r=m[w];break;case 'm':r=n(w+1);break;case 'M':r=l[w];break;case 'n':r=w+1;break;case 'Y':r=x;break;case 'y':r=(''+x).slice(2);break;case 'a':r=y<12?'am':'pm';break;case 'A':r=y<12?'AM':'PM';break;case 'g':r=(y==0||y==12)?12:y%12;break;case 'G':r=y;break;case 'h':r=(y==0||y==12)?12:n(y%12);break;case 'H':r=n(y);break;case 'i':r=n(z);break;case 's':r=n(aa);break;case 'S':r=n(ba,3);break;default:r=s;}q.push(r);}return q.join('');}});a.IntlDateFormats=g;},3);
__d("ControlledReferer",["event-extensions","URI"],function(a,b,c,d,e,f){b('event-extensions');var g=b('URI'),h={useFacebookReferer:function(i,j,k){var l=false;function m(){if(l)return;l=true;i.contentWindow.document.body.style.margin=0;j();}var n;if(document.domain!=='facebook.com'){n='/intern/common/referer_frame.php';}else if(g().isSecure()){n='https://s-static.ak.facebook.com/common/referer_frame.php';}else n='http://static.ak.facebook.com/common/referer_frame.php';if(k)n+='?fb_source='+k;Event.listen(i,'load',m);i.src=n;},useFacebookRefererHtml:function(i,j,k){h.useFacebookReferer(i,function(){i.contentWindow.document.body.innerHTML=j;},k);}};e.exports=h;});
__d("swfobject",["AsyncRequest","Bootloader","ControlledReferer","copyProperties","CSS","DOM","function-extensions","ge","StringEscape"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('ControlledReferer'),j=b('copyProperties'),k=b('CSS'),l=b('DOM');b('function-extensions');var m=b('ge'),n=b('StringEscape');if(typeof o=="undefined")var o={};if(typeof o.util=="undefined")o.util={};if(typeof o.SWFObjectUtil=="undefined")o.SWFObjectUtil={};o.SWFObject=function(u,v,w,x,y,z,aa,ba,ca,da){if(!document.getElementById)return;this.DETECT_KEY=da?da:'detectflash';this.skipDetect=o.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(u)this.setAttribute('swf',u);if(v)this.setAttribute('id',v);if(w)this.setAttribute('width',w);if(x)this.setAttribute('height',x);this.installedVer=o.SWFObjectUtil.getPlayerVersion();if(y){if(!(y instanceof Array))y=[y];var ea;y.forEach(function(ha){ea=new o.PlayerVersion(ha.toString().split('.'));if(ea.major==this.installedVer.major){this.setAttribute('version',ea);return;}else if(!this.getAttribute('version')||ea.major<this.getAttribute('version').major)this.setAttribute('version',ea);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!o.unloadSet){o.SWFObjectUtil.prepUnload=function(){var ha=function(){},ia=function(){};window.attachEvent("onunload",o.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",o.SWFObjectUtil.prepUnload);o.unloadSet=true;}if(z)this.addParam('bgcolor',z);var fa=aa?aa:'high';this.addParam('quality',fa);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var ga=(ba)?ba:window.location;this.setAttribute('xiRedirectUrl',ga);this.setAttribute('redirectUrl','');if(ca)this.setAttribute('redirectUrl',ca);this.setAttribute('useIframe',false);};o.SWFObject.ieWorkaroundApplied=false;o.SWFObject.ensureIEWorkaroundAttached=function(){if(!o.SWFObject.ieWorkaroundApplied&&document.attachEvent){o.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',o.SWFObject.onDocumentPropertyChange);}};o.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var u=document.title;if(u!=null&&u.indexOf('#!')!=-1){u=u.substring(0,u.indexOf('#!'));document.title=u;}}};j(o.SWFObject.prototype,{useExpressInstall:function(u){this.xiSWFPath=!u?"/swf/expressinstall.swf":u;this.setAttribute('useExpressInstall',true);},setAttribute:function(u,v){this.attributes[u]=v;},getAttribute:function(u){return this.attributes[u]||"";},addParam:function(u,v){this.params[u]=v;},getParams:function(){return this.params;},addVariable:function(u,v){this.variables[u]=v;},getVariable:function(u){return this.variables[u]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var u=[],v,w=this.getVariables();for(v in w)u[u.length]=v+"="+w[v];return u.join('&');},getSWFHTML:function(){var u,v,w;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}v={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var x=this.getParams();for(var y in x)v[y]=x[y];w=this.getVariablePairs();if(w)v.flashvars=w;u=t('embed',v,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}v={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var z=t('param',{name:'movie',value:this.getAttribute('swf')},null),x=this.getParams();for(var y in x)z+=t('param',{name:y,value:x[y]},null);w=this.getVariablePairs();if(w)z+=t('param',{name:'flashvars',value:w},null);u=t('object',v,z);}return u;},write:function(u){if(this.getAttribute('useExpressInstall')){var v=new o.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(v)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var w=(typeof u=='string')?document.getElementById(u):u;if(!w)return false;k.addClass(w,'swfObject');w.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){o.SWFObject.ensureIEWorkaroundAttached();w.innerHTML=this.getSWFHTML();}else this._createIframe(w);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var x=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').release+'.'+this.getAttribute('version').build,y=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.release+'.'+this.installedVer.build;this.fallback_js_fcn(y,x);w.innerHTML=this.fallback_html;}return false;},_createIframe:function(u){var v=l.create('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});l.empty(u);u.appendChild(v);i.useFacebookRefererHtml.bind(null,v,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}});o.SWFObjectUtil.getPlayerVersion=function(){var u=new o.PlayerVersion([0,0,0,0]),v;if(navigator.plugins&&navigator.mimeTypes.length){for(var w=0;w<navigator.plugins.length;w++)try{var y=navigator.plugins[w];if(y.name=='Shockwave Flash'){v=new o.PlayerVersion(y.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof u=='undefined'||v.major>u.major||(v.major==u.major&&(v.minor>u.minor||(v.minor==u.minor&&(v.release>u.release||(v.release==u.release&&v.build>u.build))))))u=v;}}catch(x){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var z=1,aa=3;while(z)try{aa++;z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+aa);u=new o.PlayerVersion([aa,0,0]);}catch(ba){z=null;}}else{try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(ca){try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");u=new o.PlayerVersion([6,0,21]);z.AllowScriptAccess="always";}catch(da){if(u.major==6)return u;}try{z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(ea){}}if(z!=null)u=new o.PlayerVersion(z.GetVariable("$version").split(" ")[1].split(","));}return u;};o.PlayerVersion=function(u){this.major=u[0]!=null?parseInt(u[0],10):0;this.minor=u[1]!=null?parseInt(u[1],10):0;this.release=u[2]!=null?parseInt(u[2],10):0;this.build=u[3]!=null?parseInt(u[3],10):0;};o.PlayerVersion.prototype.versionIsValid=function(u){if(this.major<u.major)return false;if(this.major>u.major)return true;if(this.minor<u.minor)return false;if(this.minor>u.minor)return true;if(this.release<u.release)return false;if(this.release>u.release)return true;if(this.build<u.build)return false;return true;};o.util={getRequestParameter:function(u){var v=document.location.search||document.location.hash;if(u==null)return v;if(v){var w=v.substring(1).split("&");for(var x=0;x<w.length;x++)if(w[x].substring(0,w[x].indexOf("="))==u)return w[x].substring((w[x].indexOf("=")+1));}return "";}};o.SWFObjectUtil.cleanupSWFs=function(){var u=document.getElementsByTagName("OBJECT");for(var v=u.length-1;v>=0;v--){u[v].style.display='none';for(var w in u[v])if(typeof u[v][w]=='function')u[v][w]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(u){return document.all[u];};var p=o.util.getRequestParameter,q=o.SWFObject,r=o.SWFObject;o.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};function s(u,v){var w=m(u),x=o.SWFObjectUtil.getPlayerVersion(),y;v.forEach(function(ba){ba=new o.PlayerVersion(ba.toString().split('.'));if(ba.major==x.major){y=ba;return;}else if(typeof y=='undefined'||ba.major<y.major)y=ba;}.bind(this));if(w&&x.major>0){var z=x.major+'.'+x.minor+'.'+x.release+'.'+x.build,aa=y.major+'.'+y.minor+'.'+y.release+'.'+y.build;l.setContent(w,l.tx._("Flash {required-version} \u0645\u0637\u0644\u0648\u0628 \u0644\u0639\u0631\u0636 \u0647\u0630\u0627 \u0627\u0644\u0645\u062d\u062a\u0648\u0649. \u0646\u0633\u062e\u062a\u0643 \u0627\u0644\u062d\u0627\u0644\u064a\u0629 \u0647\u064a {current-version}. \u064a\u064f\u0631\u062c\u0649 \u062a\u0646\u0632\u064a\u0644 \u0627\u0644\u0625\u0635\u062f\u0627\u0631 \u0627\u0644\u0623\u062d\u062f\u062b \u0644\u0640 Flash Player.",{'required-version':aa,'current-version':z}));}}o.showFlashErrorDialog=function(u,v){h.loadModules(['ErrorDialog'],function(w){w.show(u,v);});};function t(u,v,w){var x=/^[A-Za-z0-9\-]+$/;if(!u.match(x))throw new Error('Invalid tag '+u);var y='<'+u;for(var z in v){if(!z.match(x))throw new Error('Invalid attr '+z);y+=' '+z+'="'+n.htmlSpecialChars(v[z])+'"';}if(w===null){return y+'/>';}else return y+'>'+w+'</'+u+'>';}e.exports=a.deconcept||o;});
__d("SoundPlayer",["Arbiter","Env","swfobject","URI","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('swfobject').SWFObject,j=b('URI'),k=b('createArrayFrom'),l={},m=null,n=false,o=null,p='so_sound_player',q=null;function r(z){var aa=j(z);if(!aa.getDomain())return j(h.static_base).setPath(aa.getPath()).toString();return z;}function s(z){if(/\.mp3$/.test(z))return 'audio/mpeg';if(/\.og[ga]$/.test(z))return 'audio/ogg';return '';}function t(){if(!q){var z=document.createElement('audio');if(!z||!z.canPlayType)return null;z.setAttribute('preload','auto');document.body.appendChild(z);q=z;}return q;}function u(){var z=document[p]||window[p];if(z)if(!z.playSound&&z.length)z=z[0];return (z&&z.playSound&&z.loopSound)?z:null;}function v(){return n;}function w(z,aa,ba){m={path:z,sync:aa,loop:ba};}function x(){n=true;if(m){var z=u();if(m.loop){z.loopSound(m.path,m.sync);}else z.playSound(m.path,m.sync);}o.unsubscribe();o=null;}var y={init:function(z){z=k(z);var aa;for(var ba=0;ba<z.length;++ba){aa=z[ba];if(l[aa])return;}var ca=t();for(ba=0;ca&&ba<z.length;++ba){aa=z[ba];if(ca.canPlayType(aa)){l[aa]=true;return;}}l['audio/mpeg']=true;if(u())return;try{o=g.subscribe('sound/ready',x);var ea=document.createElement('div');ea.id='sound_player_holder';document.body.appendChild(ea);var fa=new i('/swf/SoundPlayerHater.swf',p,'1px','1px',['9.0.159.0','10.0.22.87'],'#ffffff');fa.addParam('allowscriptaccess','always');fa.addParam('wmode','transparent');fa.addVariable('swf_id',p);fa.fallback_html=' ';fa.write(ea.id);window[p]=fa;}catch(da){}},play:function(z,aa){z=k(z);var ba=t(),ca,da;for(var ea=0;ba&&ea<z.length;++ea){ca=z[ea];da=s(ca);if(!ba.canPlayType(da))continue;y.init([da]);ba.src=r(ca);if(aa){ba.setAttribute('loop','');}else ba.removeAttribute('loop');ba.play();return;}for(ea=0;ea<z.length;++ea){ca=r(z[ea]);da=s(ca);if(da!='audio/mpeg')continue;y.init([da]);var fa=u();if(!v()){w(ca,true,aa);return;}else if(fa){if(aa){fa.loopSound(ca,true);}else fa.playSound(ca,true);return;}}},stop:function(z){z=k(z);for(var aa=0;aa<z.length;++aa){var ba=r(z[aa]),ca=t(),da=u();if(ca&&ca.src==ba){ca.pause();ca.src=undefined;}else da&&da.stopSound(ba);}}};e.exports=y;});
__d("SoundSynchronizer",["event-extensions","hasArrayNature","SoundPlayer","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('hasArrayNature'),h=b('SoundPlayer'),i=b('createArrayFrom'),j='fb_sounds_playing3';function k(){if(window.localStorage)try{var p=window.localStorage[j];if(p){p=JSON.parse(p);if(g(p))return p;}}catch(o){}return [];}function l(o){if(window.localStorage){var p=k();p.push(o);while(p.length>5)p.shift();try{window.localStorage[j]=JSON.stringify(p);}catch(q){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;h.play(o,q);l(p);},isSupported:function(){return !!window.localStorage;}};e.exports=n;});
__d("SoundRPC",["event-extensions","SoundSynchronizer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('SoundSynchronizer');function h(j,k,l){g.play(j,k,l);}var i={playLocal:h,playRemote:function(j,k,l,m){var n={paths:k,sync:l,loop:m};j.postMessage(JSON.stringify(n),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){Event.listen(window,'message',function(j){if(!/\.facebook.com$/.test(j.origin))return;var k=JSON.parse(j.data);h(k.paths,k.sync,k.loop);});}};e.exports=i;});
__d("htmlHyperlink",["Env","StringEscape","UntrustedLink","URLScraper"],function(a,b,c,d,e,f){var g=b('Env'),h=b('StringEscape'),i=b('UntrustedLink'),j=b('URLScraper');function k(l,m,n,o){if(typeof l==='undefined'||!l.toString)return '';if(typeof m!=='function')m=h.htmlize;if(typeof n!=='function')n=h.htmlize;var l=l.toString(),p=[],q;while((q=j.match(l))){var r=l.indexOf(q);if(r>=0)p.push(m(l.substring(0,r)));var s=n(q),t=q.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(q)))t='http://'+t;p.push('<a target="_blank" rel="nofollow" href="'+t+'"');if(o){a.UntrustedLink=i;p.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');}p.push('>'+s+'</a>');l=l.substring(r+q.length);}l&&p.push(m(l));return p.join('');}e.exports=k;});
__d("legacy:rect",["Rect"],function(a,b,c,d){a.Rect=b('Rect');},3);
__d("AppRequestReminders",["AsyncRequest","CSS","DOM","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('ge'),k=0,l={},m=1,n=j('OtherAppReqReminder'),o=function(u,v,w){l[v]={node:u,seq:m++,reqCount:w};},p=function(u){k=u;},q=function(u){return u.id.split('_')[1];},r=function(u){var v=j(u),w=v.nextSibling;if(w!==n){h.show(w);k-=l[q(w)].reqCount;}s(k);},s=function(u){new g().setURI('/ajax/reminders/update_count.php').setData({new_count:u}).setMethod('POST').send();},t=function(u){if(n&&u){i.setContent(j('OtherAppReqLabel'),u);}else if(n)h.hide(n);};f.initNode=o;f.handleRemove=r;f.updateCount=t;f.setTotalOtherCount=p;});
__d("MercuryUnreadState",["Arbiter","copyProperties","MercuryFolders","JSLogger","KeyedCallbackManager","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryFolders'),j=b('JSLogger'),k=b('KeyedCallbackManager'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=b('MercuryThreads'),p=c('MercuryConstants'),q=(i.getSupportedFolders()||[]).filter(function(la){return la!=p.MessagingTag.ACTION_ARCHIVED;}),r={},s={},t={};q.forEach(function(la){r[la]=0;s[la]=false;t[la]=new k();});var u='unread_thread_hash',v='unseen_thread_list',w=p.MercuryThreadlistConstants.MAX_UNREAD_COUNT,x=j.create('mercury_unread_state'),y={getUnreadCount:function(la){if(this.exceedsMaxCount(la)){x.error('unguarded_unread_count_fetch',{});return 0;}return ca(la);},exceedsMaxCount:function(la){return s[la]||(ca(la)>w);}};function z(la,ma){t[la].setResource(u,ma);t[la].setResource(v,Object.keys(ma));}function aa(la,ma){var na=t[la].executeOrEnqueue(u,ma),oa=t[la].getUnavailableResources(na);if(oa.length)m.fetchUnreadThreadIDs(la);}function ba(la){return t[la].getResource(u);}function ca(la){var ma=t[la].getResource(v);if(ma){return ma.length;}else return r[la];}function da(la){var ma;(la.unread_thread_ids||[]).forEach(function(na){ma=na.folder;if(!ka(ma))return;var oa=ia(na.thread_ids);z(ma,l(oa,true));if(oa.length>w)s[ma]=true;n.updatedUnreadState();});(la.message_counts||[]).forEach(function(na){if(na.unread_count===undefined)return;ma=na.folder;if(na.unread_count>w){s[ma]=true;z(ma,{});n.updatedUnreadState();}else{r[ma]=na.unread_count;if(r[ma]===0)z(ma,{});n.updatedUnreadState();}});(la.actions||[]).forEach(function(na){if(na.is_forward)return;var oa=p.MercuryActionType,pa=na.thread_id?na.thread_id:na.server_thread_id;if(na.action_type==oa.DELETE_THREAD){q.forEach(function(ra){ga(ra,pa);});}else if(na.action_type==oa.CHANGE_ARCHIVED_STATUS||na.action_type==oa.CHANGE_FOLDER){var qa=o.getThreadMetaNow(na.thread_id);ma=i.getFromMeta(qa);if(ka(ma)&&qa.unread_count>0)fa(ma,pa);q.forEach(function(ra){if(ra!=ma)ga(ra,pa);});}else{ma=na.folder;if(!ka(ma))return;if(na.action_type==oa.CHANGE_READ_STATUS){ea(ma,pa,na.mark_as_read);}else if(na.action_type==oa.USER_GENERATED_MESSAGE||na.action_type==oa.LOG_MESSAGE)if(na.is_unread)fa(ma,pa);}});}function ea(la,ma,na){if(na){ga(la,ma);}else fa(la,ma);}function fa(la,ma){if(s[la])return;aa(la,function(na){if(!na[ma]){na[ma]=true;z(la,na);n.updatedUnreadState();}});}function ga(la,ma){if(s[la])return;aa(la,function(na){if(na[ma]){delete na[ma];z(la,na);n.updatedUnreadState();}});}function ha(la){s[la]=false;z(la,{});n.updatedUnreadState();}function ia(la){return la.map(m.convertThreadIDIfAvailable);}function ja(la){q.forEach(function(ma){var na=ba(ma);if(!na)return;for(var oa in la){var pa=la[oa];if(na[oa]){na[pa]=na[oa];delete na[oa];}}z(ma,na);});}function ka(la){return q.contains(la);}m.subscribe('update-unread',function(la,ma){da(ma);var na=ma.global_actions||[];for(var oa=0;oa<na.length;oa++){var pa=na[oa];if(pa.action_type==p.MercuryGlobalActionType.MARK_ALL_READ)ha(p.MessagingTag.INBOX,pa.action_id);}});m.subscribe('update-thread-ids',function(la,ma){ja(ma);});g.subscribe(j.DUMP_EVENT,function(la,ma){ma.messaging=ma.messaging||{};ma.messaging.unread={};ma.messaging.unread_max_count={};q.forEach(function(na){ma.messaging.unread[na]=h({},ba(na));ma.messaging.unread_max_count[na]=s[na];});});e.exports=y;});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","URI","MercuryUnreadState","MercuryServerRequests","MercuryThreadInformer","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('MercuryUnreadState'),l=b('MercuryServerRequests'),m=b('MercuryThreadInformer'),n=c('MercuryConstants'),o=b('copyProperties'),p,q,r=function(s,t){p=s;q=t;this.render();this.listenerToken=m.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};o(r.prototype,{render:function(){var s=k.exceedsMaxCount(n.MessagingTag.INBOX);if(s){i.setContent(p,n.MercuryThreadlistConstants.MAX_UNREAD_COUNT);}else{var t=k.getUnreadCount(n.MessagingTag.INBOX);i.setContent(p,t.toString());h.conditionClass(p.parentNode,'hidden_elem',t<=0);}i.setContent(q,s?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);m.unsubscribe(this.listenerToken);}});e.exports=r;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests'),i=b('MercuryLeftNavCountControl');e.exports=function(j,k){h.handleUpdate(k);var l=g.scry(j,'span.countValue')[0],m=g.scry(j,'span.maxCountIndicator')[0],n=new i(l,m);};});
__d("legacy:CounterDisplay",["CounterDisplay"],function(a,b,c,d){a.CounterDisplay=b('CounterDisplay');},3);
function startMessagingNavCountUpdater(a){var b=FutureSideNav.getInstance().getNodeForKey('inbox');if(!b)return;var c=FutureSideNav.getInstance().getNodeForKey('other'),d=DOM.scry(c,'span.count')[0],e=DOM.scry(d,'span.countValue')[0],f=DOM.scry(d,'span.maxCountIndicator')[0];new CounterMaxDisplay('other_unseen',e,d,null,null,true).setMaxCounter(a,f);}function CounterMaxDisplay(){this._maxValue=null;this._maxIndicatorNode=null;var a=[this].concat($A(arguments));return this.parent.construct.apply(this.parent,a);}Class.extend(CounterMaxDisplay,'CounterDisplay');copy_properties(CounterMaxDisplay.prototype,{setMaxCounter:function(a,b){this._maxValue=a;this._maxIndicatorNode=b;},paint:function(){var a=this._maxValue&&this._count>this._maxValue,b=a?this._maxValue:this._count;if(this._maxIndicatorNode){DOM.setContent(this._maxIndicatorNode,a?'+':'');}else if(a)b=b+'+';DOM.setContent(this._valueNode,b);this._toggleNodes();}});
__d("ComposerAudienceSelector",["DynamicIconSelector","CustomPrivacyOption","PrivacyConst","Selector"],function(a,b,c,d,e,f){b('DynamicIconSelector');var g=b('CustomPrivacyOption'),h=b('PrivacyConst'),i=b('Selector'),j={},k={},l={syncSelector:function(m){j[m]&&i.setSelected(m,j[m]);if(j[m]==h.BaseValue.CUSTOM&&k[m]){var n=i.getOption(m,h.BaseValue.CUSTOM+''),o=k[m];(function(){g.update(n.id,o.data,o.audience,o.tooltip);}).defer();}}};e.exports=l;});
__d("legacy:ComposerAudienceSelector",["ComposerAudienceSelector"],function(a,b,c,d){a.ComposerAudienceSelector=b('ComposerAudienceSelector');},3);
function FriendsPrivacyOption(){this.parent.construct(this);}Class.extend(FriendsPrivacyOption,'OnlyMePrivacyOption');FriendsPrivacyOption.prototype.init=function(a,b){this._hasRestricted=b;this.parent.init(a);};FriendsPrivacyOption.prototype._getChangedData=function(){return {tags:this._taggedIDs,privacy:PrivacyFriendsValue.ALL_FRIENDS};};FriendsPrivacyOption.prototype._recalculateTooltipAndLabel=function(){var a=this._tags.length,b=this._tooltip,c=this._label;if(a>2){this._tooltip=this._hasRestricted?"\u0623\u0635\u062f\u0642\u0627\u0624\u0643 \u0648\u0623\u0635\u062f\u0642\u0627\u0621 \u0623\u064a \u0634\u062e\u0635 \u062a\u0645\u062a \u0627\u0644\u0625\u0634\u0627\u0631\u0629 \u0625\u0644\u064a\u0647\u061b \u0628\u0627\u0633\u062a\u062b\u0646\u0627\u0621: \u0627\u0644\u0645\u0642\u064a\u0651\u062f\u064a\u0646":"\u0623\u0635\u062f\u0642\u0627\u0624\u0643 \u0648\u0623\u0635\u062f\u0642\u0627\u0621 \u0623\u064a \u0634\u062e\u0635 \u062a\u0645\u062a \u0627\u0644\u0625\u0634\u0627\u0631\u0629 \u0625\u0644\u064a\u0647";}else if(a==2){if(this._hasRestricted){this._tooltip=tx._("\u0623\u0635\u062f\u0642\u0627\u0624\u0643 \u0648\u0623\u0635\u062f\u0642\u0627\u0621 {user} \u0648\u0623\u0635\u062f\u0642\u0627\u0621 {user2}\u061b \u0628\u0627\u0633\u062a\u062b\u0646\u0627\u0621: \u0627\u0644\u0645\u0642\u064a\u0651\u062f\u064a\u0646",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=tx._("\u0623\u0635\u062f\u0642\u0627\u0624\u0643 \u0648 \u0623\u0635\u062f\u0642\u0627\u0621 {user} \u0648 \u0623\u0635\u062f\u0642\u0627\u0621 {user2}",{user:this._tags[0],user2:this._tags[1]});}else if(a==1){if(this._hasRestricted){this._tooltip=tx._("\u0623\u0635\u062f\u0642\u0627\u0624\u0643 \u0648\u0623\u0635\u062f\u0642\u0627\u0621 {user}\u061b \u0628\u0627\u0633\u062a\u062b\u0646\u0627\u0621: \u0627\u0644\u0645\u0642\u064a\u0651\u062f\u064a\u0646",{user:this._tags[0]});}else this._tooltip=tx._("\u0623\u0635\u062f\u0642\u0627\u0624\u0643 \u0648 \u0623\u0635\u062f\u0642\u0627\u0621 {user}.",{user:this._tags[0]});}else this._tooltip=this._hasRestricted?"\u0623\u0635\u062f\u0642\u0627\u0624\u0643\u061b \u0628\u0627\u0633\u062a\u062b\u0646\u0627\u0621: \u0627\u0644\u0645\u0642\u064a\u0651\u062f\u064a\u0646":"\u0623\u0635\u062f\u0642\u0627\u0624\u0643";CSS.conditionShow(this._plusLabel,this._tags.length);this._label=this._elem.getAttribute('data-label');if(this._tags.length)this._label+=' (+)';return (b!=this._tooltip)||(c!=this._label);};
__d("legacy:LayerDestroyOnHide",["LayerDestroyOnHide"],function(a,b,c,d){a.LayerDestroyOnHide=b('LayerDestroyOnHide');},3);
function MetaComposerEdDialog(){}copy_properties(MetaComposerEdDialog.prototype,{init:function(a,b,c,d,e){MetaComposerEdDialog.timesTagEduShown=c;MetaComposerEdDialog.timesStickyEduShown=e;if(MetaComposerEdDialog.singleton){a.destroy();return;}MetaComposerEdDialog.singleton=this;this._dialog=a;if(d)Arbiter.subscribe('composer/mutate',function(f,g){this._sendEducationRequest({sticky_num:MetaComposerEdDialog.timesStickyEduShown},'/ajax/composer/audience/sticky_education');}.bind(this));if(b)Arbiter.subscribe('SelectedPrivacyOption/changed',function(f,g){this._sendEducationRequest({ids:g.tags,type:g.privacy,tag_num:MetaComposerEdDialog.timesTagEduShown},'/ajax/composer/audience/tag_education');}.bind(this));Selector.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(a,b){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new AsyncRequest(b);this._async.setData(a).setHandler(this._handler.bind(this)).send();},_updateDialogContext:function(){var a=DOM.scry(document.body,'div.composerAudienceWrapper')[0],b=Vector2.getElementPosition(a);if(a&&b.x>0&&b.y>0){this._dialog.setContext(a);return true;}return false;},_handler:function(a){var b=a.payload;if(!b||!this._updateDialogContext())return;var c=this._dialog.getContent();DOM.setContent(c,b);this._dialog.disableBehavior(LayerDestroyOnHide).show();var d=Parent.byClass(c,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=animation(d);}else this._anim=animation(d).from('opacity',0);this._anim.by('opacity',1).checkpoint().duration(3500).checkpoint().to('opacity',0).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(a,b){if(this._anim){this._anim.stop();this._dialog.hide(false);this._anim=null;}}});
__d("Tokenizer",["array-extensions","event-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","Input","Keys","Parent","Token","UserAgent","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Input'),n=b('Keys'),o=b('Parent'),p=b('Token'),q=b('UserAgent'),r=b('copyProperties'),s=b('createObjectFrom');function t(u,v){this.element=u;this.typeahead=v;this.input=v.getCore().getElement();k.set(this.element,'Tokenizer',this);}t.getInstance=function(u){var v=o.byClass(u,'uiTokenizer');return v?k.get(v,'Tokenizer'):null;};r(t.prototype,h,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',init:function(u,v,w,x){this.init=bagofholding;this.tokenarea=u;this.paramName=v;this.placeholder=this.input.getAttribute('data-placeholder')||'';r(this,x||{});this.initEvents();this.initTypeahead();this.reset(w);this.initBehaviors();g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);},reset:function(u){this.tokens=[];this.unique={};if(u){this.populate(u);}else l.empty(this.tokenarea);this.updateTokenarea();},populate:function(u){var v=[];this.tokens=this.getTokenElements().map(function(w,x){var y=u[x];v.push(this._tokenKey(y));return this.createToken(y,w);},this);this.unique=s(v,this.tokens);},getElement:function(){return this.element;},getTypeahead:function(){return this.typeahead;},getInput:function(){return this.input;},initBehaviors:function(){for(var u in (this.behaviors||{})){var v=window.TokenizerBehaviors&&window.TokenizerBehaviors[u];v.call(null,this,this.behaviors[u]);}},initTypeahead:function(){var u=this.typeahead.getCore();u.resetOnSelect=true;u.setValueOnSelect=false;u.preventFocusChangeOnTab=true;if(this.inline){var v=this.typeahead.getView();j.addClass(v.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(w,x){var y=x.selected;if('uid' in y){this.updateInput();this.addToken(this.createToken(y));}}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));},handleBlur:function(event){this.inform('blur',{event:event});this.updatePlaceholder();},initEvents:function(){var u=this.handleEvents.bind(this),v=q.firefox()<4?'keypress':'keydown';Event.listen(this.tokenarea,{click:u,keydown:u});Event.listen(this.input,'paste',this.paste.bind(this));Event.listen(this.input,v,this.keydown.bind(this));},handleEvents:function(event){var u=event.getTarget(),v=u&&this.getTokenElementFromTarget(u);if(!v)return;if(event.type!='keydown'||Event.getKeyCode(event)==n.RETURN)this.processEvents(event,u,v);},processEvents:function(event,u,v){if(o.byClass(u,'remove')){var w=v.nextSibling;w=w&&l.scry(v.nextSibling,'.remove')[0];var x=this.getTokenFromElement(v);x=this.addTokenData(x,u);this.removeToken(x);this.focusOnTokenRemoval(event,w);event.kill();}},focusOnTokenRemoval:function(event,u){m.focus(event.type=='keydown'&&u||this.input);},addTokenData:function(u,v){return u;},keydown:function(event){this.inform('keydown',{event:event});var u=Event.getKeyCode(event),v=this.input;if(this.inline&&u==n.BACKSPACE&&m.isEmpty(v)){var w=this.getLastToken();if(w&&w.isRemovable())this.removeToken(w);}this.updateInput();},paste:function(event){this.inform('paste',{event:event});this.updateInput(true);},focusInput:function(){m.focus(this.input);},updateInput:function(u){if(!this.inline)return;var v=this.input;setTimeout(function(){v.size=v.value.length||this.placeholder.length*2||1;if(u)v.value=v.value;}.bind(this),20);},updatePlaceholder:function(){if(!this.inline||this.stickyPlaceholder||this.input.value)return;var u=!this.tokens.length;this.input.size=u?this.placeholder.length*2||1:1;m.setPlaceholder(this.input,u?this.placeholder:'');},getToken:function(u){return this.unique[u]||null;},getTokens:function(){return this.tokens||[];},getTokenElements:function(){return l.scry(this.tokenarea,'span.uiToken');},getTokenElementFromTarget:function(u){return o.byClass(u,'uiToken');},getTokenFromElement:function(u){return k.get(u,'Token');},getTokenValues:function(){return this.tokens.map(function(u){return u.getValue();});},getFirstToken:function(){return this.tokens[0]||null;},getLastToken:function(){return this.tokens[this.tokens.length-1]||null;},hasMaxTokens:function(){return this.maxTokens&&this.maxTokens<=this.tokens.length;},createToken:function(u,v){var w=this.getToken(this._tokenKey(u));w=w||new p(u,this.paramName);v&&w.setElement(v);return w;},addToken:function(u){if(this.hasMaxTokens())return;var v=this._tokenKey(u.getInfo());if(v in this.unique)return;this.unique[v]=u;this.tokens.push(u);this.insertToken(u);this.updateTokenarea();this.inform('addToken',u);g.inform('Form/change',{node:this.element});},insertToken:function(u){l.appendContent(this.tokenarea,u.getElement());},removeToken:function(u){if(!u)return;var v=this.tokens.indexOf(u);if(v<0)return;this.tokens.splice(this.tokens.indexOf(u),1);delete this.unique[this._tokenKey(u.getInfo())];l.remove(u.getElement());this.updateTokenarea();this.inform('removeToken',u);g.inform('Form/change',{node:this.element});},removeAllTokens:function(){this.reset();this.inform('removeAllTokens');},updateTokenarea:function(){var u=this.typeahead.getCore(),v=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=u.getExclusions());u.setExclusions(v.concat(this._exclusions));}u.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();},updateTokenareaVisibility:function(){j.conditionShow(this.tokenarea,this.tokens.length!==0);},_tokenKey:function(u){return u.uid+(u.freeform?':':'');}});e.exports=t;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","copyProperties","JSLogger","math-extensions","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceState","PresenceUtil","areObjectsEqual","PresenceInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('copyProperties'),l=b('JSLogger'),m=b('math-extensions'),n=b('MercuryAssert'),o=b('MercuryServerRequests'),p=b('MercuryThreads'),q=b('MercuryTimestampTracker'),r=c('PresenceInitialData'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('areObjectsEqual'),v=[],w=null,x=null,y=null,z=null;function aa(){return parseInt(r.serverTime,10);}var ba=j.get('tab_max_load_age')||3600000,ca=aa()-ba,da=0,ea=20,fa=l.create('chat_tab_model'),ga=false;function ha(ya){var za=m.verifyNumber(ya.uct2);if(!za||typeof za!=='number'){fa.warn('bad_cookie_version',ya.uct2);return null;}if(za<=da||za<ca)return null;return za;}function ia(ya){var za=ha(ya);if(!za){var ab={};ab.old_tabs=ya&&ya.t2&&JSON.stringify(ya.t2);ab.old_promoted=ya&&ya.lm2;ab.old_time=ya&&ya.uct2;ab.old_reason=ya&&ya.tr;ab.old_window=ya&&ya.tw;var bb;if(x&&ya.t2)for(var cb=0;cb<ya.t2.length;cb++){var db=ya.t2[cb];if(db.i===x)bb=db.r;}var eb=[];v.forEach(function(fb){if(!fb.fragile){var gb={i:fb.id,si:fb.server_id};if(fb.raised||(fb.id===x&&bb))gb.r=1;eb.push(gb);}});ya.t2=eb;ya.uct2=da;ya.lm2=w;ya.tr=z;ya.tw=t.getSessionID();ab.new_tabs=JSON.stringify(ya.t2);ab.new_promoted=ya.lm2;ab.new_time=ya.uct2;ab.new_reason=ya.tr;ab.new_window=ya.tw;fa.debug('store',ab);}return ya;}function ja(ya){if(ya){var za=ha(ya);if(za){var ab={};ab.old_tabs=JSON.stringify(v);ab.old_promoted=w;ab.old_time=da;ab.old_reason=z;ab.window_id=t.getSessionID();ab.cookie_tabs=ya&&ya.t2&&JSON.stringify(ya.t2);ab.cookie_promoted=ya&&ya.lm2;ab.cookie_time=ya&&ya.uct2;ab.cookie_reason=ya&&ya.tr;ab.cookie_window=ya&&ya.tw;da=za;z='load';var bb=ka(ya.t2,ya.lm2||null);ab.load_result=bb;ab.new_tabs=JSON.stringify(v);ab.new_promoted=w;ab.new_time=da;ab.new_reason=z;var event='load';if(!ga)event+='_init';fa.log(event,ab);return bb;}}return false;}function ka(ya,za){if(la(ya,za)){var ab=v.filter(function(db){return db.fragile;}),bb={};w=null;v=ya.map(function(db){var eb={id:db.i,server_id:db.si};if(eb.id==za)w=eb.id;if(x==db.i){var fb=qa(x);if(fb!=-1){eb.raised=v[fb].raised;return eb;}else return null;}if(db.r)eb.raised=true;bb[eb.id]=eb;return eb;});v=v.filter(function(db){return db!=null;});if(y)for(var cb in y)if(!bb[cb]||!bb[cb].raised)delete y[cb];ab=ab.filter(function(db){return !bb[db.id];});v=v.concat(ab);pa();return true;}return false;}function la(ya,za){if(za!=w)return true;var ab=v.filter(function(db){return !db.fragile;});if(ya.length!=ab.length)return true;for(var bb=0,cb=ya.length;bb<cb;bb++){if(ya[bb].id===x)continue;if(!u(ya[bb],ab[bb]))return true;}return false;}function ma(ya,za,ab){var bb=ja(s.get());if(za===undefined||za>da){if(ya()){bb=true;z=ab||null;oa(za);}}else fa.error('rejected',{change_time:za,state_time:da});bb&&na();}function na(){if(ga)wa.inform('chat/tabs-changed',wa.get());}function oa(ya){if(ya===undefined)ya=Math.max(q.getLastUserMessageTimestamp()||1,da+1);da=ya;s.doSync();}function pa(){var ya=v.length-ea;if(ya>0)v=v.filter(function(za){return za.raised||ya--<=0;});}function qa(ya){for(var za=0;za<v.length;za++)if(v[za].id==ya)return za;return -1;}function ra(ya){var za=p.getThreadMetaNow(ya);if(!za)return false;if(za.is_canonical_user||za.is_canonical_group){return ta(ya);}else{var ab=sa(ya);if(ab)o.getServerThreadID(ya,function(bb){if(ua(ya,bb)){oa();na();}});return ab;}}function sa(ya){if(qa(ya)===-1){v.push({id:ya,fragile:true});fa.log('open_fragile_tab',{tabs:JSON.stringify(v),opened:ya,window_id:t.getSessionID()});return true;}return false;}function ta(ya){var za=qa(ya);if(za!=-1)if(v[za].fragile){v.splice(za,1);}else return false;for(var ab=0;ab<=v.length;ab++)if(ab==v.length||v[ab].fragile){v.splice(ab,0,{id:ya});pa();fa.log('open_tab',{tabs:JSON.stringify(v),opened:ya,window_id:t.getSessionID()});return true;}}function ua(ya,za){var ab=qa(ya);if(ab!=-1&&v[ab].fragile){var bb=v[ab];bb.fragile=false;bb.server_id=za;var cb=[];v.forEach(function(db){if(db.id!=ya){if(bb&&db.fragile){cb.push(bb);bb=null;}cb.push(db);}});if(bb)cb.push(bb);v=cb;fa.log('make_permanent',{tabs:JSON.stringify(v),tab_id:ya,window_id:t.getSessionID()});return true;}return false;}function va(ya){var za=qa(ya);if(ya==w)w=null;if(za!=-1){v.splice(za,1);fa.log('close_tab',{tabs:JSON.stringify(v),closed:ya,window_id:t.getSessionID()});return true;}return false;}s.registerStateStorer(ia);s.registerStateLoader(function(ya){if(ja(ya))na();});function wa(){}k(wa,h,{indexOf:function(ya){return qa(ya);},getTab:function(ya){n.isThreadID(ya);var za=this.indexOf(ya);if(za>-1){var ab=v[za];return k({},ab);}return null;},closeAllTabs:function(){if(v.length){fa.log('close_all_tabs',{closed_tabs:JSON.stringify(v),window_id:t.getSessionID()});v=[];w=null;if(y)y={};oa();na();}},closeFragileTabs:function(){var ya=[];for(var za=0;za<v.length;za++)if(v[za].fragile){ya.push(v[za]);v.splice(za);na();break;}fa.log('close_fragile_tabs',{tabs:JSON.stringify(v),fragile_closed:ya,window_id:t.getSessionID()});},closeTab:function(ya,za){n.isThreadID(ya);var ab=false;if(y){delete y[ya];ab=true;}ma(function(){if(va(ya))ab=true;return ab;},undefined,za);},closeTabAndDemote:function(ya,za,ab){n.isThreadID(ya);var bb=false;if(y){delete y[ya];bb=true;}ma(function(){if(va(ya)){if(w){var cb=qa(w);if(cb>za){var db=v.splice(cb,1)[0];v.splice(za,0,db);w=null;}}bb=true;}return bb;},undefined,ab);},raiseTab:function(ya,za){n.isThreadID(ya);var ab=false;if(y&&za){y[ya]=true;ab=true;}if(!za&&ya===x){ab&&na();return;}ma(function(){if(ra(ya))ab=true;var bb=qa(ya);if(bb!=-1&&!v[bb].raised){v[bb].raised=true;ab=true;fa.log('raise_tab',{tabs:JSON.stringify(v),raised:ya,window_id:t.getSessionID()});}return ab;});},get:function(){var ya=v.map(function(za){var ab=k({},za);delete ab.fragile;if(y)ab.raised=y[ab.id];return ab;});return {tabs:ya,promoted:w};},openFragileTab:function(ya){n.isThreadID(ya);if(sa(ya))na();},openTab:function(ya){n.isThreadID(ya);ma(ra.curry(ya));},lowerTab:function(ya){n.isThreadID(ya);var za=false;if(y){delete y[ya];za=true;}ma(function(){var ab=qa(ya);if(ab!=-1&&v[ab].raised){delete v[ab].raised;fa.log('lower_tab',{tabs:JSON.stringify(v),lowered:ya,window_id:t.getSessionID()});za=true;}return za;});},raiseAndPromoteTab:function(ya,za,ab,bb){n.isThreadID(ya);var cb=false;if(y&&za){y[ya]=true;cb=true;}if(!za&&ya===x){cb&&na();return;}ma(function(){if(ra(ya))cb=true;var db=qa(ya);if(db!=-1&&(!v[db].raised||w!=ya)){v[db].raised=true;w=ya;cb=true;fa.log('raise_and_promote_tab',{tabs:JSON.stringify(v),promoted:ya,window_id:t.getSessionID()});}return cb;},ab,bb);},squelchTab:function(ya){n.isThreadID(ya);x=ya;this.lowerTab(ya);fa.log('squelch_tab',{squelched:ya,tabs:JSON.stringify(v),window_id:t.getSessionID()});},clearSquelchedTab:function(){if(x)fa.log('unsquelch_tab',{squelched:x,tabs:JSON.stringify(v),window_id:t.getSessionID()});x=null;}});g.subscribe(l.DUMP_EVENT,function(ya,za){za.chat_tabs={promoted:w,tabs:v.map(function(ab){return k({},ab);}),time:da,max_load_age:ba};});function xa(){var ya=i.ignoresRemoteTabRaise();if(ya&&!y){fa.log('start_ignore_remote_raise');y={};na();}else if(!ya&&y){fa.log('stop_ignore_remote_raise');y=null;na();}}i.subscribe(i.ON_CHANGED,xa);xa();ja(s.getInitial(),true);if(da===0)da=aa()-600000;ga=true;e.exports=wa;});
__d("TextInputControl",["event-extensions","function-extensions","Class","DOMControl","Input","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Class'),h=b('DOMControl'),i=b('Input'),j=b('copyProperties');function k(l){this.parent.construct(this,l);var m=this.getRoot(),n=function(){this.update.bind(this).defer();}.bind(this);Event.listen(m,{keydown:n,paste:n});}g.extend(k,h);j(k.prototype,{setMaxLength:function(l){i.setMaxLength(this.getRoot(),l);return this;},getValue:function(){return i.getValue(this.getRoot());},isEmpty:function(){return i.isEmpty(this.getRoot());},setValue:function(l){i.setValue(this.getRoot(),l);this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(l){i.setPlaceholder(this.getRoot(),l);return this;}});e.exports=k;});
__d("TextMetrics",["array-extensions","DOM","Style","UserAgent","debounce"],function(a,b,c,d,e,f){b('array-extensions');var g=b('DOM'),h=b('Style'),i=b('UserAgent'),j=b('debounce'),k;function l(){if(typeof k==='undefined'){var n=g.create('div',{className:'webkitZoomTest'}),o=function(){g.appendContent(document.body,n);k=100/n.clientHeight;g.remove(n);};Event.listen(window,'resize',j(o,100));o();}return k;}function m(n){this._node=n;this._shadow=g.create('textarea',{className:'textMetrics'});var o=['fontSize','fontStyle','fontWeight','fontFamily','wordWrap'];o.forEach(function(q){h.set(this._shadow,q,h.get(n,q));}.bind(this));var p=h.get(n,'lineHeight');if(i.chrome()||i.safari())p=Math.round(parseInt(p,10)*l())+'px';h.set(this._shadow,'lineHeight',p);document.body.appendChild(this._shadow);}m.prototype.measure=function(){var n=this._node,o=this._shadow,p=n.clientWidth-h.getFloat(n,'paddingLeft')-h.getFloat(n,'paddingRight');h.set(o,'width',p+'px');o.value=n.value+'...';return {width:o.scrollWidth,height:o.scrollHeight};};m.prototype.destroy=function(){g.remove(this._shadow);};e.exports=m;});
__d("TextAreaControl",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DOMControl","Style","TextInputControl","TextMetrics","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOMControl'),l=b('Style'),m=b('TextInputControl'),n=b('TextMetrics'),o=b('copyProperties');function p(q){this.autogrow=j.hasClass(q,'uiTextareaAutogrow');this.parent.construct(this,q);this.width=null;Event.listen(q,'focus',this._handleFocus.bind(this));}i.extend(p,m);o(p.prototype,h,{setAutogrow:function(q){this.autogrow=q;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var q=this.getRoot();if(!this.metrics)this.metrics=new n(q);if(typeof this.initialHeight==='undefined'){this.isBorderBox=l.get(q,'box-sizing')==='border-box'||l.get(q,'-moz-box-sizing')==='border-box'||l.get(q,'-webkit-box-sizing')==='border-box';this.borderBoxOffset=l.getFloat(q,'padding-top')+l.getFloat(q,'padding-bottom')+l.getFloat(q,'border-top-width')+l.getFloat(q,'border-bottom-width');this.initialHeight=q.offsetHeight-this.borderBoxOffset;}var r=this.metrics.measure(),s=Math.max(this.initialHeight,r.height);if(this.isBorderBox)s+=this.borderBoxOffset;if(s!==this.height){this.height=s;l.set(q,'height',s+'px');g.inform('reflow');this.inform('resize');}}else if(this.metrics){this.metrics.destroy();this.metrics=null;}},resetHeight:function(){this.height=-1;this.update();},_handleFocus:function(){this.width=null;}});p.getInstance=function(q){return k.getInstance(q)||new p(q);};e.exports=p;});
__d("TypingDetector",["event-extensions","function-extensions","ArbiterMixin","Class","Input","Run","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom');function m(n){this._input=n;this._ignoreKeys={};}m.INACTIVE=0;m.TYPING=1;m.QUITTING=2;k(m.prototype,g,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=bagofholding;this.reset();Event.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(n){this._ignoreKeys=l(n);},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var n=Event.getKeyCode(event),o=this._currentState;if(!this._ignoreKeys[n])if(i.getValue(this._input).trim().length===0){if(o==m.TYPING)this._transition(m.INACTIVE);}else if(o==m.TYPING){this._recordKeystroke();}else if(o==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}},_transition:function(n){this.reset();this._currentState=n;this.inform('change',n);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var n=this._lastKeystrokeTime+this._timeout,o=Date.now();if(o>n){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(n-o+10);}}});e.exports=m;});
function TimelineStickyHeaderComposer(){}copy_properties(TimelineStickyHeaderComposer,{_instances:{},getInstance:function(a){return TimelineStickyHeaderComposer._instances[a];}});copy_properties(TimelineStickyHeaderComposer.prototype,{init:function(a){TimelineStickyHeaderComposer._instances[a]=this;var b=$(a);this._container=Parent.byClass(b,'fbTimelineStickyHeaderComposer');this._tokens=[];Arbiter.subscribe('xhpc/construct/'+a,function(c,d){this._composer=d;this._tokens=[TimelineComposerUtilities.listenToPublish(this._composer,this._close.bind(this)),TimelineComposerUtilities.listenToAnotherComposerOpen(this._composer,this._close.bind(this)),TimelineComposerUtilities.listenToSetEstimatedDate(this._composer,TimelineContentLoader.capsuleForCurrentSection),Arbiter.subscribe("PhotoSnowlift.OPEN",this._close.bind(this)),Arbiter.subscribe('TimelineMLE/mleFlyoutShown',function(e,f){if(Composer.getInstance(f.getContext())===this._composer){this._closeComposerAttachment();}else this._close();}.bind(this)),Arbiter.subscribe('TimelineMLE/mleFlyoutHidden',function(e,f){if(f.context&&!f.new_flyout&&Composer.getInstance(f.context)===this._composer)this._close();}.bind(this)),this._composer.subscribeToMutate(this._closeMLE.bind(this)),this._composer.subscribeToMutate(this._registerClickToDismiss.bind(this)),Arbiter.subscribe(TimelineStickyHeader.ADJUST_WIDTH,this._toggleNarrowMode.bind(this))];}.bind(this));this._clickCancelToken=TimelineComposerUtilities.listenToCancel(b,this._close.bind(this));onleaveRegister(function(){this._tokens.forEach(Arbiter.unsubscribe.bind(Arbiter));this._tokens=[];this._clickCancelToken.remove();this._clickCancelToken=null;this._clearClickDismissToken();}.bind(this));},_toggleNarrowMode:function(event,a){Bootloader.loadComponents('Tooltip',function(){var b=Vector2.getElementDimensions(a).x>400,c=DOM.scry(this._composer.root,'a.attachmentLink');CSS.conditionClass(this._composer.root.parentNode,'narrowStickyHeaderComposer',b);for(var d=0;d<c.length;d++){var e=c[d],f=DOM.getText(e);if(b){Tooltip.set(e,f);}else Tooltip.remove(e);}}.bind(this));return false;},_registerClickToDismiss:function(){var a=DOM.find(this._composer.root,'span.lifeEventAttachment');if(!CSS.hasClass(a,'uiComposerAttachmentSelected')){this._clearClickDismissToken();return;}this._clickDismissToken=Event.listen(document.body,'click',function(event){var b=event.getTarget();if(!Parent.byClass(b,'fbTimelineStickyHeaderComposer')){this._close();this._clearClickDismissToken();}}.bind(this));},_clearClickDismissToken:function(){if(this._clickDismissToken){this._clickDismissToken.remove();this._clickDismissToken=null;}},_close:function(){this._closeComposerAttachment();this._closeMLE();},_closeComposerAttachment:function(){this._clearClickDismissToken();this._composer.reset();CSS.removeClass(this._composer.root,'uiComposerOpen');},_closeMLE:function(){Bootloader.loadComponents('TimelineMLE',function(){var a=TimelineMLE.getFlyout();if(a&&Composer.getInstance(a.getContext())===this._composer)TimelineMLE.hideFlyout();}.bind(this));}});